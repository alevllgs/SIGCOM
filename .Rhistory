"319-CONSULTA OTORRINOLARINGOLOGÍA",
"323-CONSULTA CIRUGÍA MAXILOFACIAL",
"326-CONSULTA DE TRAUMATOLOGÍA",
"328-CONSULTA PEDIATRÍA GENERAL",
"329-CONSULTA NEONATOLOGÍA",
"331-CONSULTA NEUROLOGÍA PEDIÁTRICA",
"342-CONSULTA TRAUMATOLOGÍA PEDIÁTRICA",
"351-CONSULTA CIRUGÍA PEDIÁTRICA",
"353-CONSULTA GINECOLOGICA",
"354-CONSULTA OBSTETRICIA",
"230-CONSULTA NUTRICIÓN",
"232-CONSULTA OTROS PROFESIONALES")
cma <- c("465-QUIRÓFANO AMBULATORIO DE EMERGENCIA",
"471-QUIRÓFANOS MAYOR AMBULATORIA")
hospitalizacion <- c(
"65-HOSPITALIZACIÓN PENSIONADOS",
"66-HOSPITALIZACIÓN MEDICINA INTERNA",
"72-HOSPITALIZACIÓN NEUROLOGÍA",
"87-HOSPITALIZACIÓN ONCOLOGÍA",
"90-HOSPITALIZACIÓN QUIRÚRGICA",
"96-HOSPITALIZACIÓN UROLOGÍA",
"98-HOSPITALIZACIÓN NEUROCIRUGÍA",
"99-HOSPITALIZACIÓN OFTALMOLOGÍA",
"100-HOSPITALIZACIÓN OTORRINOLARINGOLOGÍA",
"111-HOSPITALIZACIÓN TRAUMATOLOGÍA",
"113-HOSPITALIZACIÓN OBSTETRICIA",
"114-HOSPITALIZACIÓN GINECOLOGÍA",
"116-HOSPITALIZACIÓN PEDIATRÍA",
"130-HOSPITALIZACIÓN TRAUMATOLOGÍA PEDIÁTRICA",
"136-HOSPITALIZACIÓN NEUROCIRUGÍA PEDIÁTRICA",
"149-HOSPITALIZACIÓN PSIQUIATRÍA")
hospitalizacion_uci <- c("166-UNIDAD DE CUIDADOS INTENSIVOS",
"169-UNIDAD DE CUIDADOS INTENSIVOS NEONATOS",
"170-UNIDAD DE CUIDADOS INTENSIVOS PEDIATRIA",
"180-UNIDAD DE CUIDADOS INTERMEDIOS ADULTOS",
"198-UNIDAD DE TRATAMIENTO INTENSIVO CORONARIOS")
hospitalizacion_qx <- c(
"462-QUIRÓFANOS CABEZA Y CUELLO",
"464-QUIRÓFANOS CARDIOVASCULAR",
"467-QUIRÓFANOS DIGESTIVA",
"470-QUIRÓFANOS GINECOLOGÍA",
"475-QUIRÓFANOS NEUROCIRUGÍA",
"476-QUIRÓFANOS OBSTETRICIA",
"477-QUIRÓFANOS ODONTOLOGICA",
"478-QUIRÓFANOS OFTALMOLOGÍA",
"480-QUIRÓFANOS OTORRINOLARINGOLOGÍA",
"483-QUIRÓFANOS PROCTOLOGÍA",
"484-QUIRÓFANOS TORACICA",
"485-QUIRÓFANOS TRAUMATOLOGÍA Y ORTOPEDIA",
"486-QUIRÓFANOS UROLOGÍA",
"487-QUIRÓFANOS VASCULAR",
"493-QUIRÓFANOS CIRUGÍA PLÁSTICA",
"494-QUIRÓFANOS CIRUGÍA TORACICA",
"495-QUIRÓFANOS CIRUGÍA VASCULAR",
"797-QUIROFANOS CIRUGIA CARDIACA")
emergencias <- c("216-EMERGENCIAS PEDIÁTRICAS",
"357-EMERGENCIAS ODONTOLOGICAS")
PM_GRD <- readline(prompt="Ingrese Peso Medio GRD: ")
# Urgencia ----------------------------------------------------------------
i4 <- Cubo_9 %>% filter(CC %in% emergencias & Item=="Total RRHH")  %>% group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p4 <- Cubo_9 %>% filter(CC %in% emergencias & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
i4 <- inner_join(i4,p4) %>%
mutate("Cod"=4, "Trazadora"="Atenciones de Emergencia", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"="", "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,"Costo por Actividad 2021"= round(`Gasto RRHH 2021`/`Producción 2021`)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021` )
# Ambulatorio -------------------------------------------------------------
i3 <- Cubo_9 %>% filter(CC %in% ambulatorio & Item=="Total RRHH")  %>% group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p3 <- Cubo_9 %>% filter(CC %in% ambulatorio & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p33 <- Cubo_9 %>% filter(CC %in% ambulatorio & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p3 <- data.frame(Fecha=p3$Fecha, "Producción 2021"= p3$`Producción 2021`+p33$`Producción 2021`)
colnames(p3)[2] <- "Producción 2021"
i3 <- inner_join(i3,p3) %>%
mutate("Cod"=3, "Trazadora"="Consultas de Especialidad", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"="", "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round(`Gasto RRHH 2021`/`Producción 2021`)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
# CMA ---------------------------------------------------------------------
i2 <- Cubo_9 %>% filter(CC %in% cma & Item=="Total RRHH")  %>% group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p2 <- Cubo_9 %>% filter(CC %in% cma & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
i2 <- inner_join(i2,p2) %>%
mutate("Cod"=2, "Trazadora"="Cirugía Mayor Ambulatoria", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"="", "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round(`Gasto RRHH 2021`/`Producción 2021`)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
# Hospitalizado -----------------------------------------------------------
i1 <- Cubo_9 %>% filter((CC %in% hospitalizacion | CC %in% hospitalizacion_qx | CC %in% hospitalizacion_uci) & Item=="Total RRHH")  %>%
group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p1 <- Cubo_9 %>% filter(CC %in% hospitalizacion & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p11 <-  Cubo_9 %>% filter(CC %in% hospitalizacion_uci & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p1 <- data.frame(Fecha=p1$Fecha, "Producción 2021"= p1$`Producción 2021`+p11$`Producción 2021`)
colnames(p1)[2] <- "Producción 2021"
i1 <- inner_join(i1,p1) %>%
mutate("Cod"=1, "Trazadora"="Hospitalización", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"= PM_GRD, "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round(`Gasto RRHH 2021`/`Producción 2021`)*PM_GRD) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
informe <- rbind(i1, i3, i2, i4)
openxlsx::write.xlsx(informe,paste0(ruta_base,"BBDD Produccion/PERC/PERC 2021/informe_mensual.xlsx"),
colNames = TRUE, sheetName = "Informe", overwrite = TRUE)
emergencias <- c("216-EMERGENCIAS PEDIÁTRICAS",
"357-EMERGENCIAS ODONTOLOGICAS")
PM_GRD <- readline(prompt="Ingrese Peso Medio GRD: ")
# Urgencia ----------------------------------------------------------------
i4 <- Cubo_9 %>% filter(CC %in% emergencias & Item=="Total RRHH")  %>% group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p4 <- Cubo_9 %>% filter(CC %in% emergencias & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
i4 <- inner_join(i4,p4) %>%
mutate("Cod"=4, "Trazadora"="Atenciones de Emergencia", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"="", "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,"Costo por Actividad 2021"= round(`Gasto RRHH 2021`/`Producción 2021`)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021` )
# Ambulatorio -------------------------------------------------------------
i3 <- Cubo_9 %>% filter(CC %in% ambulatorio & Item=="Total RRHH")  %>% group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p3 <- Cubo_9 %>% filter(CC %in% ambulatorio & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p33 <- Cubo_9 %>% filter(CC %in% ambulatorio & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p3 <- data.frame(Fecha=p3$Fecha, "Producción 2021"= p3$`Producción 2021`+p33$`Producción 2021`)
colnames(p3)[2] <- "Producción 2021"
i3 <- inner_join(i3,p3) %>%
mutate("Cod"=3, "Trazadora"="Consultas de Especialidad", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"="", "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round(`Gasto RRHH 2021`/`Producción 2021`)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
# CMA ---------------------------------------------------------------------
i2 <- Cubo_9 %>% filter(CC %in% cma & Item=="Total RRHH")  %>% group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p2 <- Cubo_9 %>% filter(CC %in% cma & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
i2 <- inner_join(i2,p2) %>%
mutate("Cod"=2, "Trazadora"="Cirugía Mayor Ambulatoria", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"="", "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round(`Gasto RRHH 2021`/`Producción 2021`)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
# Hospitalizado -----------------------------------------------------------
i1 <- Cubo_9 %>% filter((CC %in% hospitalizacion | CC %in% hospitalizacion_qx | CC %in% hospitalizacion_uci) & Item=="Total RRHH")  %>%
group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p1 <- Cubo_9 %>% filter(CC %in% hospitalizacion & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p11 <-  Cubo_9 %>% filter(CC %in% hospitalizacion_uci & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p1 <- data.frame(Fecha=p1$Fecha, "Producción 2021"= p1$`Producción 2021`+p11$`Producción 2021`)
colnames(p1)[2] <- "Producción 2021"
i1 <- inner_join(i1,p1) %>%
mutate("Cod"=1, "Trazadora"="Hospitalización", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"= PM_GRD, "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round((`Gasto RRHH 2021`/`Producción 2021`)*PM_GRD)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
informe <- rbind(i1, i3, i2, i4)
openxlsx::write.xlsx(informe,paste0(ruta_base,"BBDD Produccion/PERC/PERC 2021/informe_mensual.xlsx"),
colNames = TRUE, sheetName = "Informe", overwrite = TRUE)
PM_GRD <- readline(prompt="Ingrese Peso Medio GRD: ")
PM_GRD <- as.numeric(PM_GRD)
# Urgencia ----------------------------------------------------------------
i4 <- Cubo_9 %>% filter(CC %in% emergencias & Item=="Total RRHH")  %>% group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p4 <- Cubo_9 %>% filter(CC %in% emergencias & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
i4 <- inner_join(i4,p4) %>%
mutate("Cod"=4, "Trazadora"="Atenciones de Emergencia", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"="", "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,"Costo por Actividad 2021"= round(`Gasto RRHH 2021`/`Producción 2021`)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021` )
# Ambulatorio -------------------------------------------------------------
i3 <- Cubo_9 %>% filter(CC %in% ambulatorio & Item=="Total RRHH")  %>% group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p3 <- Cubo_9 %>% filter(CC %in% ambulatorio & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p33 <- Cubo_9 %>% filter(CC %in% ambulatorio & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p3 <- data.frame(Fecha=p3$Fecha, "Producción 2021"= p3$`Producción 2021`+p33$`Producción 2021`)
colnames(p3)[2] <- "Producción 2021"
i3 <- inner_join(i3,p3) %>%
mutate("Cod"=3, "Trazadora"="Consultas de Especialidad", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"="", "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round(`Gasto RRHH 2021`/`Producción 2021`)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
# CMA ---------------------------------------------------------------------
i2 <- Cubo_9 %>% filter(CC %in% cma & Item=="Total RRHH")  %>% group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p2 <- Cubo_9 %>% filter(CC %in% cma & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
i2 <- inner_join(i2,p2) %>%
mutate("Cod"=2, "Trazadora"="Cirugía Mayor Ambulatoria", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"="", "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round(`Gasto RRHH 2021`/`Producción 2021`)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
# Hospitalizado -----------------------------------------------------------
i1 <- Cubo_9 %>% filter((CC %in% hospitalizacion | CC %in% hospitalizacion_qx | CC %in% hospitalizacion_uci) & Item=="Total RRHH")  %>%
group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p1 <- Cubo_9 %>% filter(CC %in% hospitalizacion & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p11 <-  Cubo_9 %>% filter(CC %in% hospitalizacion_uci & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p1 <- data.frame(Fecha=p1$Fecha, "Producción 2021"= p1$`Producción 2021`+p11$`Producción 2021`)
colnames(p1)[2] <- "Producción 2021"
i1 <- inner_join(i1,p1) %>%
mutate("Cod"=1, "Trazadora"="Hospitalización", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"= PM_GRD, "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round((`Gasto RRHH 2021`/`Producción 2021`)*PM_GRD)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
informe <- rbind(i1, i3, i2, i4)
openxlsx::write.xlsx(informe,paste0(ruta_base,"BBDD Produccion/PERC/PERC 2021/informe_mensual.xlsx"),
colNames = TRUE, sheetName = "Informe", overwrite = TRUE)
View(informe)
PM_GRD <- data.frame(Fecha=c("2021-01-01",
"2021-02-01",
"2021-03-01",
"2021-04-01",
"2021-05-01",
"2021-06-01",
"2021-07-01",
"2021-08-01",
"2021-09-01",
"2021-10-01",
"2021-11-01",
"2021-12-01"),
"Producción 2021"=c(1,1,1,1,1,1,1,1,1,1,1,1.2219))
View(PM_GRD)
i4 <- Cubo_9 %>% filter(CC %in% emergencias & Item=="Total RRHH")  %>% group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p4 <- Cubo_9 %>% filter(CC %in% emergencias & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
i4 <- inner_join(i4,p4) %>%
mutate("Cod"=4, "Trazadora"="Atenciones de Emergencia", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"="", "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,"Costo por Actividad 2021"= round(`Gasto RRHH 2021`/`Producción 2021`)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021` )
# Ambulatorio -------------------------------------------------------------
i3 <- Cubo_9 %>% filter(CC %in% ambulatorio & Item=="Total RRHH")  %>% group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p3 <- Cubo_9 %>% filter(CC %in% ambulatorio & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p33 <- Cubo_9 %>% filter(CC %in% ambulatorio & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p3 <- data.frame(Fecha=p3$Fecha, "Producción 2021"= p3$`Producción 2021`+p33$`Producción 2021`)
colnames(p3)[2] <- "Producción 2021"
i3 <- inner_join(i3,p3) %>%
mutate("Cod"=3, "Trazadora"="Consultas de Especialidad", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"="", "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round(`Gasto RRHH 2021`/`Producción 2021`)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
# CMA ---------------------------------------------------------------------
i2 <- Cubo_9 %>% filter(CC %in% cma & Item=="Total RRHH")  %>% group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p2 <- Cubo_9 %>% filter(CC %in% cma & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
i2 <- inner_join(i2,p2) %>%
mutate("Cod"=2, "Trazadora"="Cirugía Mayor Ambulatoria", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"="", "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round(`Gasto RRHH 2021`/`Producción 2021`)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
# Hospitalizado -----------------------------------------------------------
i1 <- Cubo_9 %>% filter((CC %in% hospitalizacion | CC %in% hospitalizacion_qx | CC %in% hospitalizacion_uci) & Item=="Total RRHH")  %>%
group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p1 <- Cubo_9 %>% filter(CC %in% hospitalizacion & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p11 <-  Cubo_9 %>% filter(CC %in% hospitalizacion_uci & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p1 <- data.frame(Fecha=p1$Fecha, "Producción 2021"= p1$`Producción 2021`+p11$`Producción 2021`)
colnames(p1)[2] <- "Producción 2021"
i1 <- inner_join(i1,p1) %>%
mutate("Cod"=1, "Trazadora"="Hospitalización", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"= PM_GRD, "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round((`Gasto RRHH 2021`/`Producción 2021`)*PM_GRD)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
informe <- rbind(i1, i3, i2, i4)
openxlsx::write.xlsx(informe,paste0(ruta_base,"BBDD Produccion/PERC/PERC 2021/informe_mensual.xlsx"),
colNames = TRUE, sheetName = "Informe", overwrite = TRUE)
View(PM_GRD)
i1 <- Cubo_9 %>% filter((CC %in% hospitalizacion | CC %in% hospitalizacion_qx | CC %in% hospitalizacion_uci) & Item=="Total RRHH")  %>%
group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p1 <- Cubo_9 %>% filter(CC %in% hospitalizacion & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p11 <-  Cubo_9 %>% filter(CC %in% hospitalizacion_uci & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p1 <- data.frame(Fecha=p1$Fecha, "Producción 2021"= p1$`Producción 2021`+p11$`Producción 2021`)
colnames(p1)[2] <- "Producción 2021"
i1 <- inner_join(i1,p1) %>%
mutate("Cod"=1, "Trazadora"="Hospitalización", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"= PM_GRD, "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round((`Gasto RRHH 2021`/`Producción 2021`)*PM_GRD$Producción.2021)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
View(PM_GRD)
View(i1)
informe <- rbind(i1, i3, i2, i4)
openxlsx::write.xlsx(informe,paste0(ruta_base,"BBDD Produccion/PERC/PERC 2021/informe_mensual.xlsx"),
colNames = TRUE, sheetName = "Informe", overwrite = TRUE)
View(i2)
View(i1)
View(i3)
View(i3)
View(i1)
ambulatorio <- c(
"274-CONSULTA NEUROLOGÍA",
"275-CONSULTA REUMATOLOGÍA",
"276-CONSULTA CARDIOLOGÍA",
"277-CONSULTA DERMATOLOGÍA",
"278-CONSULTA ONCOLOGÍA",
"280-CONSULTA PSIQUIATRÍA",
"281-CONSULTA ENDOCRINOLOGÍA",
"282-CONSULTA NEUMOLOGÍA",
"284-CONSULTA INFECTOLOGÍA",
"285-CONSULTA NEFROLOGÍA",
"286-CONSULTA GENÉTICA",
"287-CONSULTA HEMATOLOGÍA",
"288-CONSULTA GERIATRÍA",
"289-CONSULTA FISIATRÍA",
"290-CONSULTA GASTROENTEROLOGÍA",
"292-CONSULTA NEUROCIRUGÍA",
"294-PROGRAMA MANEJO DEL DOLOR",
"295-CONSULTA SALUD OCUPACIONAL",
"296-CONSULTA ANESTESIOLOGIA",
"306-CONSULTA HEMATOLOGÍA ONCOLÓGICA",
"307-CONSULTA DE INMUNOLOGÍA",
"309-CONSULTA CIRUGÍA GENERAL",
"311-CONSULTA UROLOGÍA",
"316-CONSULTA CIRUGÍA PLÁSTICA",
"317-CONSULTA OFTALMOLOGÍA",
"318-CONSULTA CIRUGÍA VASCULAR PERIFÉRICA",
"319-CONSULTA OTORRINOLARINGOLOGÍA",
"323-CONSULTA CIRUGÍA MAXILOFACIAL",
"326-CONSULTA DE TRAUMATOLOGÍA",
"328-CONSULTA PEDIATRÍA GENERAL",
"329-CONSULTA NEONATOLOGÍA",
"331-CONSULTA NEUROLOGÍA PEDIÁTRICA",
"342-CONSULTA TRAUMATOLOGÍA PEDIÁTRICA",
"351-CONSULTA CIRUGÍA PEDIÁTRICA",
"353-CONSULTA GINECOLOGICA",
"354-CONSULTA OBSTETRICIA",
"230-CONSULTA NUTRICIÓN",
"232-CONSULTA OTROS PROFESIONALES")
cma <- c("465-QUIRÓFANO AMBULATORIO DE EMERGENCIA",
"471-QUIRÓFANOS MAYOR AMBULATORIA")
hospitalizacion <- c(
"65-HOSPITALIZACIÓN PENSIONADOS",
"66-HOSPITALIZACIÓN MEDICINA INTERNA",
"72-HOSPITALIZACIÓN NEUROLOGÍA",
"87-HOSPITALIZACIÓN ONCOLOGÍA",
"90-HOSPITALIZACIÓN QUIRÚRGICA",
"96-HOSPITALIZACIÓN UROLOGÍA",
"98-HOSPITALIZACIÓN NEUROCIRUGÍA",
"99-HOSPITALIZACIÓN OFTALMOLOGÍA",
"100-HOSPITALIZACIÓN OTORRINOLARINGOLOGÍA",
"111-HOSPITALIZACIÓN TRAUMATOLOGÍA",
"113-HOSPITALIZACIÓN OBSTETRICIA",
"114-HOSPITALIZACIÓN GINECOLOGÍA",
"116-HOSPITALIZACIÓN PEDIATRÍA",
"130-HOSPITALIZACIÓN TRAUMATOLOGÍA PEDIÁTRICA",
"136-HOSPITALIZACIÓN NEUROCIRUGÍA PEDIÁTRICA",
"149-HOSPITALIZACIÓN PSIQUIATRÍA")
hospitalizacion_uci <- c("166-UNIDAD DE CUIDADOS INTENSIVOS",
"169-UNIDAD DE CUIDADOS INTENSIVOS NEONATOS",
"170-UNIDAD DE CUIDADOS INTENSIVOS PEDIATRIA",
"180-UNIDAD DE CUIDADOS INTERMEDIOS ADULTOS",
"198-UNIDAD DE TRATAMIENTO INTENSIVO CORONARIOS")
hospitalizacion_qx <- c(
"462-QUIRÓFANOS CABEZA Y CUELLO",
"464-QUIRÓFANOS CARDIOVASCULAR",
"467-QUIRÓFANOS DIGESTIVA",
"470-QUIRÓFANOS GINECOLOGÍA",
"475-QUIRÓFANOS NEUROCIRUGÍA",
"476-QUIRÓFANOS OBSTETRICIA",
"477-QUIRÓFANOS ODONTOLOGICA",
"478-QUIRÓFANOS OFTALMOLOGÍA",
"480-QUIRÓFANOS OTORRINOLARINGOLOGÍA",
"483-QUIRÓFANOS PROCTOLOGÍA",
"484-QUIRÓFANOS TORACICA",
"485-QUIRÓFANOS TRAUMATOLOGÍA Y ORTOPEDIA",
"486-QUIRÓFANOS UROLOGÍA",
"487-QUIRÓFANOS VASCULAR",
"493-QUIRÓFANOS CIRUGÍA PLÁSTICA",
"494-QUIRÓFANOS CIRUGÍA TORACICA",
"495-QUIRÓFANOS CIRUGÍA VASCULAR",
"797-QUIROFANOS CIRUGIA CARDIACA")
emergencias <- c("216-EMERGENCIAS PEDIÁTRICAS",
"357-EMERGENCIAS ODONTOLOGICAS")
# Urgencia ----------------------------------------------------------------
i4 <- Cubo_9 %>% filter(CC %in% emergencias & Item=="Total RRHH")  %>% group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p4 <- Cubo_9 %>% filter(CC %in% emergencias & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
i4 <- inner_join(i4,p4) %>%
mutate("Cod"=4, "Trazadora"="Atenciones de Emergencia", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"="", "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,"Costo por Actividad 2021"= round(`Gasto RRHH 2021`/`Producción 2021`)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021` )
# Ambulatorio -------------------------------------------------------------
i3 <- Cubo_9 %>% filter(CC %in% ambulatorio & Item=="Total RRHH")  %>% group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p3 <- Cubo_9 %>% filter(CC %in% ambulatorio & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p33 <- Cubo_9 %>% filter(CC %in% ambulatorio & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p3 <- data.frame(Fecha=p3$Fecha, "Producción 2021"= p3$`Producción 2021`+p33$`Producción 2021`)
colnames(p3)[2] <- "Producción 2021"
i3 <- inner_join(i3,p3) %>%
mutate("Cod"=3, "Trazadora"="Consultas de Especialidad", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"="", "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round(`Gasto RRHH 2021`/`Producción 2021`)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
# CMA ---------------------------------------------------------------------
i2 <- Cubo_9 %>% filter(CC %in% cma & Item=="Total RRHH")  %>% group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p2 <- Cubo_9 %>% filter(CC %in% cma & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
i2 <- inner_join(i2,p2) %>%
mutate("Cod"=2, "Trazadora"="Cirugía Mayor Ambulatoria", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"="", "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round(`Gasto RRHH 2021`/`Producción 2021`)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
# Hospitalizado -----------------------------------------------------------
i1 <- Cubo_9 %>% filter((CC %in% hospitalizacion | CC %in% hospitalizacion_qx | CC %in% hospitalizacion_uci) & Item=="Total RRHH")  %>%
group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p1 <- Cubo_9 %>% filter(CC %in% hospitalizacion & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p11 <-  Cubo_9 %>% filter(CC %in% hospitalizacion_uci & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p1 <- data.frame(Fecha=p1$Fecha, "Producción 2021"= p1$`Producción 2021`+p11$`Producción 2021`)
colnames(p1)[2] <- "Producción 2021"
i1 <- inner_join(i1,p1) %>%
mutate("Cod"=1, "Trazadora"="Hospitalización", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"= PM_GRD, "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round((`Gasto RRHH 2021`/`Producción 2021`)*PM_GRD$Producción.2021)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
informe <- rbind(i1, i3, i2, i4)
openxlsx::write.xlsx(informe,paste0(ruta_base,"BBDD Produccion/PERC/PERC 2021/informe_mensual.xlsx"),
colNames = TRUE, sheetName = "Informe", overwrite = TRUE)
View(i1)
View(i1)
View(i1)
i1[6]
i1[6]
i1[6,1]
View(i1)
View(i2)
View(i1)
1,2219
PM GRD 2021.Fecha
'PM GRD 2021.Fecha'
i1$`PM GRD 2021`
PM_GRD <- data.frame(Fecha=c("2021-01-01",
"2021-02-01",
"2021-03-01",
"2021-04-01",
"2021-05-01",
"2021-06-01",
"2021-07-01",
"2021-08-01",
"2021-09-01",
"2021-10-01",
"2021-11-01",
"2021-12-01"),
"PMGRD"=c(1,1,1,1,1,1,1,1,1,1,1,1.2219))
i1 <- Cubo_9 %>% filter((CC %in% hospitalizacion | CC %in% hospitalizacion_qx | CC %in% hospitalizacion_uci) & Item=="Total RRHH")  %>%
group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p1 <- Cubo_9 %>% filter(CC %in% hospitalizacion & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p11 <-  Cubo_9 %>% filter(CC %in% hospitalizacion_uci & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p1 <- data.frame(Fecha=p1$Fecha, "Producción 2021"= p1$`Producción 2021`+p11$`Producción 2021`)
colnames(p1)[2] <- "Producción 2021"
i1 <- inner_join(i1,p1) %>%
mutate("Cod"=1, "Trazadora"="Hospitalización", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"= PM_GRD, "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round((`Gasto RRHH 2021`/`Producción 2021`)*PM_GRD$PMGRD)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
informe <- rbind(i1, i3, i2, i4)
openxlsx::write.xlsx(informe,paste0(ruta_base,"BBDD Produccion/PERC/PERC 2021/informe_mensual.xlsx"),
colNames = TRUE, sheetName = "Informe", overwrite = TRUE)
i1[6,1]
View(i1)
PM_GRD <- data.frame(FechaGRD=c("2021-01-01",
"2021-02-01",
"2021-03-01",
"2021-04-01",
"2021-05-01",
"2021-06-01",
"2021-07-01",
"2021-08-01",
"2021-09-01",
"2021-10-01",
"2021-11-01",
"2021-12-01"),
"PMGRD"=c(1,1,1,1,1,1,1,1,1,1,1,1.2219))
i1 <- Cubo_9 %>% filter((CC %in% hospitalizacion | CC %in% hospitalizacion_qx | CC %in% hospitalizacion_uci) & Item=="Total RRHH")  %>%
group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p1 <- Cubo_9 %>% filter(CC %in% hospitalizacion & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p11 <-  Cubo_9 %>% filter(CC %in% hospitalizacion_uci & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p1 <- data.frame(Fecha=p1$Fecha, "Producción 2021"= p1$`Producción 2021`+p11$`Producción 2021`)
colnames(p1)[2] <- "Producción 2021"
i1 <- inner_join(i1,p1) %>%
mutate("Cod"=1, "Trazadora"="Hospitalización", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"= PM_GRD, "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round((`Gasto RRHH 2021`/`Producción 2021`)*PM_GRD$PMGRD)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
View(i1)
i1 <- Cubo_9 %>% filter((CC %in% hospitalizacion | CC %in% hospitalizacion_qx | CC %in% hospitalizacion_uci) & Item=="Total RRHH")  %>%
group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p1 <- Cubo_9 %>% filter(CC %in% hospitalizacion & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p11 <-  Cubo_9 %>% filter(CC %in% hospitalizacion_uci & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p1 <- data.frame(Fecha=p1$Fecha, "Producción 2021"= p1$`Producción 2021`+p11$`Producción 2021`)
colnames(p1)[2] <- "Producción 2021"
i1 <- inner_join(i1,p1) %>%
mutate("Cod"=1, "Trazadora"="Hospitalización", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"= PM_GRD, "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round((`Gasto RRHH 2021`/`Producción 2021`)*PM_GRD$PMGRD)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`, -PM_GRD.FechaGRD)
i1 <- Cubo_9 %>% filter((CC %in% hospitalizacion | CC %in% hospitalizacion_qx | CC %in% hospitalizacion_uci) & Item=="Total RRHH")  %>%
group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p1 <- Cubo_9 %>% filter(CC %in% hospitalizacion & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p11 <-  Cubo_9 %>% filter(CC %in% hospitalizacion_uci & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p1 <- data.frame(Fecha=p1$Fecha, "Producción 2021"= p1$`Producción 2021`+p11$`Producción 2021`)
colnames(p1)[2] <- "Producción 2021"
View(i1)
PM_GRD <- "PMGRD"=c(1,1,1,1,1,1,1,1,1,1,1,1.2219)
PM_GRD <- c(1,1,1,1,1,1,1,1,1,1,1,1.2219)
i1 <- Cubo_9 %>% filter((CC %in% hospitalizacion | CC %in% hospitalizacion_qx | CC %in% hospitalizacion_uci) & Item=="Total RRHH")  %>%
group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p1 <- Cubo_9 %>% filter(CC %in% hospitalizacion & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p11 <-  Cubo_9 %>% filter(CC %in% hospitalizacion_uci & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p1 <- data.frame(Fecha=p1$Fecha, "Producción 2021"= p1$`Producción 2021`+p11$`Producción 2021`)
colnames(p1)[2] <- "Producción 2021"
i1 <- inner_join(i1,p1) %>%
mutate("Cod"=1, "Trazadora"="Hospitalización", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"= PM_GRD, "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round((`Gasto RRHH 2021`/`Producción 2021`)*PM_GRD$PMGRD)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
i1 <- Cubo_9 %>% filter((CC %in% hospitalizacion | CC %in% hospitalizacion_qx | CC %in% hospitalizacion_uci) & Item=="Total RRHH")  %>%
group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p1 <- Cubo_9 %>% filter(CC %in% hospitalizacion & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p11 <-  Cubo_9 %>% filter(CC %in% hospitalizacion_uci & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p1 <- data.frame(Fecha=p1$Fecha, "Producción 2021"= p1$`Producción 2021`+p11$`Producción 2021`)
colnames(p1)[2] <- "Producción 2021"
i1 <- inner_join(i1,p1) %>%
mutate("Cod"=1, "Trazadora"="Hospitalización", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"= PM_GRD, "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round((`Gasto RRHH 2021`/`Producción 2021`)*PM_GRD$PM_GRD)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
i1 <- Cubo_9 %>% filter((CC %in% hospitalizacion | CC %in% hospitalizacion_qx | CC %in% hospitalizacion_uci) & Item=="Total RRHH")  %>%
group_by(Fecha) %>% summarise("Gasto RRHH 2021" = sum(total))
p1 <- Cubo_9 %>% filter(CC %in% hospitalizacion & Item=="p1")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p11 <-  Cubo_9 %>% filter(CC %in% hospitalizacion_uci & Item=="p3")  %>% group_by(Fecha) %>% summarise("Producción 2021" = sum(total))
p1 <- data.frame(Fecha=p1$Fecha, "Producción 2021"= p1$`Producción 2021`+p11$`Producción 2021`)
colnames(p1)[2] <- "Producción 2021"
i1 <- inner_join(i1,p1) %>%
mutate("Cod"=1, "Trazadora"="Hospitalización", "Mes-Año"=Fecha, "Establecimiento"="HOSPITAL DE NIÑOS ROBERTO DEL RÍO",
"Código DEIS"="109101", "PM GRD 2021"= PM_GRD, "Gasto RRHH 2021"=`Gasto RRHH 2021`,"Producción 2021"=`Producción 2021`,
"Costo por Actividad 2021"= round((`Gasto RRHH 2021`/`Producción 2021`)*PM_GRD)) %>%
select(Cod, Trazadora, `Mes-Año`, Establecimiento, `Código DEIS`, `PM GRD 2021`, `Gasto RRHH 2021`, `Producción 2021`,`Costo por Actividad 2021`)
informe <- rbind(i1, i3, i2, i4)
openxlsx::write.xlsx(informe,paste0(ruta_base,"BBDD Produccion/PERC/PERC 2021/informe_mensual.xlsx"),
colNames = TRUE, sheetName = "Informe", overwrite = TRUE)
View(informe)
