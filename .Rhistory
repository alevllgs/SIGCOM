CxCC <- CxCC %>% inner_join(SIGFE, by = "item_presupuestario") %>% select(-consumido, -Devengado, -`ITEM PRESUPUESTARIO`, -COD.PRODUCTO, -`COD. CENTRO COSTO`, -RUBRO, -BODEGA) %>% mutate(pxq = PRECIO*`CANTIDAD DESPACHADA`)
CxCC <- CxCC %>% inner_join(consumo_interno, by = c(`CENTRO DE COSTO` = "cc_hospital"))
consumido <- SIGFE %>% filter(consumido == "esta")
consolidado <- data.frame(
"Centro de Costo" = "eliminar",
"Devengado" = 0,
"Cuenta" = "eliminar",
"Tipo" = 1)
aux_prorrateo <- CxCC %>% filter(SIGCOM == i)
aux_prorrateo$prop <- prop.table(aux_prorrateo$pxq)
aux_prorrateo <- aux_prorrateo %>%
group_by ("cc_sigcom" = cc_sigcom) %>%
summarise("prop" = sum(prop)) %>%
ungroup()
valor_sigfe <- sum(ifelse(SIGFE$SIGCOM == i, SIGFE$Devengado, 0))
tabla_prorrateo <- aux_prorrateo %>%
mutate("Centro de Costo" = cc_sigcom , "Devengado" = prop*valor_sigfe, "Cuenta" = i,
"Tipo" = 2)
consolidado <- rbind(consolidado, tabla_prorrateo)
aux_prorrateo <- CxCC %>% filter(SIGCOM == i)
aux_prorrateo$prop <- prop.table(aux_prorrateo$pxq)
aux_prorrateo <- aux_prorrateo %>%
group_by ("cc_sigcom" = cc_sigcom) %>%
summarise("prop" = sum(prop)) %>%
ungroup()
valor_sigfe <- sum(ifelse(SIGFE$SIGCOM == i, SIGFE$Devengado, 0))
tabla_prorrateo <- aux_prorrateo %>%
mutate("Centro de Costo" = cc_sigcom , "Devengado" = prop*valor_sigfe, "Cuenta" = i,
"Tipo" = 2) %>% select(-cc_sigcom, -prop)
consolidado <- rbind(consolidado, tabla_prorrateo)
colnames(consolidado)[1] <- "Centro de Costo"
consolidado <- rbind(consolidado, tabla_prorrateo)
consolidado <- rbind(consolidado, tabla_prorrateo) %>% filter(cuenta != "eliminar")
consolidado <- consolidado %>%  filter(cuenta != "eliminar")
onsolidado <- rbind(consolidado, tabla_prorrateo) %>%  filter(Cuenta != "eliminar")
consolidado <- rbind(consolidado, tabla_prorrateo) %>%  filter(Cuenta != "eliminar")
library(tidyverse)
library(readxl)
library(lubridate)
library(janitor)
library(dplyr)
library(openxlsx)
library(xlsx)
# SIGFE listas-------------------------------------------------------------------
anio <- "2023"
mes_archivo <- "01"
ruta_base <- "C:/Users/control.gestion3/OneDrive/"
resto <- "BBDD Produccion/PERC/PERC 2023/"
mes_completo <- c("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre")
mes_completo <- mes_completo[as.numeric(mes_archivo)]
options(scipen=999)
SIGFE <- read_excel(paste0(ruta_base,resto,mes_archivo," ",mes_completo,"/Insumos de Informacion/01 Ejecucion Presupuestaria.xlsx"), skip = 6)
ConsumoxCC <- paste0(ruta_base,resto,mes_archivo," ",mes_completo,"/Insumos de Informacion/02 Consumo x CC del mes.xlsx")
Cant_RRHH <- paste0(ruta_base,resto,mes_archivo," ",mes_completo,"/Insumos de Informacion/912_SIRH_R.xlsx")
Farmacia <- paste0(ruta_base,resto,mes_archivo," ",mes_completo,"/Insumos de Informacion/900_gasto_farmacia.xlsx")
graba <- paste0(ruta_base,resto,mes_archivo," ",mes_completo,"/Insumos de Informacion/920_SIGFE_R.xlsx")
CxCC_H <- paste0(ruta_base,resto,"/Insumos de info anual/CxCC_historico.xlsx")
Asignaciones <- paste0(ruta_base,resto,"/Insumos de info anual/Asignaciones.xlsx")
M2 <- paste0(ruta_base,resto,"/Insumos de info anual/M2.xlsx")
M2Pab <- paste0(ruta_base,resto,mes_archivo," ",mes_completo,"/Insumos de Informacion/89_Pabellon.xlsx")
EqMed <- paste0(ruta_base,resto,mes_archivo," ",mes_completo,"/Insumos de Informacion/99_Equipos_Medicos.xlsx")
item <- paste0(ruta_base,resto,"/Insumos de info anual/item_presupuestarios_centros_de_costo.xlsx")
SIGFE2 <- str_split_fixed(SIGFE$`Concepto Presupuestario`, " ", n=2)
SIGFE <- cbind(SIGFE, SIGFE2)
SIGFE <- SIGFE %>% mutate("Codigo Base" = `1`, "Subtitulo" = substr(`1`, start = 1, stop = 2))
SIGFE <- SIGFE %>% filter(Subtitulo == "22") %>%
select("Codigo Base", Requerimiento, Compromiso, Devengado, Efectivo)
insumos <- c("22",
"2201",
"2201001",
"2201001001",
"2201001002",
"2201001003",
"2201002",
"2202",
"2202001",
"2202002",
"2202002001",
"2202002002",
"2202003",
"2203",
"2203001",
"2203002",
"2203003",
"2203999",
"2204",
"2204001",
"2204002",
"2204003",
"2204003001",
"2204003002",
"2204004",
"2204004001",
"220400400101",
"220400400102",
"220400400103",
"2204004002",
"2204004003",
"2204004004",
"2204004005",
"2204004006",
"2204005",
"2204005001",
"2204005002",
"2204005003",
"2204007",
"2204007002",
"2204008",
"2204009",
"2204010",
"2204011",
"2204012",
"2204013",
"2204015")
ggenerales <- c("2204006",
"2204007001",
"2204014",
"2204999",
"2205",
"2205001",
"2205002",
"2205003",
"2205004",
"2205005",
"2205006",
"2205007",
"2205999",
"2206",
"2206001",
"2206002",
"2206003",
"2206004",
"2206005",
"2206006",
"2206006001",
"2206006002",
"2206007",
"2206999",
"2207",
"2207001",
"2207002",
"2207003",
"2207999",
"2208",
"2208001",
"2208002",
"2208003",
"2208007",
"2208008",
"2208009",
"2208010",
"2208999",
"2209",
"2209001",
"2209002",
"2209003",
"2209004",
"2209005",
"2209005001",
"2209005002",
"2209006",
"2209999",
"2210",
"2210001",
"2210002",
"2210003",
"2210004",
"2210999",
"2211",
"2211001",
"2211002",
"2211002001",
"221100200101",
"221100200102",
"221100200103",
"221100200201",
"221100200202",
"221100200203",
"221100200301",
"221100200302",
"221100200303",
"221100200401",
"221100200402",
"221100200403",
"221100200501",
"221100200502",
"221100200503",
"221100200601",
"221100200602",
"2211003",
"2211999",
"2212",
"2212002",
"2212003",
"2212004",
"2212005",
"2212006",
"2212999",
"2212999001",
"2212999002",
"221299900201",
"221299900202",
"2212999003",
"221299900302",
"2212999004",
"2212999005",
"2212999006",
"221299900601",
"221299900602",
"221299900603",
"2212999009",
"221299900901",
"221299900902",
"221299900903",
"2212999010",
"2212999011",
"2212999014",
"221299901401",
"221299901402",
"2212999015",
"2212999017",
"2212999019",
"2212999016",
"2212999018",
"2212999020",
"2212999021",
"2212999022",
"2206002001",
"2206002002",
"2206002003",
"2206002004",
"2206002005",
"2206002006",
"2206005001",
"2206005002",
"2206006001",
"2206006003",
"2206006002",
"2206006004"
)
RRHH_sigfe <- c("221299900301",
"221299900302",
"221299901601",
"221299901602")
cuentas <- c("52-ARRENDAMIENTOS",
"60-COMPRA DE CAMAS AL EXTRA SISTEMA CAMAS NO CRÍTICAS",
"61-COMPRA DE CONSULTAS MÉDICAS",
"62-COMPRA DE CONSULTAS NO MÉDICAS",
"63-COMPRA DE INTERVENCIONES QUIRÚRGICAS CLÍNICAS",
"64-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL EXTERNO",
"65-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL INTERNO",
"66-COMPRA DE OTROS SERVICIOS",
"129-MANTENIMIENTO EQUIPO DE CÓMPUTO",
"131-MANTENIMIENTO MAQUINARIA Y EQUIPO",
"132-MANTENIMIENTO MUEBLES Y ENSERES",
"135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
"147-OTROS MANTENIMIENTOS",
"151-PASAJES, FLETES Y BODEGAJE",
"149-PASAJES Y TRASLADOS DE PACIENTES",
"178-SERVICIO DE LAVANDERÍA",
"3-COMBUSTIBLES Y LUBRICANTES",
"8-EQUIPOS MENORES",
"9-GASES MEDICINALES",
"11-LIBROS, TEXTOS, UTILES DE ENSEÑANZA Y PUBLICACIONES",
"15-MATERIAL DE ODONTOLOGÍA",
"16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
"18-MATERIAL MEDICO QUIRURGICO",
"21-MATERIALES DE CURACIÓN",
"24-MATERIALES DE OFICINA, PRODUCTOS DE PAPEL E IMPRESOS",
"25-MATERIALES DE USO O CONSUMO",
"27-MATERIALES INFORMATICOS",
"28-MATERIALES PARA MANTENIMIENTO Y REPARACIONES DE INMUEBLES",
"29-MATERIALES Y ELEMENTOS DE ASEO",
"31-MENAJE PARA OFICINA, CASINO Y OTROS",
"35-OTROS INSUMOS Y MATERIALES",
"41-PRODUCTOS QUÍMICOS",
"43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
"44-REPUESTOS Y ACCESORIOS PARA MANTENIMIENTO Y REPARACIONES DE VEHICULOS",
"46-VÍVERES")
# SIGFE Formulas ----------------------------------------------------------
SIGFE$`Codigo Base` <- as.character(SIGFE$`Codigo Base`)
colnames(SIGFE)[1] <- "cod_sigfe"
SIGFE <- SIGFE %>% select(cod_sigfe, Devengado) %>%
mutate(Tipo = case_when(cod_sigfe %in% insumos ~ "Insumos",
cod_sigfe %in% ggenerales ~ "Gastos Generales",
cod_sigfe %in% RRHH_sigfe ~ "RRHH Eliminar",
TRUE ~ "Asignar Centro de Costo")) %>%
mutate(SIGCOM = case_when(
#Insumos
cod_sigfe == "22" ~ "Familia",
cod_sigfe == "2201"~ "Familia",
cod_sigfe == "2201001"~ "Familia",
cod_sigfe == "2201001001"~ "46-VÍVERES",
cod_sigfe == "2201001002"~ "46-VÍVERES",
cod_sigfe == "2201001003"~ "46-VÍVERES",
cod_sigfe == "2201002"~ "46-VÍVERES",
cod_sigfe == "2202"~ "Familia",
cod_sigfe == "2202001"~ "43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
cod_sigfe == "2202002"~ "Familia",
cod_sigfe == "2202002001"~ "43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
cod_sigfe == "2202002002"~ "43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
cod_sigfe == "2202003"~ "43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
cod_sigfe == "2203"~ "Familia",
cod_sigfe == "2203001"~ "3-COMBUSTIBLES Y LUBRICANTES",
cod_sigfe == "2203002"~ "3-COMBUSTIBLES Y LUBRICANTES",
cod_sigfe == "2203003"~ "3-COMBUSTIBLES Y LUBRICANTES",
cod_sigfe == "2203999"~ "3-COMBUSTIBLES Y LUBRICANTES",
cod_sigfe == "2204"~ "Familia",
cod_sigfe == "2204001"~ "24-MATERIALES DE OFICINA, PRODUCTOS DE PAPEL E IMPRESOS",
cod_sigfe == "2204002"~ "11-LIBROS, TEXTOS, UTILES DE ENSEÑANZA Y PUBLICACIONES",
cod_sigfe == "2204003"~ "Familia",
cod_sigfe == "2204003001"~ "9-GASES MEDICINALES",
cod_sigfe == "2204003002"~ "41-PRODUCTOS QUÍMICOS",
cod_sigfe == "2204004"~ "Familia",
cod_sigfe == "2204004001"~ "Familia",
cod_sigfe == "220400400101"~ "30-MEDICAMENTOS",
cod_sigfe == "220400400102"~ "30-MEDICAMENTOS",
cod_sigfe == "220400400103"~ "30-MEDICAMENTOS",
cod_sigfe == "2204004002"~ "15-MATERIAL DE ODONTOLOGÍA",
cod_sigfe == "2204004003"~ "21-MATERIALES DE CURACIÓN",
cod_sigfe == "2204004004"~ "16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
cod_sigfe == "2204004005"~ "16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
cod_sigfe == "2204004006"~ "16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
cod_sigfe == "2204005"~ "Familia",
cod_sigfe == "2204005001"~ "18-MATERIAL MEDICO QUIRURGICO",
cod_sigfe == "2204005002"~ "18-MATERIAL MEDICO QUIRURGICO",
cod_sigfe == "2204005003"~ "18-MATERIAL MEDICO QUIRURGICO",
cod_sigfe == "2204007"~ "Familia",
cod_sigfe == "2204007002"~ "29-MATERIALES Y ELEMENTOS DE ASEO",
cod_sigfe == "2204008"~ "31-MENAJE PARA OFICINA, CASINO Y OTROS",
cod_sigfe == "2204009"~ "27-MATERIALES INFORMATICOS",
cod_sigfe == "2204010"~ "28-MATERIALES PARA MANTENIMIENTO Y REPARACIONES DE INMUEBLES",
cod_sigfe == "2204011"~ "44-REPUESTOS Y ACCESORIOS PARA MANTENIMIENTO Y REPARACIONES DE VEHICULOS",
cod_sigfe == "2204012"~ "35-OTROS INSUMOS Y MATERIALES",
cod_sigfe == "2204013"~ "8-EQUIPOS MENORES",
cod_sigfe == "2204015"~ "25-MATERIALES DE USO O CONSUMO",
#Gastos Generales
cod_sigfe == "2204006"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2204007001"~ "178-SERVICIO DE LAVANDERÍA",
cod_sigfe == "2204014"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2204999"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2205"~ "Familia",
cod_sigfe == "2205001"~ "92-SERVICIO DE ENERGÍA",
cod_sigfe == "2205002"~ "48-SERVICIO DE AGUA",
cod_sigfe == "2205003"~ "100-GAS PROPANO",
cod_sigfe == "2205004"~ "179-SERVICIO DE MENSAJERIA Y/O CORREO",
cod_sigfe == "2205005"~ "192-SERVICIO DE TELECOMUNICACIONES",
cod_sigfe == "2205006"~ "93-ENLACES DE TELECOMUNICACIONES",
cod_sigfe == "2205007"~ "93-ENLACES DE TELECOMUNICACIONES",
cod_sigfe == "2205999"~ "188-SERVICIOS GENERALES",
cod_sigfe == "2206"~ "Familia",
cod_sigfe == "2206001"~ "133-MANTENIMIENTO PLANTA FÍSICA",
cod_sigfe == "2206002"~ "Familia",
cod_sigfe == "2206002001"~ "135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
cod_sigfe == "2206002002"~ "135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
cod_sigfe == "2206002003"~ "135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
cod_sigfe == "2206002004"~ "135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
cod_sigfe == "2206002005"~ "135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
cod_sigfe == "2206002006"~ "135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
cod_sigfe == "2206003"~ "132-MANTENIMIENTO MUEBLES Y ENSERES",
cod_sigfe == "2206004"~ "131-MANTENIMIENTO MAQUINARIA Y EQUIPO",
cod_sigfe == "2206005"~ "Familia",
cod_sigfe == "2206005001"~ "131-MANTENIMIENTO MAQUINARIA Y EQUIPO",
cod_sigfe == "2206005002"~ "131-MANTENIMIENTO MAQUINARIA Y EQUIPO",
cod_sigfe == "2206006"~ "Familia",
cod_sigfe == "2206006001"~ "138-MANTENIMIENTO Y REPARACIÓN MÁQUINA Y EQUIPO PREVENTIVO",
cod_sigfe == "2206006002"~ "137-MANTENIMIENTO Y REPARACIÓN MÁQUINA Y EQUIPO CORRECTIVO",
cod_sigfe == "2206006003"~ "138-MANTENIMIENTO Y REPARACIÓN MÁQUINA Y EQUIPO PREVENTIVO",
cod_sigfe == "2206006004"~ "137-MANTENIMIENTO Y REPARACIÓN MÁQUINA Y EQUIPO CORRECTIVO",
cod_sigfe == "2206007"~ "129-MANTENIMIENTO EQUIPO DE CÓMPUTO",
cod_sigfe == "2206999"~ "147-OTROS MANTENIMIENTOS",
cod_sigfe == "2207"~ "Familia",
cod_sigfe == "2207001"~ "158-PUBLICIDAD Y PROPAGANDA",
cod_sigfe == "2207002"~ "158-PUBLICIDAD Y PROPAGANDA",
cod_sigfe == "2207003"~ "158-PUBLICIDAD Y PROPAGANDA",
cod_sigfe == "2207999"~ "158-PUBLICIDAD Y PROPAGANDA",
cod_sigfe == "2208"~ "Familia",
cod_sigfe == "2208001"~ "170-SERVICIO DE ASEO",
cod_sigfe == "2208002"~ "182-SERVICIO DE VIGILANCIA Y SEGURIDAD",
cod_sigfe == "2208003"~ "128-MANTENIMIENTO DE PRADOS Y JARDINES",
cod_sigfe == "2208007"~ "151-PASAJES, FLETES Y BODEGAJE",
cod_sigfe == "2208008"~ "161-SALA CUNAS Y/O SERVICIOS INFANTILES",
cod_sigfe == "2208009"~ "188-SERVICIOS GENERALES",
cod_sigfe == "2208010"~ "188-SERVICIOS GENERALES",
cod_sigfe == "2208999"~ "188-SERVICIOS GENERALES",
cod_sigfe == "2209"~ "Familia",
cod_sigfe == "2209001"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209002"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209003"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209004"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209005"~ "Familia",
cod_sigfe == "2209005001"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209005002"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209006"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209999"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2210"~ "Familia",
cod_sigfe == "2210001"~ "168-SEGUROS GENERALES",
cod_sigfe == "2210002"~ "168-SEGUROS GENERALES",
cod_sigfe == "2210003"~ "168-SEGUROS GENERALES",
cod_sigfe == "2210004"~ "168-SEGUROS GENERALES",
cod_sigfe == "2210999"~ "168-SEGUROS GENERALES",
cod_sigfe == "2211"~ "Familia",
cod_sigfe == "2211001"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2211002"~ "Familia",
cod_sigfe == "2211002001"~ "Familia",
cod_sigfe == "221100200101"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200102"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200103"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200201"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200202"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200203"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200301"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200302"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200303"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200401"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200402"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200403"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200501"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200502"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200503"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200601"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200602"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "2211003"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2211999"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212"~ "Familia",
cod_sigfe == "2212002"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212003"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212004"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212005"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212006"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212999"~ "Familia",
cod_sigfe == "2212999001"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999002"~ "Familia",
cod_sigfe == "221299900201"~ "177-SERVICIO DE LABORATORIO",
cod_sigfe == "221299900202"~ "177-SERVICIO DE LABORATORIO",
cod_sigfe == "2212999003"~ "Familia",
cod_sigfe == "221299900302"~ "63-COMPRA DE INTERVENCIONES QUIRÚRGICAS CLÍNICAS",
cod_sigfe == "2212999004"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999005"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999006"~ "Familia",
cod_sigfe == "221299900601"~ "57-COLOCACIÓN FAMILIAR DE MENORES Y EXTRAHOSPITALARIA",
cod_sigfe == "221299900602"~ "57-COLOCACIÓN FAMILIAR DE MENORES Y EXTRAHOSPITALARIA",
cod_sigfe == "221299900603"~ "57-COLOCACIÓN FAMILIAR DE MENORES Y EXTRAHOSPITALARIA",
cod_sigfe == "2212999009"~ "Familia",
cod_sigfe == "221299900901"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "221299900902"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "221299900903"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212999010"~ "149-PASAJES Y TRASLADOS DE PACIENTES",
cod_sigfe == "2212999011"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212999014"~ "Familia",
cod_sigfe == "221299901401"~ "59-COMPRA DE CAMAS AL EXTRA SISTEMA CAMAS CRÍTICAS",
cod_sigfe == "221299901402"~ "60-COMPRA DE CAMAS AL EXTRA SISTEMA CAMAS NO CRÍTICAS",
cod_sigfe == "2212999015" ~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999017" ~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212999019" ~ "176-SERVICIO DE INTERMEDIACIÓN CENABAST",
#RRHH
cod_sigfe == "221299900301"~ "65-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL INTERNO",
cod_sigfe == "221299900302"~ "64-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL EXTERNO",
cod_sigfe == "2212999016" ~ "Familia",
cod_sigfe == "221299901601" ~ "61-COMPRA DE CONSULTAS MÉDICAS",
cod_sigfe == "221299901602" ~ "62-COMPRA DE CONSULTAS NO MÉDICAS",
cod_sigfe == "2212999018" ~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999020" ~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999021" ~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999022" ~ "66-COMPRA DE OTROS SERVICIOS",
TRUE ~ "Asignar Centro de Costo")) %>%
filter(SIGCOM != "Familia" & Devengado>0)
# Consumo por CC ----------------------------------------------------------
#Agrupa las cuentas de SIGFE
SIGFE_agrupado <- SIGFE %>%
group_by ("Item" = SIGCOM) %>%
summarise("Devengado" = sum(Devengado)) %>%
ungroup()
CxCC <- read_excel(ConsumoxCC, range = "A3:M5000", na = "eliminar")
item_pres_int <- read_excel(item, sheet = "item_presupuestario")
item_pres_int$cod_sigfe <- as.character(item_pres_int$cod_sigfe)
#Verifican que esten todos los CC y los item presupuestarios
CxCC_no_asignado <- CxCC
CxCC_no_asignado$no_asignado <- ifelse(CxCC$`ITEM PRESUPUESTARIO` %in% item_pres_int$item_presupuestario, "esta", "no esta")
CxCC_no_asignado <- CxCC_no_asignado %>% filter(`ITEM PRESUPUESTARIO` != "NA" & no_asignado == "no esta")
consumo_interno <- read_excel(item, sheet = "centros_de_costos")
Cent_Cost_no_asignado <- CxCC
Cent_Cost_no_asignado$no_asignado <- ifelse(Cent_Cost_no_asignado$`CENTRO DE COSTO` %in% consumo_interno$cc_hospital, "esta", "no esta")
Cent_Cost_no_asignado <- Cent_Cost_no_asignado %>% filter(`ITEM PRESUPUESTARIO` != "NA" & no_asignado == "no esta")
SIGFE <- SIGFE %>% inner_join(item_pres_int, by = "cod_sigfe") %>% select(-item_sigcom)
SIGFE$consumido <- ifelse(SIGFE$item_presupuestario %in% as.character(CxCC$`ITEM PRESUPUESTARIO`), "esta", "no esta")
CxCC$item_presupuestario <- as.character(CxCC$`ITEM PRESUPUESTARIO`)
CxCC <- CxCC %>% inner_join(SIGFE, by = "item_presupuestario") %>% select(-consumido, -Devengado, -`ITEM PRESUPUESTARIO`, -COD.PRODUCTO, -`COD. CENTRO COSTO`, -RUBRO, -BODEGA) %>% mutate(pxq = PRECIO*`CANTIDAD DESPACHADA`)
CxCC <- CxCC %>% inner_join(consumo_interno, by = c(`CENTRO DE COSTO` = "cc_hospital"))
consumido <- SIGFE %>% filter(consumido == "esta")
consolidado <- data.frame(
"Centro de Costo" = "eliminar",
"Devengado" = 0,
"Cuenta" = "eliminar",
"Tipo" = 1)
colnames(consolidado)[1] <- "Centro de Costo"
for (i in cuentas) {
if(i %in% consumido$SIGCOM){
aux_prorrateo <- CxCC %>% filter(SIGCOM == i)
aux_prorrateo$prop <- prop.table(aux_prorrateo$pxq)
aux_prorrateo <- aux_prorrateo %>%
group_by ("cc_sigcom" = cc_sigcom) %>%
summarise("prop" = sum(prop)) %>%
ungroup()
valor_sigfe <- sum(ifelse(SIGFE$SIGCOM == i, SIGFE$Devengado, 0))
tabla_prorrateo <- aux_prorrateo %>%
mutate("Centro de Costo" = cc_sigcom , "Devengado" = prop*valor_sigfe, "Cuenta" = i,
"Tipo" = 2) %>% select(-cc_sigcom, -prop)
consolidado <- rbind(consolidado, tabla_prorrateo) %>%  filter(Cuenta != "eliminar")
}
}
View(consolidado)
