B_qx16 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!O2870:X2870")
B_qx16 <- B_qx16 %>%  add_column("Fecha" = Fecha_filtro, .after = 10) %>%
add_column("Centro de Producción" = "485__33026 - QUIRÓFANOS TRAUMATOLOGÍA Y ORTOPEDIA", .after = 11) %>%
add_column("Unidades de Producción" = "1__Intervencion quirurgica", .after = 12) %>%
add_column("Valor" = B_qx16$...1 + B_qx16$...10, .after = 13)
B_qxCMA <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!O2870:X2870")  #lee cualquier rango solo para darle la forma
B_qxCMA <- B_qxCMA %>%  add_column("Fecha" = Fecha_filtro, .after = 10) %>%
add_column("Centro de Producción" = "471__33012 - QUIRÓFANOS MAYOR AMBULATORIA", .after = 11) %>%
add_column("Unidades de Producción" = "1__Intervencion quirurgica", .after = 12) %>%
add_column("Valor" = B_qx1$...4 + B_qx2$...4 + B_qx3$...4 + B_qx4$...4 + B_qx5$...4 + B_qx6$...4 +
B_qx7$...4 + B_qx8$...4 + B_qx9$...4 + B_qx10$...4 + B_qx11$...4 + B_qx12$...4 +
B_qx13$...4 + B_qx14$...4 + B_qx15$...4 + B_qx16$...4, .after = 13)
B_qx <- rbind(B_qx1,B_qx2,B_qx3,B_qx4,B_qx5,B_qx6,B_qx7,B_qx8,B_qx9, B_qx10,
B_qx11,B_qx12,B_qx13,B_qx14,B_qx15,B_qx16,B_qxCMA)
rm(B_qx1,B_qx2,B_qx3,B_qx4,B_qx5,B_qx6,B_qx7,B_qx8,B_qx9, B_qx10,
B_qx11,B_qx12,B_qx13,B_qx14,B_qx15,B_qx16, B_qxCMA)
B_qx <- B_qx %>% group_by(Fecha, `Centro de Producción`, `Unidades de Producción`) %>%
summarise("Valor" = sum(Valor))
# Procedimientos -----------------------------------------------------------
P1 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!C1145:C1145")
P1 <- P1 %>%  add_column("Fecha" = Fecha_filtro, .after = 1) %>%
add_column("Centro de Producción" = "331__15305 - CONSULTA NEUROLOGÍA PEDIÁTRICA", .after = 2) %>%
add_column("Unidades de Producción" = "2__Procedimiento", .after = 3) %>%
add_column("Valor" = P1$...1,  .after = 4)
P2 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!C1271:C1271")
P2 <- P2 %>%  add_column("Fecha" = Fecha_filtro, .after = 1) %>%
add_column("Centro de Producción" = "317__15209 - CONSULTA OFTALMOLOGÍA", .after = 2) %>%
add_column("Unidades de Producción" = "2__Procedimiento", .after = 3) %>%
add_column("Valor" = P2$...1,  .after = 4)
P3 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!C1424:C1424")
P3 <- P3 %>%  add_column("Fecha" = Fecha_filtro, .after = 1) %>%
add_column("Centro de Producción" = "319__15211 - CONSULTA OTORRINOLARINGOLOGÍA", .after = 2) %>%
add_column("Unidades de Producción" = "2__Procedimiento", .after = 3) %>%
add_column("Valor" = P3$...1,  .after = 4)
P4 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!C1653:C1653")
P4 <- P4 %>%  add_column("Fecha" = Fecha_filtro, .after = 1) %>%
add_column("Centro de Producción" = "277__15106 - CONSULTA DERMATOLOGÍA", .after = 2) %>%
add_column("Unidades de Producción" = "2__Procedimiento", .after = 3) %>%
add_column("Valor" = P4$...1,  .after = 4)
P5 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!C2246:C2246")
P5 <- P5 %>%  add_column("Fecha" = Fecha_filtro, .after = 1) %>%
add_column("Centro de Producción" = "311__15203 - CONSULTA UROLOGÍA", .after = 2) %>%
add_column("Unidades de Producción" = "2__Procedimiento", .after = 3) %>%
add_column("Valor" = P5$...1,  .after = 4)
P6 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!C1812:C1812")
P6 <- P6 %>%  add_column("Fecha" = Fecha_filtro, .after = 1) %>%
add_column("Centro de Producción" = "276__15105 - CONSULTA CARDIOLOGÍA", .after = 2) %>%
add_column("Unidades de Producción" = "2__Procedimiento", .after = 3) %>%
add_column("Valor" = P6$...1,  .after = 4)
P7 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!C1682:C1701")
P7 <- P7 %>%  add_column("Fecha" = Fecha_filtro, .after = 1) %>%
add_column("Centro de Producción" = "276__15105 - CONSULTA CARDIOLOGÍA", .after = 2) %>%
add_column("Unidades de Producción" = "2__Procedimiento", .after = 3) %>%
add_column("Valor" = P7$...1,  .after = 4)
P8 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!C1712:C1785")
P8 <- P8 %>%  add_column("Fecha" = Fecha_filtro, .after = 1) %>%
add_column("Centro de Producción" = "282__15111 - CONSULTA NEUMOLOGÍA", .after = 2) %>%
add_column("Unidades de Producción" = "2__Procedimiento", .after = 3) %>%
add_column("Valor" = P8$...1,  .after = 4)
P9 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!C2056:C2056")
P9 <- P9 %>%  add_column("Fecha" = Fecha_filtro, .after = 1) %>%
add_column("Centro de Producción" = "290__15119 - CONSULTA GASTROENTEROLOGÍA", .after = 2) %>%
add_column("Unidades de Producción" = "2__Procedimiento", .after = 3) %>%
add_column("Valor" = P9$...1,  .after = 4)
P10 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!C2062:C2062")
P10 <- P10 %>%  add_column("Fecha" = Fecha_filtro, .after = 1) %>%
add_column("Centro de Producción" = "290__15119 - CONSULTA GASTROENTEROLOGÍA", .after = 2) %>%
add_column("Unidades de Producción" = "2__Procedimiento", .after = 3) %>%
add_column("Valor" = P10$...1,  .after = 4)
P11 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!C2453:C2453")
P11 <- P11 %>%  add_column("Fecha" = Fecha_filtro, .after = 1) %>%
add_column("Centro de Producción" = "342__15316 - CONSULTA TRAUMATOLOGÍA PEDIÁTRICA", .after = 2) %>%
add_column("Unidades de Producción" = "2__Procedimiento", .after = 3) %>%
add_column("Valor" = P11$...1,  .after = 4)
P12 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!C2684:C2684")
P12 <- P12 %>%  add_column("Fecha" = Fecha_filtro, .after = 1) %>%
add_column("Centro de Producción" = "342__15316 - CONSULTA TRAUMATOLOGÍA PEDIÁTRICA", .after = 2) %>%
add_column("Unidades de Producción" = "2__Procedimiento", .after = 3) %>%
add_column("Valor" = P12$...1,  .after = 4)
P13 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!C2363:C2363")
P13 <- P13 %>%  add_column("Fecha" = Fecha_filtro, .after = 1) %>%
add_column("Centro de Producción" = "353__15502 - CONSULTA GINECOLOGICA", .after = 2) %>%
add_column("Unidades de Producción" = "2__Procedimiento", .after = 3) %>%
add_column("Valor" = P13$...1,  .after = 4)
P14 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!C2416:C2416")
P14 <- P14 %>%  add_column("Fecha" = Fecha_filtro, .after = 1) %>%
add_column("Centro de Producción" = "353__15502 - CONSULTA GINECOLOGICA", .after = 2) %>%
add_column("Unidades de Producción" = "2__Procedimiento", .after = 3) %>%
add_column("Valor" = P14$...1,  .after = 4)
P15 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B17!C102:C102")
P15 <- P15 %>%  add_column("Fecha" = Fecha_filtro, .after = 1) %>%
add_column("Centro de Producción" = "306__15135 - CONSULTA HEMATOLOGÍA ONCOLÓGICA", .after = 2) %>%
add_column("Unidades de Producción" = "2__Procedimiento", .after = 3) %>%
add_column("Valor" = P15$...1,  .after = 4)
P16 <- read_xlsx(archivoBS, na = " ",col_names = FALSE,
range = "B!C1011:C1011")
P16 <- P16 %>%  add_column("Fecha" = Fecha_filtro, .after = 1) %>%
add_column("Centro de Producción" = "328__15302 - CONSULTA PEDIATRÍA GENERAL", .after = 2) %>%
add_column("Unidades de Producción" = "2__Procedimiento", .after = 3) %>%
add_column("Valor" = P16$...1,  .after = 4)
P <- rbind(P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, P14, P15, P16)
P <- P %>% group_by(Fecha, `Centro de Producción`, `Unidades de Producción`) %>%
summarise("Valor" = sum(Valor))
Produccion_SIGCOM <- rbind( Produccion_SIGCOM, P, B_qx)
# Remotas -----------------------------------------------------------------
At_remota <- read_excel(remota, sheet = Sheet_remota)
At_remota <- At_remota %>% filter(ESTADO=="Asistente" & TIPO_INGRESO!="Control Abreviado") %>%
group_by(UNIDAD_ATENCION_DESC) %>%
count(UNIDAD_ATENCION_DESC) %>%  mutate(Fecha=Fecha_filtro,"Centro de Producción" = case_when(
UNIDAD_ATENCION_DESC == "Pediatria" ~ "328__15302 - CONSULTA PEDIATRÍA GENERAL",
UNIDAD_ATENCION_DESC == "Broncopulmonar Infantil" ~ "282__15111 - CONSULTA NEUMOLOGÍA",
UNIDAD_ATENCION_DESC == "Anestesiologia Infantil" ~ "296__15125 - CONSULTA ANESTESIOLOGIA",
UNIDAD_ATENCION_DESC == "Cardiologia Infantil" ~ "276__15105 - CONSULTA CARDIOLOGÍA",
UNIDAD_ATENCION_DESC == "Cirugia Plastica" ~ "316__15208 - CONSULTA CIRUGÍA PLÁSTICA",
UNIDAD_ATENCION_DESC == "Endocrinologia Infantil" ~ "281__15110 - CONSULTA ENDOCRINOLOGÍA",
UNIDAD_ATENCION_DESC == "Dermatologia Infantil" ~ "277__15106 - CONSULTA DERMATOLOGÍA",
UNIDAD_ATENCION_DESC == "Gastroenterologia Infantil" ~ "290__15119 - CONSULTA GASTROENTEROLOGÍA",
UNIDAD_ATENCION_DESC == "Ginecologia Infantil" ~ "328__15302 - CONSULTA PEDIATRÍA GENERAL",
UNIDAD_ATENCION_DESC == "Genetica Infantil" ~ "286__15115 - CONSULTA GENÉTICA",
UNIDAD_ATENCION_DESC == "Hemato-Oncologia" ~ "306__15135 - CONSULTA HEMATOLOGÍA ONCOLÓGICA",
UNIDAD_ATENCION_DESC == "Hemofilia Adulto" ~ "306__15135 - CONSULTA HEMATOLOGÍA ONCOLÓGICA",
UNIDAD_ATENCION_DESC == "Infectologia Infantil" ~ "284__15113 - CONSULTA INFECTOLOGÍA",
UNIDAD_ATENCION_DESC == "Nefrologia Infantil" ~ "285__15114 - CONSULTA NEFROLOGÍA",
UNIDAD_ATENCION_DESC == "Neurologia Infantil" ~ "331__15305 - CONSULTA NEUROLOGÍA PEDIÁTRICA",
UNIDAD_ATENCION_DESC == "Nutriologia Infantil" ~ "230__15008 - CONSULTA NUTRICIÓN",
UNIDAD_ATENCION_DESC == "Otorrinolaringologia" ~ "319__15211 - CONSULTA OTORRINOLARINGOLOGÍA",
UNIDAD_ATENCION_DESC == "Quemados *" ~ "316__15208 - CONSULTA CIRUGÍA PLÁSTICA",
UNIDAD_ATENCION_DESC == "Salud Mental" ~ "280__15109 - CONSULTA PSIQUIATRÍA",
UNIDAD_ATENCION_DESC == "Traumatologia Infantil" ~ "342__15316 - CONSULTA TRAUMATOLOGÍA PEDIÁTRICA",
UNIDAD_ATENCION_DESC == "Urologia Infantil" ~ "311__15203 - CONSULTA UROLOGÍA",
UNIDAD_ATENCION_DESC == "Reumatologia" ~ "275__15104 - CONSULTA REUMATOLOGÍA",
UNIDAD_ATENCION_DESC == "Diabetes" ~ "328__15302 - CONSULTA PEDIATRÍA GENERAL",
UNIDAD_ATENCION_DESC == "Hematologia Infantil" ~ "306__15135 - CONSULTA HEMATOLOGÍA ONCOLÓGICA",
UNIDAD_ATENCION_DESC == "Oncologia Infantil" ~ "306__15135 - CONSULTA HEMATOLOGÍA ONCOLÓGICA",
UNIDAD_ATENCION_DESC == "Maxilofacial" ~ "328__15302 - CONSULTA PEDIATRÍA GENERAL",
UNIDAD_ATENCION_DESC == "Neurocirugia Infantil" ~ "292__15121 - CONSULTA NEUROCIRUGÍA",
UNIDAD_ATENCION_DESC == "Prematuros *" ~ "328__15302 - CONSULTA PEDIATRÍA GENERAL",
UNIDAD_ATENCION_DESC == "Medicina fisica y rehabilitacion Infantil" ~ "289__15118 - CONSULTA FISIATRÍA",
TRUE ~ "Asignar Centro de Costo"),"Unidades de Producción" = "3__Atención", Valor=n)
At_remota$n <- NULL
At_remota$UNIDAD_ATENCION_DESC <- NULL
Produccion_SIGCOM<- rbind(Produccion_SIGCOM, At_remota)
Produccion_SIGCOM$Fecha <- NULL
openxlsx::write.xlsx(Produccion_SIGCOM,Graba,
colNames = TRUE, sheetName = "5", overwrite = TRUE)
rm(P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, P14, P15, P16, B_qx, P,At_remota,
archivoBS, Fecha_filtro, remota, Sheet_remota, Egreso, Censo, Graba, rango_censo, Sheet_remota, Sheet_censo)
View(Produccion_SIGCOM)
library(tidyverse)
library(readxl)
library(lubridate)
library(janitor)
library(dplyr)
library(openxlsx)
library(xlsx)
library(readxl)
dias_mes <- 21
mes <- "01 Enero"
anio <- "2022"
ruta_base <- "C:/Users/control.gestion3/OneDrive/BBDD Produccion/PERC/PERC "
empleados <- janitor::clean_names(read_excel(paste0(ruta_base,anio,"/",mes,"/Insumos de Informacion/11 Empleados mes.xlsx")))
pt <- janitor::clean_names(read_excel(paste0(ruta_base,anio,"/Insumos de info anual/12 Programacion Total.xlsx")))
#esta secuencia sirve para eliminar errores con los rut -k,
#los cuales los deja en minuscula
empleados$run <- substr(empleados$identificacion,1,nchar(empleados$identificacion)-2)
empleados$sep2 <- substr(empleados$identificacion,9,nchar(empleados$identificacion)-0)
empleados$sep3 <- substr(empleados$sep2,2,nchar(empleados$sep2)-0)
empleados$dv <- ifelse(empleados$sep3 != "", empleados$sep3, empleados$sep2)
empleados$dv <- ifelse(empleados$dv == "K", "k", empleados$dv)
empleados$identificacion <- paste(empleados$run,empleados$dv,sep="-")
# Planilla Empleados ------------------------------------------------------
# nombres sirve para eliminar los nombres duplicados por escritura distinta
nombres <-  empleados %>% select(identificacion, nombre, categoria_de_empleado)
nombres <- unique.array(nombres)
nombres$duplicados <- duplicated(nombres$identificacion)
nombres <- nombres %>%
filter(duplicados == FALSE)
empleados <-  merge(x = empleados, y = nombres,
by = "identificacion")
colnames(empleados)[21] <- "Nombre"
colnames(empleados)[1] <- "Identificación"
colnames(empleados)[22] <- "categoria_de_empleado"
empleados <- empleados %>% mutate("Categoría de Empleado" = case_when(
#00102 Medico Especialista
categoria_de_empleado=="MEDICO CIRUJANO"~"00102",
categoria_de_empleado=="CIRUJANO INFANTIL"~"00102",
categoria_de_empleado=="NEUROCIRUJANO"~"00102",
categoria_de_empleado=="PEDIATRIA"~"00102",
categoria_de_empleado=="OFTALMOLOGIA"~"00102",
categoria_de_empleado=="RAYOS"~"00102",
categoria_de_empleado=="MED.INTEGRAL"~"00102",
categoria_de_empleado=="MEDICO FISIATRA"~"00102",
categoria_de_empleado=="ANESTESISTA"~"00102",
categoria_de_empleado=="PERIODO ASISTENCIAL OBLIGATORIO (PAO)"~"00102",
categoria_de_empleado=="DERMATOLOGIA"~"00102",
categoria_de_empleado=="ANESTESIOLOGIA"~"00102",
categoria_de_empleado=="CARDIOLOGIA"~"00102",
categoria_de_empleado=="NEUROLOGIA"~"00102",
categoria_de_empleado=="NEUROCIRUJANOS"~"00102",
categoria_de_empleado=="CIRUGIA MAXILO FACIAL"~"00102",
categoria_de_empleado=="CIRUGIA CARDIACA"~"00102",
categoria_de_empleado=="M.OBSTETRICIA Y GINECOLOGIA"~"00102",
categoria_de_empleado=="MEDICO TRAMATOLOGO Y ORTOPEDIA"~"00102",
categoria_de_empleado=="MEDICO PSIQUIATRA"~"00102",
categoria_de_empleado=="OTORRINO"~"00102",
categoria_de_empleado=="ANATOMO PATOLOGO"~"00102",
categoria_de_empleado=="CIRUGIA"~"00102",
categoria_de_empleado=="CIRUGIA INFANTIL"~"00102",
categoria_de_empleado=="PSIQUIATRIA INFANTIL"~"00102",
categoria_de_empleado=="NEURORADIOLOGIA"~"00102",
categoria_de_empleado=="RADIOLOGIA"~"00102",
categoria_de_empleado=="BECADOS PRIMARIOS"~"00102",
categoria_de_empleado=="OTORRINOLARINGOLOGIA"~"00102",
categoria_de_empleado=="ONCOLOGIA"~"00102",
categoria_de_empleado=="GASTROENTEROLOGIA"~"00102",
categoria_de_empleado=="RADIOLOGIA PEDIATRICA"~"00102",
categoria_de_empleado=="TRAUMATOLOGIA Y ORTOPEDIA"~"00102",
#00103 Medico General
categoria_de_empleado=="MEDICOS"~"00103",
#00302 Profesional en Salud
categoria_de_empleado=="TECNOLOGO MEDICO"~"00302",
categoria_de_empleado=="KINESIOLOGO"~"00302",
categoria_de_empleado=="ENFERMERA"~"00302",
categoria_de_empleado=="TERAPEUTA OCUPACIONAL"~"00302",
categoria_de_empleado=="PSICOLOGOS"~"00302",
categoria_de_empleado=="NUTRICIONISTA"~"00302",
categoria_de_empleado=="PSICOLOGO (A)"~"00302",
categoria_de_empleado=="PSICOLOGO"~"00302",
categoria_de_empleado=="FONOAUDIOLOGO (A)"~"00302",
categoria_de_empleado=="TECNOLOGO (A) MEDICO"~"00302",
categoria_de_empleado=="FONOAUDILOGO"~"00302",
#00305 Odontologos
categoria_de_empleado=="ODONTOLOGIA GENERAL NIÑOS"~"00305",
categoria_de_empleado=="CIRUJANO DENTISTA"~"00305",
categoria_de_empleado=="ODONTOLOGIA"~"00305",
categoria_de_empleado=="DENTISTA CONSULTORIO"~"00305",
#00309 Quimicos Farmaceuticos
categoria_de_empleado=="QUIMICO FARMACEUTICO"~"00309",
#00310 Bioquimicos
categoria_de_empleado=="BIOQUIMICOS"~"00310",
categoria_de_empleado=="BIOQUIMICO"~"00302",
#00401 Tecnicos en Salud
categoria_de_empleado=="TECNICO NIVEL SUPERIOR DE ENFERMERIA"~"00401",
categoria_de_empleado=="TECNICO PARAMEDICO"~"00401",
categoria_de_empleado=="TEC. NIV. SUPERIOR ENFERMERIA"~"00401",
categoria_de_empleado=="TECNICO EN ALIMENTACION"~"00401",
#00403 Otros tecnicos
categoria_de_empleado=="TECNICO"~"00403",
categoria_de_empleado=="TECNICO EN COMPUTACION E INFORMATICA"~"00403",
categoria_de_empleado=="TECNICO EN MANTENCION DE EQUIPOS INDUSTRIALES"~"00403",
categoria_de_empleado=="TECNICO DE PARVULOS"~"00403",
categoria_de_empleado=="TECNICO EN ALIMENTO"~"00403",
categoria_de_empleado=="TECNICO JURIDICO"~"00403",
categoria_de_empleado=="TECNICO NIVEL SUPERIOR EN COMPUTACION"~"00403",
categoria_de_empleado=="TECNICO NIVEL MEDIO EN ELECTRONICA"~"00403",
categoria_de_empleado=="TECNICO EN FARMACIA"~"00403",
categoria_de_empleado=="TECNICO DE FARMACIA"~"00403",
categoria_de_empleado=="TECNICO NIVEL SUPERIOR"~"00403",
categoria_de_empleado=="TECNICO EN COMPUTACION"~"00403",
categoria_de_empleado=="TECNICO EN MANTENCION"~"00403",
categoria_de_empleado=="OTROS TECNICO"~"00403",
categoria_de_empleado=="TECNICO NIVEL SUPERIOR EN TRABAJO SOCIAL"~"00403",
categoria_de_empleado=="TECNICO NIVEL SUPERIOR EN ELECTRICIDAD"~"00403",
categoria_de_empleado=="TECNICO EN MANTENCION EQUIPOS INDUSTRIALES"~"00403",
categoria_de_empleado=="TECNICO NIVEL SUPERIOR "~"00403",
categoria_de_empleado=="OTROS TECNICOS"~"00403",
#00501 Auxiliares en Salud
categoria_de_empleado=="AUXILIAR PARAMEDICO"~"00501",
#00701 Personal Administrativo
categoria_de_empleado=="ADMINISTRATIVOS"~"00701",
categoria_de_empleado=="ADMINISTRATIVO"~"00701",
#00702 Profesional Administrativo
categoria_de_empleado=="INGENIERO CIVIL BIOMEDICO"~"00702",
categoria_de_empleado=="INGENIERO EJECUCION EN INFORMATICA"~"00702",
categoria_de_empleado=="INGENIERO (A) EN INFORMATICA"~"00702",
categoria_de_empleado=="INGENIERO INDUSTRIAL"~"00702",
categoria_de_empleado=="COMUNICADOR (A) AUDIOVISUAL"~"00702",
categoria_de_empleado=="INGENIERO (A) EJECUCION EN INFORMATICA"~"00702",
categoria_de_empleado=="EDUCADORA DE PARVULOS"~"00702",
categoria_de_empleado=="ASISTENTE SOCIAL"~"00702",
categoria_de_empleado=="CONTADOR"~"00702",
categoria_de_empleado=="JEFE DEPTO. RECURSOS HUMANOS"~"00702",
categoria_de_empleado=="JEFE SERV. ORIENTACION MEDICA Y ESTADIST"~"00702",
categoria_de_empleado=="PERIODISTA"~"00702",
categoria_de_empleado=="ADMINISTRADOR PUBLICO"~"00702",
categoria_de_empleado=="INGENIERO (A) BIOMEDICO"~"00702",
categoria_de_empleado=="COMUNICADOR (A) SOCIAL"~"00702",
categoria_de_empleado=="EDUCADOR DE PARVULOS"~"00702",
categoria_de_empleado=="INGENIERO (A) EN ADMINISTRACION DE RECURSOS HUMANOS"~"00702",
categoria_de_empleado=="TRABAJADOR (A) SOCIAL"~"00702",
categoria_de_empleado=="INGENIERO (A) CIVIL BIOMEDICO"~"00702",
categoria_de_empleado=="CONSTRUCTOR CIVIL"~"00702",
categoria_de_empleado=="CONSTRUCTOR (A) CIVIL"~"00702",
categoria_de_empleado=="INGENIERO (A) EJECUCION EN ELECTRONICA"~"00702",
categoria_de_empleado=="ABOGADO (A)"~"00702",
categoria_de_empleado=="EQUIPOS MEDICOS"~"00702",
categoria_de_empleado=="UNIDAD DE EQUIPOS INDUSTRIALES"~"00702",
categoria_de_empleado=="PREVENCION DE RIESGO Y SALUD OCUPACIONAL"~"00702",
categoria_de_empleado=="UNIDAD DE EQUIPOS INDUSTRIALES"~"00702",
categoria_de_empleado=="INGENIERO (A) PREVENCION DE RIESGOS"~"00702",
categoria_de_empleado=="CONTADOR (A) PUBLICO"~"00702",
categoria_de_empleado=="INGENIERO (A) CONSTRUCTOR"~"00702",
categoria_de_empleado=="INGENIERO CIVIL"~"00702",
categoria_de_empleado=="INGENIERO (A) EN INDUSTRIA Y LOGISTICA"~"00702",
categoria_de_empleado=="COMUNICADOR AUDIOVISUAL"~"00702",
categoria_de_empleado=="PROFESIONALES UNIVERSITARIOS"~"00702",
categoria_de_empleado=="ADMINISTRADOR (A) PUBLICO"~"00702",
categoria_de_empleado=="CONTADOR (A) PUBLICO (A) AUDITOR"~"00702",
#00705 Personal Directivo
categoria_de_empleado=="DIRECTOR DE HOSPITAL"~"00705",
#00710 Auxiliares
categoria_de_empleado=="CHOFER"~"00710",
categoria_de_empleado=="AUXILIAR"~"00710",
TRUE ~ "Asignar Clasificacion"),
"Tipo de Contrato" = case_when(tipo_de_contrato == "HONORARIOS" ~ 2,
tipo_de_contrato == "HONORARIO" ~ 2,
TRUE ~ 1),
"Niveles Laborales" = "00",
"Bonificaciones" = 0,
"Salario Base" = salario_base+mto_hrs_extras,
"Beneficios Laborales" = beneficios_laborales)
empleados$`Tipo de Contrato` <- as.character(empleados$`Tipo de Contrato`)
#base es la planilla con todo el contenido que sirve para la planilla 2
base <- empleados %>%
select(Identificación, Nombre, `Salario Base`,`Categoría de Empleado`,
`Niveles Laborales`, Bonificaciones, `Beneficios Laborales`,
`Tipo de Contrato`, cant_hrs_extras) %>%
group_by(Identificación,Nombre, `Categoría de Empleado`,`Niveles Laborales`,
`Tipo de Contrato`) %>%
summarise("Salario Base"=sum(`Salario Base`),
"Bonificaciones"=sum(Bonificaciones),
"Beneficios Laborales"= sum(`Beneficios Laborales`),
"Horas Extras" = sum(cant_hrs_extras)) %>%
filter(`Salario Base` > 0) %>% select(Identificación, Nombre, `Salario Base`,
`Categoría de Empleado`,
`Niveles Laborales`, Bonificaciones,
`Beneficios Laborales`,
`Tipo de Contrato`, `Horas Extras`)
planilla1 <- base %>% select(-`Horas Extras`)
planilla1$`Tipo de Contrato` <- as.numeric(planilla1$`Tipo de Contrato`)
# Planilla Programacion Total ---------------------------------------------
#programacion es el cruce de base con pt
programacion <-  merge(x = base, y = pt,
by.x = "Identificación", by.y = "rut", all.x = TRUE)
programacion <- programacion %>% select(Identificación, Nombre, especialidad,
`Horas Extras`,horas_asignadas,
unidad_local, perc,
percent_de_distribucion, horas_totales)
#Verifica si hay personal no programado
no_programados <- programacion
no_programados$no_prog <- is.na(no_programados$perc)
no_programados <- no_programados %>%  filter(no_prog == "TRUE") %>%
select(Identificación)
no_programados <- left_join(no_programados, empleados)
no_programados <- no_programados %>%
select(Identificación, Nombre, categoria_de_empleado, tipo_de_contrato, unidad, horas)
programacion$horas_mensuales <-((programacion$horas_totales/5)*dias_mes)*programacion$percent_de_distribucion +
programacion$`Horas Extras`*programacion$percent_de_distribucion
programacion <- programacion %>% select(Identificación, Nombre, perc, horas_mensuales)
# Pabellon
M2Pab <- read_excel(paste0(ruta_base,anio,"/",mes,"/Insumos de Informacion/89_Pabellon.xlsx"))
M2Pab <- mutate_all(M2Pab, ~replace(., is.na(.), 0))
Metros_pabellon <- 11*45
"473-QUIRÓFANOS MENOR AMBULATORIA" <- sum(M2Pab$`473-QUIRÓFANOS MENOR AMBULATORIA`)
"471-QUIRÓFANOS MAYOR AMBULATORIA" <- sum(M2Pab$`471-QUIRÓFANOS MAYOR AMBULATORIA`)
M2Pab <- M2Pab %>% filter(SIGCOM != "Total") %>%
select(SIGCOM, `Distribución cirugias Electivas`) %>%
group_by(SIGCOM) %>%
summarise("Distribución cirugias Electivas" =sum(`Distribución cirugias Electivas`)) %>%
ungroup()
df <- tibble(SIGCOM= as.character(c("473-QUIRÓFANOS MENOR AMBULATORIA", "471-QUIRÓFANOS MAYOR AMBULATORIA")),
"Distribución cirugias Electivas"= c(`473-QUIRÓFANOS MENOR AMBULATORIA`, `471-QUIRÓFANOS MAYOR AMBULATORIA`))
M2Pab <- rbind(M2Pab, df)
M2Pab$Area <- "Quirofanos"
M2Pab <- M2Pab %>% mutate(Area = Area, CC = SIGCOM,
M2=`Distribución cirugias Electivas`/sum(`Distribución cirugias Electivas`)*Metros_pabellon) %>%
select(Area, CC, M2)
M2Pab$prop <- M2Pab$M2/sum(M2Pab$M2) #asigna proporción a los M2
e <- "464-QUIRÓFANOS CARDIOVASCULAR"
GG1 <- programacion %>% filter(perc == "Pabellón Prorratear")
prop_pab <- M2Pab %>% filter(CC == e)
GG1$H <- GG1$horas_mensuales*prop_pab$prop
GG1$CC <- e #asigna columna CC
e <- "467-QUIRÓFANOS DIGESTIVA"
GG2 <- programacion %>% filter(perc == "Pabellón Prorratear")
prop_pab <- M2Pab %>% filter(CC == e)
GG2$H <- GG2$horas_mensuales*prop_pab$prop
GG2$CC <- e #asigna columna CC
GG1 <- rbind(GG1, GG2)
e <- "475-QUIRÓFANOS NEUROCIRUGÍA"
GG2 <- programacion %>% filter(perc == "Pabellón Prorratear")
prop_pab <- M2Pab %>% filter(CC == e)
GG2$H <- GG2$horas_mensuales*prop_pab$prop
GG2$CC <- e #asigna columna CC
GG1 <- rbind(GG1, GG2)
e <- "478-QUIRÓFANOS OFTALMOLOGÍA"
GG2 <- programacion %>% filter(perc == "Pabellón Prorratear")
prop_pab <- M2Pab %>% filter(CC == e)
GG2$H <- GG2$horas_mensuales*prop_pab$prop
GG2$CC <- e #asigna columna CC
GG1 <- rbind(GG1, GG2)
e <- "480-QUIRÓFANOS OTORRINOLARINGOLOGÍA"
GG2 <- programacion %>% filter(perc == "Pabellón Prorratear")
prop_pab <- M2Pab %>% filter(CC == e)
GG2$H <- GG2$horas_mensuales*prop_pab$prop
GG2$CC <- e #asigna columna CC
GG1 <- rbind(GG1, GG2)
e <- "485-QUIRÓFANOS TRAUMATOLOGÍA Y ORTOPEDIA"
GG2 <- programacion %>% filter(perc == "Pabellón Prorratear")
prop_pab <- M2Pab %>% filter(CC == e)
GG2$H <- GG2$horas_mensuales*prop_pab$prop
GG2$CC <- e #asigna columna CC
GG1 <- rbind(GG1, GG2)
e <- "486-QUIRÓFANOS UROLOGÍA"
GG2 <- programacion %>% filter(perc == "Pabellón Prorratear")
prop_pab <- M2Pab %>% filter(CC == e)
GG2$H <- GG2$horas_mensuales*prop_pab$prop
GG2$CC <- e #asigna columna CC
GG1 <- rbind(GG1, GG2)
e <- "493-QUIRÓFANOS CIRUGÍA PLÁSTICA"
GG2 <- programacion %>% filter(perc == "Pabellón Prorratear")
prop_pab <- M2Pab %>% filter(CC == e)
GG2$H <- GG2$horas_mensuales*prop_pab$prop
GG2$CC <- e #asigna columna CC
GG1 <- rbind(GG1, GG2)
e <- "495-QUIRÓFANOS CIRUGÍA VASCULAR"
GG2 <- programacion %>% filter(perc == "Pabellón Prorratear")
prop_pab <- M2Pab %>% filter(CC == e)
GG2$H <- GG2$horas_mensuales*prop_pab$prop
GG2$CC <- e #asigna columna CC
GG1 <- rbind(GG1, GG2)
e <- "473-QUIRÓFANOS MENOR AMBULATORIA"
GG2 <- programacion %>% filter(perc == "Pabellón Prorratear")
prop_pab <- M2Pab %>% filter(CC == e)
GG2$H <- GG2$horas_mensuales*prop_pab$prop
GG2$CC <- e #asigna columna CC
GG1 <- rbind(GG1, GG2)
e <- "471-QUIRÓFANOS MAYOR AMBULATORIA"
GG2 <- programacion %>% filter(perc == "Pabellón Prorratear")
prop_pab <- M2Pab %>% filter(CC == e)
GG2$H <- GG2$horas_mensuales*prop_pab$prop
GG2$CC <- e #asigna columna CC
GG1 <- rbind(GG1, GG2)
# Procedimientos ----------------------------------------------------------
e <- "317-CONSULTA OFTALMOLOGÍA"
GG2 <- programacion %>% filter(perc == "317-CONSULTA OFTALMOLOGÍA")
GG2$H <- GG2$horas_mensuales*0.7
GG2$CC <- e #asigna columna CC
GG1 <- rbind(GG1, GG2)
e <- "258-PROCEDIMIENTOS DE OFTALMOLOGÍA"
GG2 <- programacion %>% filter(perc == "317-CONSULTA OFTALMOLOGÍA")
GG2$H <- GG2$horas_mensuales*0.3
GG2$CC <- e #asigna columna CC
GG1 <- rbind(GG1, GG2)
e <- "311-CONSULTA UROLOGÍA"
GG2 <- programacion %>% filter(perc == "311-CONSULTA UROLOGÍA")
GG2$H <- GG2$horas_mensuales*0.95
GG2$CC <- e #asigna columna CC
GG1 <- rbind(GG1, GG2)
e <- "263-PROCEDIMIENTOS DE UROLOGÍA"
GG2 <- programacion %>% filter(perc == "311-CONSULTA UROLOGÍA")
GG2$H <- GG2$horas_mensuales*0.05
GG2$CC <- e #asigna columna CC
GG1 <- rbind(GG1, GG2)
e <- "353-CONSULTA GINECOLOGICA"
GG2 <- programacion %>% filter(perc == "353-CONSULTA GINECOLOGICA")
GG2$H <- GG2$horas_mensuales*0.95
GG2$CC <- e #asigna columna CC
GG1 <- rbind(GG1, GG2)
e <- "251-PROCEDIMIENTOS DE GINECOLOGÍA"
GG2 <- programacion %>% filter(perc == "353-CONSULTA GINECOLOGICA")
GG2$H <- GG2$horas_mensuales*0.05
GG2$CC <- e #asigna columna CC
GG1 <- rbind(GG1, GG2)
programacion <- programacion %>% filter(perc != "Pabellón Prorratear" & perc != "317-CONSULTA OFTALMOLOGÍA" & perc != "311-CONSULTA UROLOGÍA" & perc != "353-CONSULTA GINECOLOGICA")
GG1 <- GG1 %>% mutate("Identificación" = Identificación, "Nombre"= Nombre,
"perc"=CC, "horas_mensuales"=H) %>%
select(Identificación, Nombre, perc, horas_mensuales)
programacion <- rbind(GG1, programacion)
#Transforma Pab oft y oto en CMA xq no tienen produccion
programacion <- programacion %>% mutate(perc = case_when(
perc ==	"478-QUIRÓFANOS OFTALMOLOGÍA"	~	"471-QUIRÓFANOS MAYOR AMBULATORIA",
perc ==	"480-QUIRÓFANOS OTORRINOLARINGOLOGÍA"	~	"471-QUIRÓFANOS MAYOR AMBULATORIA",
perc ==	"713-TRABAJO SOCIAL"	~	"99544-TRABAJO SOCIAL",
TRUE ~ perc))
rm(df, GG1, GG2, M2Pab, prop_pab, nombres, e, M2_Pab_EqMed, Metros_pabellon,
`471-QUIRÓFANOS MAYOR AMBULATORIA`, `473-QUIRÓFANOS MENOR AMBULATORIA`,
dias_mes, base)
openxlsx::write.xlsx(planilla1, paste0(ruta_base, anio,"/",mes,"/Complemento Subir/01.xlsx"),
colNames = TRUE, sheetName = "P1", overwrite = TRUE)
openxlsx::write.xlsx(programacion, paste0(ruta_base, anio,"/",mes,"/01, 02, 03, 04 , 05, 06 y 07/SIRH R.xlsx"),
colNames = TRUE, sheetName = "SIRH", overwrite = TRUE)
openxlsx::write.xlsx(no_programados, paste0(ruta_base, anio,"/",mes,"/Insumos de Informacion/901_No_Programados.xlsx"),
colNames = TRUE, sheetName = "NP", overwrite = TRUE)
rm(empleados, planilla1, programacion, pt, ruta_base, anio, mes)
