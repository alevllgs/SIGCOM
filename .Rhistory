CC=="ESTADISTICA"~"670-ADMINISTRACIÓN",
CC=="S.D.RR.HH"~"670-ADMINISTRACIÓN",
CC=="CHILE CRECE CONTIGO"~"713-TRABAJO SOCIAL",
CC=="UNIDAD ANALISIS REG.CLINICO"~"670-ADMINISTRACIÓN",
CC=="INFRAESTRUCTURA HOSPITAL"~"670-ADMINISTRACIÓN",
CC=="PREV.RIESGO Y S.OCUPACIONAL"~"670-ADMINISTRACIÓN",
CC=="SALA REAS"~"670-ADMINISTRACIÓN",
CC=="EQUIPOS INDUSTRIALES(HOSPITAL)"~"670-ADMINISTRACIÓN",
CC=="I.A.A.S"~"670-ADMINISTRACIÓN",
CC=="UNIDAD ASISTENCIAL DOCENTE"~"670-ADMINISTRACIÓN",
CC=="LAB.BIOLOGIA MOLECULAR"~"518-LABORATORIO CLÍNICO",
CC=="CAE PREMATUROS"~"328-CONSULTA PEDIATRÍA GENERAL",
CC=="VACUNATORIO"~"328-CONSULTA PEDIATRÍA GENERAL",
CC=="OFICINA DE SUELDOS"~"670-ADMINISTRACIÓN",
CC=="SUBDIRECCION ADMINISTRATIVA"~"670-ADMINISTRACIÓN",
CC=="SUBDIRECCION MEDICA"~"670-ADMINISTRACIÓN",
CC=="EQUIPAMIENTO HOSPITAL"~"670-ADMINISTRACIÓN",
CC=="BODEGAS ABASTECIMIENTO"~"670-ADMINISTRACIÓN",
CC=="CIRUGIA GENERAL"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
CC=="UNIDAD MEDICINA INTEGRATIVA"~"670-ADMINISTRACIÓN",
CC=="C.COSTO GLOBAL"~"670-ADMINISTRACIÓN",
CC=="GASTOS HOSPITAL"~"670-ADMINISTRACIÓN",
CC=="CAE QUEMADOS"~"316-CONSULTA CIRUGÍA PLÁSTICA",
CC=="CAE PROCED. NEFROLOGIA"~"285-CONSULTA NEFROLOGÍA",
CC=="GESTION DE USUARIOS"~"670-ADMINISTRACIÓN",
CC=="ADM CARDIOLOGIA"~"276-CONSULTA CARDIOLOGÍA",
CC=="UNIDAD PRE QUIRURGICA"~"471-QUIRÓFANOS MAYOR AMBULATORIA",
CC=="CAE ESPECIALIDADES 2"~"Cae Prorratear",
CC=="CAE ADMINISTRACION"~"Cae Prorratear",
CC=="PABELLONES"~"Pabellón Prorratear",
TRUE ~ "Asignar CC"
)) %>%
select(item_pres, CC,ItemxCC, Total) %>%
group_by (item_pres, CC,ItemxCC,) %>%
summarise("Total" = sum(Total)) %>%
ungroup()
# Prorrateos GG x CxCC -------------------------------------------------------
cuentas <- c("52-ARRENDAMIENTOS",
"60-COMPRA DE CAMAS AL EXTRA SISTEMA CAMAS NO CRÍTICAS",
"61-COMPRA DE CONSULTAS MÉDICAS",
"62-COMPRA DE CONSULTAS NO MÉDICAS",
"63-COMPRA DE INTERVENCIONES QUIRÚRGICAS CLÍNICAS",
"64-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL EXTERNO",
"65-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL INTERNO",
"66-COMPRA DE OTROS SERVICIOS",
"129-MANTENIMIENTO EQUIPO DE CÓMPUTO",
"131-MANTENIMIENTO MAQUINARIA Y EQUIPO",
"132-MANTENIMIENTO MUEBLES Y ENSERES",
"135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
"147-OTROS MANTENIMIENTOS",
"151-PASAJES, FLETES Y BODEGAJE",
"149-PASAJES Y TRASLADOS DE PACIENTES",
"178-SERVICIO DE LAVANDERÍA",
"3-COMBUSTIBLES Y LUBRICANTES",
"8-EQUIPOS MENORES",
"9-GASES MEDICINALES",
"11-LIBROS, TEXTOS, UTILES DE ENSEÑANZA Y PUBLICACIONES",
"15-MATERIAL DE ODONTOLOGÍA",
"16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
"18-MATERIAL MEDICO QUIRURGICO",
"21-MATERIALES DE CURACIÓN",
"24-MATERIALES DE OFICINA, PRODUCTOS DE PAPEL E IMPRESOS",
"25-MATERIALES DE USO O CONSUMO",
"27-MATERIALES INFORMATICOS",
"28-MATERIALES PARA MANTENIMIENTO Y REPARACIONES DE INMUEBLES",
"29-MATERIALES Y ELEMENTOS DE ASEO",
"31-MENAJE PARA OFICINA, CASINO Y OTROS",
"35-OTROS INSUMOS Y MATERIALES",
"41-PRODUCTOS QUÍMICOS",
"43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
"44-REPUESTOS Y ACCESORIOS PARA MANTENIMIENTO Y REPARACIONES DE VEHICULOS",
"46-VÍVERES")
cuentas_total <- c("52-ARRENDAMIENTOS",
"129-MANTENIMIENTO EQUIPO DE CÓMPUTO",
"131-MANTENIMIENTO MAQUINARIA Y EQUIPO",
"132-MANTENIMIENTO MUEBLES Y ENSERES",
"135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
"147-OTROS MANTENIMIENTOS",
"151-PASAJES, FLETES Y BODEGAJE",
"3-COMBUSTIBLES Y LUBRICANTES",
"8-EQUIPOS MENORES",
"9-GASES MEDICINALES",
"11-LIBROS, TEXTOS, UTILES DE ENSEÑANZA Y PUBLICACIONES",
"15-MATERIAL DE ODONTOLOGÍA",
"16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
"18-MATERIAL MEDICO QUIRURGICO",
"21-MATERIALES DE CURACIÓN",
"24-MATERIALES DE OFICINA, PRODUCTOS DE PAPEL E IMPRESOS",
"25-MATERIALES DE USO O CONSUMO",
"27-MATERIALES INFORMATICOS",
"28-MATERIALES PARA MANTENIMIENTO Y REPARACIONES DE INMUEBLES",
"29-MATERIALES Y ELEMENTOS DE ASEO",
"31-MENAJE PARA OFICINA, CASINO Y OTROS",
"35-OTROS INSUMOS Y MATERIALES",
"41-PRODUCTOS QUÍMICOS",
"43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
"44-REPUESTOS Y ACCESORIOS PARA MANTENIMIENTO Y REPARACIONES DE VEHICULOS",
"46-VÍVERES")
cuentas_clinico <- c("149-PASAJES Y TRASLADOS DE PACIENTES",
"178-SERVICIO DE LAVANDERÍA",
"15-MATERIAL DE ODONTOLOGÍA",
"16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
"18-MATERIAL MEDICO QUIRURGICO",
"21-MATERIALES DE CURACIÓN",
"9-GASES MEDICINALES")
cuentas_qx <- c("63-COMPRA DE INTERVENCIONES QUIRÚRGICAS CLÍNICAS",
"64-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL EXTERNO",
"65-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL INTERNO")
cuentas_cae <- c("61-COMPRA DE CONSULTAS MÉDICAS",
"62-COMPRA DE CONSULTAS NO MÉDICAS")
cuentas_no_critico <- c("60-COMPRA DE CAMAS AL EXTRA SISTEMA CAMAS NO CRÍTICAS")
cuenta_insumos <- c("3-COMBUSTIBLES Y LUBRICANTES",
"8-EQUIPOS MENORES",
"11-LIBROS, TEXTOS, UTILES DE ENSEÑANZA Y PUBLICACIONES",
"24-MATERIALES DE OFICINA, PRODUCTOS DE PAPEL E IMPRESOS",
"25-MATERIALES DE USO O CONSUMO",
"27-MATERIALES INFORMATICOS",
"28-MATERIALES PARA MANTENIMIENTO Y REPARACIONES DE INMUEBLES",
"29-MATERIALES Y ELEMENTOS DE ASEO",
"31-MENAJE PARA OFICINA, CASINO Y OTROS",
"35-OTROS INSUMOS Y MATERIALES",
"41-PRODUCTOS QUÍMICOS",
"43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
"44-REPUESTOS Y ACCESORIOS PARA MANTENIMIENTO Y REPARACIONES DE VEHICULOS",
"46-VÍVERES")
for (i in cuentas) {
if(i %in% SIGFE$SIGCOM & i %in% CxCC$ItemxCC){
CCC <- CxCC %>% filter(ItemxCC == i) %>%
select(CC, Total) %>%
group_by (CC) %>%
summarise(Total =sum(Total)) %>%
mutate("prop" = Total/sum(Total))
GG2 <-  SIGFE %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == i)
GG2 <- GG2 %>% summarise("Centro de Costo" = CCC$CC,
Devengado = Devengado*CCC$prop,
"Cuenta"=i, "Tipo" = 2)
GG1 <- rbind(GG1,GG2)}
else if (i %in% SIGFE$SIGCOM & i %in% CxCC_H$ItemxCC){
CCC <- CxCC_H %>% filter(ItemxCC == i) %>%
select(CC, Total) %>%
group_by (CC) %>%
summarise(Total =sum(Total)) %>%
mutate("prop" = Total/sum(Total))
GG2 <-  SIGFE %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == i)
GG2 <- GG2 %>% summarise("Centro de Costo" = CCC$CC,
Devengado = Devengado*CCC$prop,
"Cuenta"=i, "Tipo" = 2)
GG1 <- rbind(GG1,GG2)}
else if (i %in% SIGFE$SIGCOM){
proporcion_exacta <- ifelse(i %in% cuentas_cae, "prorrateo_cae",
ifelse(i %in% cuentas_clinico, "prorrateo_clinico",
ifelse(i %in% cuentas_qx, "prorrateo_qx",
ifelse(i %in% cuentas_no_critico, "prorrateo_no_critico", "todos"))))
if (proporcion_exacta == "prorrateo_cae"){M2_exacto <- M2 %>% filter(Area == "Consultas")}
else if (proporcion_exacta == "prorrateo_clinico"){
M2_exacto <- M2 %>% filter(Area != "Apoyo")}
else if (proporcion_exacta == "prorrateo_qx"){
M2_exacto <- M2 %>% filter(Area == "Quirofanos")}
else if (proporcion_exacta == "prorrateo_no_critico"){
M2_exacto <- M2 %>% filter(Area == "Hospitalización")}
else{
M2_exacto <- M2 %>% filter(Area!="No_existe")}
M2_exacto$prop <- M2_exacto$M2/sum(M2_exacto$M2)
GG2 <-  SIGFE %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == i)
GG2 <- GG2 %>% summarise("Centro de Costo" = M2_exacto$CC,
Devengado = Devengado*M2_exacto$prop,
"Cuenta"=i, "Tipo" = 2)
GG1 <- rbind(GG1,GG2)}
else  {GG2 <- GG1_nulo
GG1 <- rbind(GG1,GG2) %>% filter(Cuenta!="eliminar")}
}
# Centros de Costo Globales -----------------------------------------------
Compras_Servicios <- GG1 %>% filter (Cuenta == "65-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL INTERNO" |
Cuenta == "64-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL EXTERNO")
sum(Compras_Servicios$Devengado)
GG1 <- GG1 %>% filter (Cuenta != "65-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL INTERNO" &
Cuenta != "64-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL EXTERNO")
GG4 <- GG1 %>% filter (`Centro de Costo`== "Pabellón Prorratear")
GG3 <- GG1 %>% filter (`Centro de Costo`== "Cae Prorratear")
GG1 <- GG1 %>% filter(`Centro de Costo`!="Pabellón Prorratear" &
`Centro de Costo`!="Cae Prorratear")
#PABELLON
qx <- c("464-QUIRÓFANOS CARDIOVASCULAR",
"467-QUIRÓFANOS DIGESTIVA",
"475-QUIRÓFANOS NEUROCIRUGÍA",
"478-QUIRÓFANOS OFTALMOLOGÍA",
"480-QUIRÓFANOS OTORRINOLARINGOLOGÍA",
"485-QUIRÓFANOS TRAUMATOLOGÍA Y ORTOPEDIA",
"486-QUIRÓFANOS UROLOGÍA",
"493-QUIRÓFANOS CIRUGÍA PLÁSTICA",
"495-QUIRÓFANOS CIRUGÍA VASCULAR",
"473-QUIRÓFANOS MENOR AMBULATORIA",
"471-QUIRÓFANOS MAYOR AMBULATORIA")
for (i in qx) {
# qx <- "464-QUIRÓFANOS CARDIOVASCULAR"
q <- sum(ifelse(M2Pab$CC == i, M2Pab$prop, 0))
GG2 <- GG4 %>% filter(`Centro de Costo`=="Pabellón Prorratear") %>%
summarise("Centro de Costo" = i,
Devengado = Devengado*q,
"Cuenta"= Cuenta,"Tipo" = 2)
GG44 <- rbind(GG44, GG2) %>% filter(Cuenta!="eliminar")
}
am <- c("240-PROCEDIMIENTO DE CARDIOLOGÍA",
"244-PROCEDIMIENTO DE NEUMOLOGÍA",
"249-PROCEDIMIENTOS DE DERMATOLOGÍA",
"250-PROCEDIMIENTOS DE GASTROENTEROLOGÍA",
"261-PROCEDIMIENTOS DE OTORRINOLARINGOLOGÍA",
"262-PROCEDIMIENTOS DE TRAUMATOLOGÍA",
"269-PROCEDIMIENTOS DE NEUROLOGÍA",
"351-CONSULTA CIRUGÍA PEDIÁTRICA",
"230-CONSULTA NUTRICIÓN",
"275-CONSULTA REUMATOLOGÍA",
"276-CONSULTA CARDIOLOGÍA",
"277-CONSULTA DERMATOLOGÍA",
"280-CONSULTA PSIQUIATRÍA",
"281-CONSULTA ENDOCRINOLOGÍA",
"282-CONSULTA NEUMOLOGÍA",
"284-CONSULTA INFECTOLOGÍA",
"285-CONSULTA NEFROLOGÍA",
"286-CONSULTA GENÉTICA",
"289-CONSULTA FISIATRÍA",
"290-CONSULTA GASTROENTEROLOGÍA",
"292-CONSULTA NEUROCIRUGÍA",
"296-CONSULTA ANESTESIOLOGIA",
"306-CONSULTA HEMATOLOGÍA ONCOLÓGICA",
"311-CONSULTA UROLOGÍA",
"316-CONSULTA CIRUGÍA PLÁSTICA",
"317-CONSULTA OFTALMOLOGÍA",
"319-CONSULTA OTORRINOLARINGOLOGÍA",
"328-CONSULTA PEDIATRÍA GENERAL",
"331-CONSULTA NEUROLOGÍA PEDIÁTRICA",
"342-CONSULTA TRAUMATOLOGÍA PEDIÁTRICA",
"353-CONSULTA GINECOLOGICA",
"356-CONSULTA ODONTOLOGÍA",
"359-TELEMEDICINA")
for (i in am) {
a <- sum(ifelse(CAE_prorratear$CC == i, CAE_prorratear$prop, 0))
GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
summarise("Centro de Costo" = i,
Devengado = Devengado*a,
"Cuenta"= Cuenta,"Tipo" = 2)
GG33 <- rbind(GG33, GG2) %>% filter(Cuenta!="eliminar")
}
GG1 <- rbind(GG33,GG44,GG1)
#Redondeo el Devengado
GG1 <- GG1 %>%  filter (Devengado != 0) %>%
summarise("Centro de Costo"= `Centro de Costo`,"Devengado" = round(Devengado),
"Cuenta"=Cuenta,"Tipo"=Tipo) %>%
ungroup()
# Asigna CC actualizados al 2022 ------------------------------------------
GG1 <- GG1 %>% mutate(`Centro de Costo` =
case_when(
`Centro de Costo` ==	"478-QUIRÓFANOS OFTALMOLOGÍA"	~	"471-QUIRÓFANOS MAYOR AMBULATORIA",
`Centro de Costo` ==	"480-QUIRÓFANOS OTORRINOLARINGOLOGÍA"	~	"471-QUIRÓFANOS MAYOR AMBULATORIA",
`Centro de Costo` == "273-CONSULTA MEDICINA INTERNA"~"15102-CONSULTA MEDICINA INTERNA",
`Centro de Costo` == "274-CONSULTA NEUROLOGÍA"~"15103-CONSULTA NEUROLOGÍA",
`Centro de Costo` == "275-CONSULTA REUMATOLOGÍA"~"15104-CONSULTA REUMATOLOGÍA",
`Centro de Costo` == "276-CONSULTA CARDIOLOGÍA"~"15105-CONSULTA CARDIOLOGÍA",
`Centro de Costo` == "277-CONSULTA DERMATOLOGÍA"~"15106-CONSULTA DERMATOLOGÍA",
`Centro de Costo` == "278-CONSULTA ONCOLOGÍA"~"15107-CONSULTA ONCOLOGÍA",
`Centro de Costo` == "279-PROGRAMA VIH"~"15108-PROGRAMA VIH",
`Centro de Costo` == "280-CONSULTA PSIQUIATRÍA"~"15109-CONSULTA PSIQUIATRÍA",
`Centro de Costo` == "281-CONSULTA ENDOCRINOLOGÍA"~"15110-CONSULTA ENDOCRINOLOGÍA",
`Centro de Costo` == "282-CONSULTA NEUMOLOGÍA"~"15111-CONSULTA NEUMOLOGÍA",
`Centro de Costo` == "284-CONSULTA INFECTOLOGÍA"~"15113-CONSULTA INFECTOLOGÍA",
`Centro de Costo` == "285-CONSULTA NEFROLOGÍA"~"15114-CONSULTA NEFROLOGÍA",
`Centro de Costo` == "286-CONSULTA GENÉTICA"~"15115-CONSULTA GENÉTICA",
`Centro de Costo` == "287-CONSULTA HEMATOLOGÍA"~"15116-CONSULTA HEMATOLOGÍA",
`Centro de Costo` == "288-CONSULTA GERIATRÍA"~"15117-CONSULTA GERIATRÍA",
`Centro de Costo` == "289-CONSULTA FISIATRÍA"~"15118-CONSULTA FISIATRÍA",
`Centro de Costo` == "290-CONSULTA GASTROENTEROLOGÍA"~"15119-CONSULTA GASTROENTEROLOGÍA",
`Centro de Costo` == "292-CONSULTA NEUROCIRUGÍA"~"15121-CONSULTA NEUROCIRUGÍA",
`Centro de Costo` == "294-PROGRAMA MANEJO DEL DOLOR"~"15123-PROGRAMA MANEJO DEL DOLOR",
`Centro de Costo` == "295-CONSULTA SALUD OCUPACIONAL"~"15124-CONSULTA SALUD OCUPACIONAL",
`Centro de Costo` == "296-CONSULTA ANESTESIOLOGIA"~"15125-CONSULTA ANESTESIOLOGIA",
`Centro de Costo` == "302-PROGRAMA ENFERMEDADES DE TRANSMISIÓN SEXUAL"~"15131-PROGRAMA ENFERMEDADES DE TRANSMISIÓN SEXUAL",
`Centro de Costo` == "306-CONSULTA HEMATOLOGÍA ONCOLÓGICA"~"15135-CONSULTA HEMATOLOGÍA ONCOLÓGICA",
`Centro de Costo` == "307-CONSULTA DE INMUNOLOGÍA"~"15136-CONSULTA DE INMUNOLOGÍA",
`Centro de Costo` == "309-CONSULTA CIRUGÍA GENERAL"~"15201-CONSULTA CIRUGÍA GENERAL",
`Centro de Costo` == "311-CONSULTA UROLOGÍA"~"15203-CONSULTA UROLOGÍA",
`Centro de Costo` == "316-CONSULTA CIRUGÍA PLÁSTICA"~"15208-CONSULTA CIRUGÍA PLÁSTICA",
`Centro de Costo` == "317-CONSULTA OFTALMOLOGÍA"~"15209-CONSULTA OFTALMOLOGÍA",
`Centro de Costo` == "318-CONSULTA CIRUGÍA VASCULAR PERIFÉRICA"~"15210-CONSULTA CIRUGÍA VASCULAR PERIFÉRICA",
`Centro de Costo` == "319-CONSULTA OTORRINOLARINGOLOGÍA"~"15211-CONSULTA OTORRINOLARINGOLOGÍA",
`Centro de Costo` == "323-CONSULTA CIRUGÍA MAXILOFACIAL"~"15215-CONSULTA CIRUGÍA MAXILOFACIAL",
`Centro de Costo` == "326-CONSULTA DE TRAUMATOLOGÍA"~"15218-CONSULTA DE TRAUMATOLOGÍA",
`Centro de Costo` == "328-CONSULTA PEDIATRÍA GENERAL"~"15302-CONSULTA PEDIATRÍA GENERAL",
`Centro de Costo` == "329-CONSULTA NEONATOLOGÍA"~"15303-CONSULTA NEONATOLOGÍA",
`Centro de Costo` == "331-CONSULTA NEUROLOGÍA PEDIÁTRICA"~"15305-CONSULTA NEUROLOGÍA PEDIÁTRICA",
`Centro de Costo` == "342-CONSULTA TRAUMATOLOGÍA PEDIÁTRICA"~"15316-CONSULTA TRAUMATOLOGÍA PEDIÁTRICA",
`Centro de Costo` == "351-CONSULTA CIRUGÍA PEDIÁTRICA"~"15409-CONSULTA CIRUGÍA PEDIÁTRICA",
`Centro de Costo` == "353-CONSULTA GINECOLOGICA"~"15502-CONSULTA GINECOLOGICA",
`Centro de Costo` == "354-CONSULTA OBSTETRICIA"~"15503-CONSULTA OBSTETRICIA",
`Centro de Costo` == "230-CONSULTA NUTRICIÓN"~"15008-CONSULTA NUTRICIÓN",
`Centro de Costo` == "232-CONSULTA OTROS PROFESIONALES"~"15010-CONSULTA OTROS PROFESIONALES",
`Centro de Costo` == "356-CONSULTA ODONTOLOGÍA"~"15602-CONSULTA ODONTOLOGÍA",
`Centro de Costo` == "152-HOSPITALIZACIÓN EN CASA"~"2002-HOSPITALIZACIÓN EN CASA",
`Centro de Costo` == "159-HOSPITALIZACIÓN DE DIA"~"2009-HOSPITALIZACIÓN DE DIA",
`Centro de Costo` == "244-PROCEDIMIENTO DE NEUMOLOGÍA"~"15022-PROCEDIMIENTO DE NEUMOLOGÍA",
`Centro de Costo` == "249-PROCEDIMIENTOS DE DERMATOLOGÍA"~"15027-PROCEDIMIENTOS DE DERMATOLOGÍA",
`Centro de Costo` == "250-PROCEDIMIENTOS DE GASTROENTEROLOGÍA"~"15028-PROCEDIMIENTOS DE GASTROENTEROLOGÍA",
`Centro de Costo` == "251-PROCEDIMIENTOS DE GINECOLOGÍA"~"15029-PROCEDIMIENTOS DE GINECOLOGÍA",
`Centro de Costo` == "258-PROCEDIMIENTOS DE OFTALMOLOGÍA"~"15036-PROCEDIMIENTOS DE OFTALMOLOGÍA",
`Centro de Costo` == "261-PROCEDIMIENTOS DE OTORRINOLARINGOLOGÍA"~"15039-PROCEDIMIENTOS DE OTORRINOLARINGOLOGÍA",
`Centro de Costo` == "263-PROCEDIMIENTOS DE UROLOGÍA"~"15041-PROCEDIMIENTOS DE UROLOGÍA",
`Centro de Costo` == "269-PROCEDIMIENTOS DE NEUROLOGÍA"~"15047-PROCEDIMIENTOS DE NEUROLOGÍA",
`Centro de Costo` == "542-IMAGENOLOGÍA"~"41108-IMAGENOLOGÍA",
`Centro de Costo` == "575-BANCO DE SANGRE"~"51001-BANCO DE SANGRE",
`Centro de Costo` == "593-SERVICIO FARMACEUTICO"~"55101-SERVICIO FARMACEUTICO",
`Centro de Costo` == "662-CENTRAL DE ESTERILIZACIÓN"~"95301-CENTRAL DE ESTERILIZACIÓN",
`Centro de Costo` == "657-LAVANDERIA Y ROPERIA"~"95201-LAVANDERIA Y ROPERIA",
`Centro de Costo` == "664-TRANSPORTE GENERAL"~"95401-TRANSPORTE GENERAL",
`Centro de Costo` == "665-MANTENIMIENTO"~"95501-MANTENIMIENTO",
`Centro de Costo` == "713-TRABAJO SOCIAL"~"99544-TRABAJO SOCIAL",
TRUE ~ `Centro de Costo`))
# Asigna proporcion uti/uci cardio ----------------------------------------
ucicv <- GG1 %>% filter(`Centro de Costo`=="198-UNIDAD DE TRATAMIENTO INTENSIVO CORONARIOS") %>%
mutate(`Centro de Costo`= "177-UNIDAD DE CUIDADOS CORONARIOS", Devengado=Devengado*0.44, Cuenta=Cuenta, Tipo=Tipo)
uticv <- GG1 %>% filter(`Centro de Costo`=="198-UNIDAD DE TRATAMIENTO INTENSIVO CORONARIOS") %>%
mutate(`Centro de Costo`=  `Centro de Costo`, Devengado=Devengado*0.56, Cuenta=Cuenta, Tipo=Tipo)
ucicv <- rbind(ucicv,uticv)
GG1 <- GG1 %>% filter(`Centro de Costo` != "198-UNIDAD DE TRATAMIENTO INTENSIVO CORONARIOS" )
GG1 <- rbind(GG1, ucicv)
# #Asigna costos a Urgencia Odontologica ----------------------------------
urg_odo <- GG1 %>% filter(`Centro de Costo`=="216-EMERGENCIAS PEDIÁTRICAS") %>%
mutate(`Centro de Costo`= "357-EMERGENCIAS ODONTOLOGICAS", Devengado=Devengado*0.1, Cuenta=Cuenta, Tipo=Tipo)
urg  <- GG1 %>% filter(`Centro de Costo`=="216-EMERGENCIAS PEDIÁTRICAS") %>%
mutate(`Centro de Costo`=  `Centro de Costo`, Devengado=Devengado*0.9, Cuenta=Cuenta, Tipo=Tipo)
urg_odo <- rbind(urg_odo,urg)
GG1 <- GG1 %>% filter(`Centro de Costo` != "216-EMERGENCIAS PEDIÁTRICAS" )
GG1 <- rbind(GG1, urg_odo)
# Elimina cuentas que no deben ir en Administración -----------------------
GG1$`Centro de Costo` <- ifelse(GG1$`Centro de Costo`=="670-ADMINISTRACIÓN" &
(GG1$Cuenta == "21-MATERIALES DE CURACIÓN" |
GG1$Cuenta == "18-MATERIAL MEDICO QUIRURGICO" |
GG1$Cuenta == "30-MEDICAMENTOS" ), "116-HOSPITALIZACIÓN PEDIATRÍA", GG1$`Centro de Costo`)
# Valores -----------------------------------------------------------------
sum(SIGFE$Devengado)
SIGFE %>%  filter(Tipo != "Insumos") %>%
summarise(sum(Devengado))
sum(GG1$Devengado)
diferencia <- sum(SIGFE$Devengado)-sum(GG1$Devengado)-sum(Compras_Servicios$Devengado)
diferencia
medicamentos <- SIGFE %>% filter(SIGCOM == "30-MEDICAMENTOS") %>% summarise(devengo_medicamentos = sum(Devengado))
openxlsx::write.xlsx(GG1, graba, colNames = TRUE, sheetName = "SIGFE", overwrite = TRUE)
rm(`471-QUIRÓFANOS MAYOR AMBULATORIA`, `473-QUIRÓFANOS MENOR AMBULATORIA`,a, am, b,
Cant_RRHH, ConsumoxCC, cuenta_insumos, cuentas, cuentas_cae, cuentas_clinico,
cuentas_qx, cuentas_total, Farmacia, ggenerales, graba, i, insumos, M2_Pab_EqMed,
mes_archivo, Metros_pabellon, proporcion_exacta, q, qx, resto, RRHH_sigfe, ruta_base,
CAE_prorratear, cant_RRHH, CCC, CxCC, CxCC_H, df, EqMed, EqMedCorrec,
EqMedPrev, Farm, GG1_nulo, GG2, GG3, GG33, GG4, GG44, M2, M2_exacto, M2Pab, SIGFE2, cuentas_no_critico)
sum(Compras_Servicios$Devengado)
ifelse(medicamentos$devengo_medicamentos<=0, toupper("No existe devengo de Medicamentos"),tolower("Medicamentos correctos"))
rm(medicamentos)
View(SIGFE)
View(Compras_Servicios)
library(tidyverse)
library(readxl)
library(lubridate)
library(janitor)
library(dplyr)
library(openxlsx)
library(xlsx)
# Cubo 09 -----------------------------------------------------------------
fecha_mes <- "2022-06-01"
PM_GRD <- c(1.3239,	1.1900,	1.2501,	1.3399,	1.3454,	1.3679,	1.3505,	1.3420,	1.1704,	1.2395,	1.1703,1.2219,
1.2734,1.3280, 1.1678, 1.2583, 1.1628, 1.2618)
fecha_solo_mes <- str_sub(fecha_mes,1,7)
ruta_base <- "C:/Users/control.gestion3/OneDrive/"
Arch_cubo9 <- paste0(ruta_base,"BBDD Produccion/PERC/Cubos 9/Cubo_9 ",fecha_solo_mes,".xlsx")
C9_BBDD <- paste0(ruta_base,"BBDD Produccion/PERC/Cubos 9/Cubo_9 BBDD.xlsx")
Cubo_9M <- read_xlsx(Arch_cubo9, na = " ",col_names = TRUE)
Cubo_9 <- read_xlsx(C9_BBDD, na = " ",col_names = TRUE)
colnames(Cubo_9M)[1] <- "Variable"
Cubo_9$Fecha=as.character(Cubo_9$Fecha)
Cubo_9M <- Cubo_9M %>% mutate("Item" = case_when(
Variable=="Recursos Humanos"~"Total RRHH",
Variable=="Salario"~"Detalle RRHH",
Variable=="Bonificaciones"~"Detalle RRHH",
Variable=="Beneficios"~"Detalle RRHH",
Variable=="Gastos Generales"~"Total Gastos Generales",
Variable=="SERVICIO DE AGUA"~"Detalle Gastos Generales",
Variable=="ARRENDAMIENTOS"~"Detalle Gastos Generales",
Variable=="COLOCACIÓN FAMILIAR DE MENORES Y EXTRAHOSPITALARIA"~"Detalle Gastos Generales",
Variable=="COMPRA DE CAMAS AL EXTRA SISTEMA CAMAS CRÍTICAS"~"Detalle Gastos Generales",
Variable=="COMPRA DE CAMAS AL EXTRA SISTEMA CAMAS NO CRÍTICAS"~"Detalle Gastos Generales",
Variable=="COMPRA DE CONSULTAS MÉDICAS"~"Detalle Gastos Generales",
Variable=="COMPRA DE CONSULTAS NO MÉDICAS"~"Detalle Gastos Generales",
Variable=="COMPRA DE INTERVENCIONES QUIRÚRGICAS CLÍNICAS"~"Detalle Gastos Generales",
Variable=="COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL EXTERNO"~"Detalle Gastos Generales",
Variable=="COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL INTERNO"~"Detalle Gastos Generales",
Variable=="COMPRA DE OTROS SERVICIOS"~"Detalle Gastos Generales",
Variable=="CURSOS DE CAPACITACIÓN"~"Detalle Gastos Generales",
Variable=="SERVICIO DE ENERGÍA"~"Detalle Gastos Generales",
Variable=="ENLACES DE TELECOMUNICACIONES"~"Detalle Gastos Generales",
Variable=="GAS PROPANO"~"Detalle Gastos Generales",
Variable=="MANTENIMIENTO DE PRADOS Y JARDINES"~"Detalle Gastos Generales",
Variable=="MANTENIMIENTO EQUIPO DE CÓMPUTO"~"Detalle Gastos Generales",
Variable=="MANTENIMIENTO MAQUINARIA Y EQUIPO"~"Detalle Gastos Generales",
Variable=="MANTENIMIENTO MUEBLES Y ENSERES"~"Detalle Gastos Generales",
Variable=="MANTENIMIENTO PLANTA FÍSICA"~"Detalle Gastos Generales",
Variable=="MANTENIMIENTO Y REPARACION DE VEHICULOS"~"Detalle Gastos Generales",
Variable=="MANTENIMIENTO Y REPARACIÓN MÁQUINA Y EQUIPO CORRECTIVO"~"Detalle Gastos Generales",
Variable=="MANTENIMIENTO Y REPARACIÓN MÁQUINA Y EQUIPO PREVENTIVO"~"Detalle Gastos Generales",
Variable=="OTROS GASTOS GENERALES"~"Detalle Gastos Generales",
Variable=="OTROS MANTENIMIENTOS"~"Detalle Gastos Generales",
Variable=="PASAJES Y TRASLADOS DE PACIENTES"~"Detalle Gastos Generales",
Variable=="PASAJES, FLETES Y BODEGAJE"~"Detalle Gastos Generales",
Variable=="PUBLICIDAD Y PROPAGANDA"~"Detalle Gastos Generales",
Variable=="SALA CUNAS Y/O SERVICIOS INFANTILES"~"Detalle Gastos Generales",
Variable=="SEGUROS GENERALES"~"Detalle Gastos Generales",
Variable=="SERVICIO DE ASEO"~"Detalle Gastos Generales",
Variable=="SERVICIO DE INTERMEDIACIÓN CENABAST"~"Detalle Gastos Generales",
Variable=="SERVICIO DE LABORATORIO"~"Detalle Gastos Generales",
Variable=="SERVICIO DE LAVANDERÍA"~"Detalle Gastos Generales",
Variable=="SERVICIO DE MENSAJERIA Y/O CORREO"~"Detalle Gastos Generales",
Variable=="SERVICIO DE TRANSPORTE"~"Detalle Gastos Generales",
Variable=="SERVICIO DE VIGILANCIA Y SEGURIDAD"~"Detalle Gastos Generales",
Variable=="SERVICIOS GENERALES"~"Detalle Gastos Generales",
Variable=="SERVICIO DE TELECOMUNICACIONES"~"Detalle Gastos Generales",
Variable=="Insumos"~"Total Insumos",
Variable=="COMBUSTIBLES Y LUBRICANTES"~"Detalle Insumos",
Variable=="EQUIPOS MENORES"~"Detalle Insumos",
Variable=="GASES MEDICINALES"~"Detalle Insumos",
Variable=="LIBROS, TEXTOS, UTILES DE ENSEÑANZA Y PUBLICACIONES"~"Detalle Insumos",
Variable=="MATERIAL DE ODONTOLOGÍA"~"Detalle Insumos",
Variable=="MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS"~"Detalle Insumos",
Variable=="MATERIAL MEDICO QUIRURGICO"~"Detalle Insumos",
Variable=="MATERIALES DE CURACIÓN"~"Detalle Insumos",
Variable=="MATERIALES DE OFICINA, PRODUCTOS DE PAPEL E IMPRESOS"~"Detalle Insumos",
Variable=="MATERIALES DE USO O CONSUMO"~"Detalle Insumos",
Variable=="MATERIALES INFORMATICOS"~"Detalle Insumos",
Variable=="MATERIALES PARA MANTENIMIENTO Y REPARACIONES DE INMUEBLES"~"Detalle Insumos",
Variable=="MATERIALES Y ELEMENTOS DE ASEO"~"Detalle Insumos",
Variable=="MEDICAMENTOS"~"Detalle Insumos",
Variable=="MENAJE PARA OFICINA, CASINO Y OTROS"~"Detalle Insumos",
Variable=="OTROS INSUMOS Y MATERIALES"~"Detalle Insumos",
Variable=="PRODUCTOS QUÍMICOS"~"Detalle Insumos",
Variable=="PRODUCTOS TEXTILES, VESTUARIO Y CALZADO"~"Detalle Insumos",
Variable=="REPUESTOS Y ACCESORIOS PARA MANTENIMIENTO Y REPARACIONES DE VEHICULOS"~"Detalle Insumos",
Variable=="VÍVERES"~"Detalle Insumos",
Variable=="Total Directos"~"Total Directos",
Variable=="Total Indirectos"~"Total Indirectos",
Variable=="TRABAJO SOCIAL"~"Detalle Indirectos",
Variable=="MANTENIMIENTO"~"Detalle Indirectos",
Variable=="TRANSPORTE GENERAL"~"Detalle Indirectos",
Variable=="CENTRAL DE ESTERILIZACIÓN"~"Detalle Indirectos",
Variable=="SERVICIO DE ALIMENTACIÓN"~"Detalle Indirectos",
Variable=="ASEO"~"Detalle Indirectos",
Variable=="SERVICIO FARMACEUTICO"~"Detalle Indirectos",
Variable=="BANCO DE SANGRE"~"Detalle Indirectos",
Variable=="REHABILITACIÓN"~"Detalle Indirectos",
Variable=="ANATOMÍA PATOLÓGICA"~"Detalle Indirectos",
Variable=="IMAGENOLOGÍA"~"Detalle Indirectos",
Variable=="LABORATORIO CLÍNICO"~"Detalle Indirectos",
Variable=="QUIRÓFANOS MENOR AMBULATORIA"~"Detalle Indirectos",
Variable=="PROCEDIMIENTOS DE NEUROLOGÍA"~"Detalle Indirectos",
Variable=="PROCEDIMIENTOS DE TRAUMATOLOGÍA"~"Detalle Indirectos",
Variable=="PROCEDIMIENTOS DE OTORRINOLARINGOLOGÍA"~"Detalle Indirectos",
Variable=="PROCEDIMIENTO ONCOLOGÍA"~"Detalle Indirectos",
Variable=="PROCEDIMIENTOS DE GASTROENTEROLOGÍA"~"Detalle Indirectos",
Variable=="PROCEDIMIENTOS DE DERMATOLOGÍA"~"Detalle Indirectos",
Variable=="PROCEDIMIENTO DE NEUMOLOGÍA"~"Detalle Indirectos",
Variable=="PROCEDIMIENTO DE CARDIOLOGÍA"~"Detalle Indirectos",
Variable=="PROCEDIMIENTOS DE GINECOLOGÍA"~"Detalle Indirectos",
Variable=="PROCEDIMIENTOS DE UROLOGÍA"~"Detalle Indirectos",
Variable=="PROCEDIMIENTOS DE OFTALMOLOGÍA"~"Detalle Indirectos",
Variable=="ADMINISTRACIÓN"~"Detalle Indirectos",
Variable=="Total General"~"Total General",
Variable=="Total Produccion 1"~"p1",
Variable=="Costo por Produccion 1"~"c1",
Variable=="Total Produccion 2"~"p2",
Variable=="Costo por Produccion 2"~"c2",
Variable=="Total Produccion 3"~"p3",
Variable=="Costo por Produccion 3"~"c3",
Variable=="Total Produccion 4"~"p4",
Variable=="Costo por Produccion 4"~"c4",
Variable=="Total Produccion 5"~"p5",
Variable=="Costo por Produccion 5"~"c5",
Variable=="Numero de Camas"~"Numero de camas",
Variable=="Costo por Número de Camas"~"Costo por camas",
Variable=="QUIRÓFANOS MAYOR AMBULATORIA"~"Detalle Indirectos",
TRUE ~ "Asignar Variable"))
Cubo_9M <- mutate_all(Cubo_9M, ~replace(., is.na(.), 0))
Cubo_9M$TOTAL <- NULL
Item <- Cubo_9M
Cubo_9M$Item <- NULL
Item$Variable <- NULL
Cubo_9M <- Cubo_9M %>%
pivot_longer(-Variable,
names_to = "CC",
values_to = "total")
Item <- Item %>%
pivot_longer(-Item,
names_to = "CC",
values_to = "total")
Item$CC <- NULL
Item$total <- NULL
Item$Fecha <- fecha_mes
Item <- select(Item, Fecha, Item)
Cubo_9M <- cbind(Item, Cubo_9M)
Cubo_9 <- rbind(Cubo_9M, Cubo_9)
Cubo_9$Fecha=as.Date(Cubo_9$Fecha)
openxlsx::write.xlsx(Cubo_9, C9_BBDD, colNames = TRUE,
sheetName = "Cubo9", overwrite = T)
rm(Item, C9_BBDD, Cubo_9M, Arch_cubo9, fecha_mes)
