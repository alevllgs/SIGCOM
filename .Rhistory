UMT_perc <- rbind(UMT1, UMT2) %>%
filter(`PERC ASOCIADO`!="575-BANCO DE SANGRE" & Cantidad>0)
# Esterilizacion ----------------------------------------------------------
esterilizacion <- esterilizacion_perc  %>%
mutate(Cantidad =`662_2-CENTRAL DE ESTERILIZACIÓN | Metro cúbico`) %>%
select(`PERC ASOCIADO`, Cantidad)
esterilizacion$Item <- "662_2-CENTRAL DE ESTERILIZACIÓN | Metro cúbico"
lavanderia <- esterilizacion_perc  %>%
mutate(Cantidad =`657_1-LAVANDERIA Y ROPERIA | Kilo`) %>%
select(`PERC ASOCIADO`, Cantidad)
lavanderia$Item <- "657_1-LAVANDERIA Y ROPERIA | Kilo"
esterilizacion_perc <- esterilizacion %>%
filter(`PERC ASOCIADO`!="662-CENTRAL DE ESTERILIZACIÓN" & `PERC ASOCIADO`!="657-LAVANDERIA Y ROPERIA" & Cantidad>0) #no esta conectada lavanderia xq no es un CC
# Farmacia ----------------------------------------------------------------
farmacia_perc <- farmacia_perc  %>%
mutate(Cantidad =`593_2-SERVICIO FARMACEUTICO | Prescripción`) %>% select(`PERC ASOCIADO`, Cantidad)
farmacia_perc$Item <- "593_2-SERVICIO FARMACEUTICO | Prescripción"
# Rehabilitacion ----------------------------------------------------------
colnames(rehabilitacion_perc)[1] <- "PERC ASOCIADO"
colnames(rehabilitacion_perc)[2] <- "Cantidad"
rehabilitacion_perc$Item <- "567_1-REHABILITACIÓN | Sesión"
rehabilitacion_perc <- rehabilitacion_perc %>%
mutate("PERC ASOCIADO" = case_when(`PERC ASOCIADO` == "NEUROLÓGICOS TRAUMATISMO ENCÉFALO CRANEANO (TEC)"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
`PERC ASOCIADO` == "NEUROLÓGICOS LESIÓN MEDULAR"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
`PERC ASOCIADO` == "NEUROLÓGICOS ACCIDENTE CEREBRO VASCULAR (ACV)"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
`PERC ASOCIADO` == "NEUROLÓGICOS DISRAFIA"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
`PERC ASOCIADO` == "NEUROLÓGICAS TUMORES"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
`PERC ASOCIADO` == "PARÁLISIS CEREBRAL"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
`PERC ASOCIADO` == "QUEMADOS (NO GES)"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
`PERC ASOCIADO` == "GRAN QUEMADO (GES)"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
`PERC ASOCIADO` == "SENSORIALES AUDITIVOS"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
`PERC ASOCIADO` == "SENSORIALES VISUALES"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
`PERC ASOCIADO` == "TRAUMATOLÓGICOS"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
`PERC ASOCIADO` == "AMPUTADOS POR OTRAS CAUSAS"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
`PERC ASOCIADO` == "AMPUTADOS POR DIABETES"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
`PERC ASOCIADO` == "ENFERMEDADES DEL CORAZÓN"~"198-UNIDAD DE TRATAMIENTO INTENSIVO CORONARIOS",
`PERC ASOCIADO` == "RESPIRATORIO"~"282-CONSULTA NEUMOLOGÍA",
`PERC ASOCIADO` == "NEUROMUSCULARES AGUDAS"~"331-CONSULTA NEUROLOGÍA PEDIÁTRICA",
`PERC ASOCIADO` == "NEUROMUSCULARES CRÓNICAS"~"331-CONSULTA NEUROLOGÍA PEDIÁTRICA",
`PERC ASOCIADO` == "REUMATOLÓGICAS"~"275-CONSULTA REUMATOLOGÍA",
`PERC ASOCIADO` == "NEUROLÓGICAS ESCLEROSIS LATERAL AMIOTRÓFICA (ELA)"~"331-CONSULTA NEUROLOGÍA PEDIÁTRICA",
`PERC ASOCIADO` == "RETRASO EN EL DESARROLLO PSICOMOTOR"~"331-CONSULTA NEUROLOGÍA PEDIÁTRICA",
`PERC ASOCIADO` == "ONCOLÓGICOS"~"87-HOSPITALIZACIÓN ONCOLOGÍA",
`PERC ASOCIADO` == "SINDROME DE INMOVILIZACIÓN"~"331-CONSULTA NEUROLOGÍA PEDIÁTRICA",
`PERC ASOCIADO` == "CUIDADOS PALIATIVOS"~"87-HOSPITALIZACIÓN ONCOLOGÍA",
`PERC ASOCIADO` == "CIRUGÍA MAYOR ABDOMINAL"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
TRUE ~ "Asignar Centro de Costo"
)) %>% filter(Cantidad>0)
# Cirugias Menores --------------------------------------------------------
colnames(cmenor_perc)[1] <- "PERC ASOCIADO"
colnames(cmenor_perc)[10] <- "Cantidad"
cmenor_perc <- cmenor_perc %>% select(`PERC ASOCIADO`, Cantidad) %>% filter(Cantidad != "NA")
cmenor_perc$Item <- "473_1-QUIRÓFANOS MENOR AMBULATORIA | Intervencion quirurgica"
cmenor_perc <- cmenor_perc %>%
mutate("PERC ASOCIADO" = case_when(`PERC ASOCIADO` == "CIRUGIA OFTALMOLOGICA"~"475-QUIRÓFANOS NEUROCIRUGÍA",
`PERC ASOCIADO` == "CIRUGIA OTORRINOLOGICA"~"471-QUIRÓFANOS MAYOR AMBULATORIA",
`PERC ASOCIADO` == "CIRUGIA DE CABEZA Y CUELLO"~"471-QUIRÓFANOS MAYOR AMBULATORIA",
`PERC ASOCIADO` == "NEUROLÓGICOS DISRAFIA"~"495-QUIRÓFANOS CIRUGÍA VASCULAR",
`PERC ASOCIADO` == "CIRUGIA PLASTICA Y REPARADORA"~"493-QUIRÓFANOS CIRUGÍA PLÁSTICA",
`PERC ASOCIADO` == "TEGUMENTOS"~"495-QUIRÓFANOS CIRUGÍA VASCULAR",
`PERC ASOCIADO` == "CIRUGIA CARDIOVASCULAR"~"464-QUIRÓFANOS CARDIOVASCULAR",
`PERC ASOCIADO` == "CIRUGIA DE TORAX"~"495-QUIRÓFANOS CIRUGÍA VASCULAR",
`PERC ASOCIADO` == "CIRUGIA ABDOMINAL"~"467-QUIRÓFANOS DIGESTIVA",
`PERC ASOCIADO` == "CIRUGIA PROCTOLOGICA"~"495-QUIRÓFANOS CIRUGÍA VASCULAR",
`PERC ASOCIADO` == "CIRUGIA UROLOGICA Y SUPRARRENAL"~"486-QUIRÓFANOS UROLOGÍA",
`PERC ASOCIADO` == "CIRUGIA DE LA MAMA"~"495-QUIRÓFANOS CIRUGÍA VASCULAR",
`PERC ASOCIADO` == "CIRUGIA GINECOLOGICA"~"486-QUIRÓFANOS UROLOGÍA",
`PERC ASOCIADO` == "CIRUGIA OBSTETRICA"~"495-QUIRÓFANOS CIRUGÍA VASCULAR",
`PERC ASOCIADO` == "TRAUMATOLOGIA"~"485-QUIRÓFANOS TRAUMATOLOGÍA Y ORTOPEDIA",
`PERC ASOCIADO` == "ODONTOLOGIA (COD 27-03) Aranc.Fonasa"~"356-CONSULTA ODONTOLOGÍA",
`PERC ASOCIADO` == "RETIRO ELEMENTOS OSTEOSINTESIS"~"485-QUIRÓFANOS TRAUMATOLOGÍA Y ORTOPEDIA",
`PERC ASOCIADO` == "ODONTOLOGIA"~"356-CONSULTA ODONTOLOGÍA",
TRUE ~ "Asignar Centro de Costo"
))
# Transporte --------------------------------------------------------------
t1 <- transporte_perc  %>% mutate(Cantidad =`664_1-TRANSPORTE GENERAL | Traslado`) %>% select(`PERC ASOCIADO`, Cantidad)
t1$Item <- "664_1-TRANSPORTE GENERAL | Traslado"
t2 <- transporte_perc %>% mutate(Cantidad =`664_2-TRANSPORTE GENERAL | Kilómetro`) %>% select(`PERC ASOCIADO`, Cantidad)
t2$Item <- "664_2-TRANSPORTE GENERAL | Kilómetro"
t3 <- transporte_perc  %>% mutate(Cantidad =`664_3-TRANSPORTE GENERAL | Viajes`) %>% select(`PERC ASOCIADO`, Cantidad)
t3$Item <- "664_3-TRANSPORTE GENERAL | Viajes"
transporte_perc <- rbind(t1, t2, t3) %>% filter(Cantidad>0 & `PERC ASOCIADO`!="664-TRANSPORTE GENERAL")
# Juntar ------------------------------------------------------------------
unidades <- rbind(cmenor_perc, farmacia_perc, rehabilitacion_perc, aseo_perc, anatomia_patologica_perc, imagenologia_perc, laboratorio_perc, UMT_perc, esterilizacion_perc, psicosocial_perc, transporte_perc, alimentacion_perc, equipos_medicos_perc, p_cardio, p_dermato, p_gastro, p_neumo, p_neurologia, p_oto, p_tmt)
unidades <- unidades %>% mutate(`PERC ASOCIADO` = case_when(
`PERC ASOCIADO`=="713-TRABAJO SOCIAL" ~ "99544-TRABAJO SOCIAL",
`PERC ASOCIADO`=="478-QUIRÓFANOS OFTALMOLOGÍA" ~ "471-QUIRÓFANOS MAYOR AMBULATORIA",
`PERC ASOCIADO`=="480-QUIRÓFANOS OTORRINOLARINGOLOGÍA" ~ "471-QUIRÓFANOS MAYOR AMBULATORIA",
TRUE ~ `PERC ASOCIADO`), Cantidad = round(Cantidad))
# crea un prorrateo de UCI y UTI ------------------------------------------
uti <- unidades %>% filter(`PERC ASOCIADO`=="170-UNIDAD DE CUIDADOS INTENSIVOS PEDIATRIA") %>%
mutate(`PERC ASOCIADO`="196-UNIDAD DE TRATAMIENTO INTENSIVO PEDÍATRICA", Cantidad=Cantidad*0.57,Item=Item)
uci <- unidades %>% filter(`PERC ASOCIADO`=="170-UNIDAD DE CUIDADOS INTENSIVOS PEDIATRIA") %>%
mutate(`PERC ASOCIADO`=`PERC ASOCIADO`, Cantidad=Cantidad*0.43,Item=Item)
ucicv <- unidades %>% filter(`PERC ASOCIADO`=="198-UNIDAD DE TRATAMIENTO INTENSIVO CORONARIOS") %>%
mutate(`PERC ASOCIADO`="177-UNIDAD DE CUIDADOS CORONARIOS", Cantidad=Cantidad*0.44,Item=Item)
uticv <- unidades %>% filter(`PERC ASOCIADO`=="198-UNIDAD DE TRATAMIENTO INTENSIVO CORONARIOS") %>%
mutate(`PERC ASOCIADO`=`PERC ASOCIADO`, Cantidad=Cantidad*0.56,Item=Item)
uti <- rbind(uti, uci, ucicv, uticv)
unidades <- unidades %>% filter(`PERC ASOCIADO` != "170-UNIDAD DE CUIDADOS INTENSIVOS PEDIATRIA" |
`PERC ASOCIADO` != "198-UNIDAD DE TRATAMIENTO INTENSIVO CORONARIOS")
unidades <- rbind(unidades, uti)
# Separar Odonto Urgencia -------------------------------------------------
ODOURG1 <- unidades %>% filter(`PERC ASOCIADO`== "216-EMERGENCIAS PEDIÁTRICAS") %>%
mutate(`PERC ASOCIADO` ="357-EMERGENCIAS ODONTOLOGICAS", Cantidad = round(Cantidad*0.1))
URG <- unidades %>% filter(`PERC ASOCIADO`== "216-EMERGENCIAS PEDIÁTRICAS") %>%
mutate(Cantidad = round(Cantidad*0.9))
unidades <- unidades %>% filter(`PERC ASOCIADO`!= "216-EMERGENCIAS PEDIÁTRICAS")
unidades <- rbind(ODOURG1, URG, unidades)
# Elimino parametros que no se ocuparan en 2022 ---------------------------
unidades <- unidades %>% filter(
Item != "593_1-SERVICIO FARMACEUTICO | Receta" &
Item != "575_1-BANCO DE SANGRE | Unidad"   &
Item != "664_1-TRANSPORTE GENERAL | Traslado" &
Item != "664_3-TRANSPORTE GENERAL | Viajes") %>%
mutate(Item =
case_when(Item == "665_1-MANTENIMIENTO | Órden"~"95501_1-MANTENIMIENTO | Órden",
Item == "662_2-CENTRAL DE ESTERILIZACIÓN | Metro cúbico"~"95301_1-CENTRAL DE ESTERILIZACIÓN | Metro cúbico",
Item == "593_2-SERVICIO FARMACEUTICO | Prescripción"~"55101_1-SERVICIO FARMACEUTICO | Prescripción",
Item == "542_1-IMAGENOLOGÍA | Estudio"~"41108_1-IMAGENOLOGÍA | Exámen",
Item == "657_1-LAVANDERIA Y ROPERIA | Kilo"~"95201_1-LAVANDERIA Y ROPERIA | Kilo",
Item == "664_2-TRANSPORTE GENERAL | Kilómetro"~"95401_1-TRANSPORTE GENERAL | Kilómetro",
Item == "575_2-BANCO DE SANGRE | Exámen"~"51001_1-BANCO DE SANGRE | Exámen",
TRUE ~ Item))
# Asigna CC actualizados al 2022 ------------------------------------------
unidades <- unidades %>% mutate(`PERC ASOCIADO` =
case_when(
`PERC ASOCIADO` ==	"478-QUIRÓFANOS OFTALMOLOGÍA"	~	"471-QUIRÓFANOS MAYOR AMBULATORIA",
`PERC ASOCIADO` ==	"480-QUIRÓFANOS OTORRINOLARINGOLOGÍA"	~	"471-QUIRÓFANOS MAYOR AMBULATORIA",
`PERC ASOCIADO` == "273-CONSULTA MEDICINA INTERNA"~"15102-CONSULTA MEDICINA INTERNA",
`PERC ASOCIADO` == "274-CONSULTA NEUROLOGÍA"~"15103-CONSULTA NEUROLOGÍA",
`PERC ASOCIADO` == "275-CONSULTA REUMATOLOGÍA"~"15104-CONSULTA REUMATOLOGÍA",
`PERC ASOCIADO` == "276-CONSULTA CARDIOLOGÍA"~"15105-CONSULTA CARDIOLOGÍA",
`PERC ASOCIADO` == "277-CONSULTA DERMATOLOGÍA"~"15106-CONSULTA DERMATOLOGÍA",
`PERC ASOCIADO` == "278-CONSULTA ONCOLOGÍA"~"15107-CONSULTA ONCOLOGÍA",
`PERC ASOCIADO` == "279-PROGRAMA VIH"~"15108-PROGRAMA VIH",
`PERC ASOCIADO` == "280-CONSULTA PSIQUIATRÍA"~"15109-CONSULTA PSIQUIATRÍA",
`PERC ASOCIADO` == "281-CONSULTA ENDOCRINOLOGÍA"~"15110-CONSULTA ENDOCRINOLOGÍA",
`PERC ASOCIADO` == "282-CONSULTA NEUMOLOGÍA"~"15111-CONSULTA NEUMOLOGÍA",
`PERC ASOCIADO` == "284-CONSULTA INFECTOLOGÍA"~"15113-CONSULTA INFECTOLOGÍA",
`PERC ASOCIADO` == "285-CONSULTA NEFROLOGÍA"~"15114-CONSULTA NEFROLOGÍA",
`PERC ASOCIADO` == "286-CONSULTA GENÉTICA"~"15115-CONSULTA GENÉTICA",
`PERC ASOCIADO` == "287-CONSULTA HEMATOLOGÍA"~"15116-CONSULTA HEMATOLOGÍA",
`PERC ASOCIADO` == "288-CONSULTA GERIATRÍA"~"15117-CONSULTA GERIATRÍA",
`PERC ASOCIADO` == "289-CONSULTA FISIATRÍA"~"15118-CONSULTA FISIATRÍA",
`PERC ASOCIADO` == "290-CONSULTA GASTROENTEROLOGÍA"~"15119-CONSULTA GASTROENTEROLOGÍA",
`PERC ASOCIADO` == "292-CONSULTA NEUROCIRUGÍA"~"15121-CONSULTA NEUROCIRUGÍA",
`PERC ASOCIADO` == "294-PROGRAMA MANEJO DEL DOLOR"~"15123-PROGRAMA MANEJO DEL DOLOR",
`PERC ASOCIADO` == "295-CONSULTA SALUD OCUPACIONAL"~"15124-CONSULTA SALUD OCUPACIONAL",
`PERC ASOCIADO` == "296-CONSULTA ANESTESIOLOGIA"~"15125-CONSULTA ANESTESIOLOGIA",
`PERC ASOCIADO` == "302-PROGRAMA ENFERMEDADES DE TRANSMISIÓN SEXUAL"~"15131-PROGRAMA ENFERMEDADES DE TRANSMISIÓN SEXUAL",
`PERC ASOCIADO` == "306-CONSULTA HEMATOLOGÍA ONCOLÓGICA"~"15135-CONSULTA HEMATOLOGÍA ONCOLÓGICA",
`PERC ASOCIADO` == "307-CONSULTA DE INMUNOLOGÍA"~"15136-CONSULTA DE INMUNOLOGÍA",
`PERC ASOCIADO` == "309-CONSULTA CIRUGÍA GENERAL"~"15201-CONSULTA CIRUGÍA GENERAL",
`PERC ASOCIADO` == "311-CONSULTA UROLOGÍA"~"15203-CONSULTA UROLOGÍA",
`PERC ASOCIADO` == "316-CONSULTA CIRUGÍA PLÁSTICA"~"15208-CONSULTA CIRUGÍA PLÁSTICA",
`PERC ASOCIADO` == "317-CONSULTA OFTALMOLOGÍA"~"15209-CONSULTA OFTALMOLOGÍA",
`PERC ASOCIADO` == "318-CONSULTA CIRUGÍA VASCULAR PERIFÉRICA"~"15210-CONSULTA CIRUGÍA VASCULAR PERIFÉRICA",
`PERC ASOCIADO` == "319-CONSULTA OTORRINOLARINGOLOGÍA"~"15211-CONSULTA OTORRINOLARINGOLOGÍA",
`PERC ASOCIADO` == "323-CONSULTA CIRUGÍA MAXILOFACIAL"~"15215-CONSULTA CIRUGÍA MAXILOFACIAL",
`PERC ASOCIADO` == "326-CONSULTA DE TRAUMATOLOGÍA"~"15218-CONSULTA DE TRAUMATOLOGÍA",
`PERC ASOCIADO` == "328-CONSULTA PEDIATRÍA GENERAL"~"15302-CONSULTA PEDIATRÍA GENERAL",
`PERC ASOCIADO` == "329-CONSULTA NEONATOLOGÍA"~"15303-CONSULTA NEONATOLOGÍA",
`PERC ASOCIADO` == "331-CONSULTA NEUROLOGÍA PEDIÁTRICA"~"15305-CONSULTA NEUROLOGÍA PEDIÁTRICA",
`PERC ASOCIADO` == "342-CONSULTA TRAUMATOLOGÍA PEDIÁTRICA"~"15316-CONSULTA TRAUMATOLOGÍA PEDIÁTRICA",
`PERC ASOCIADO` == "351-CONSULTA CIRUGÍA PEDIÁTRICA"~"15409-CONSULTA CIRUGÍA PEDIÁTRICA",
`PERC ASOCIADO` == "353-CONSULTA GINECOLOGICA"~"15502-CONSULTA GINECOLOGICA",
`PERC ASOCIADO` == "354-CONSULTA OBSTETRICIA"~"15503-CONSULTA OBSTETRICIA",
`PERC ASOCIADO` == "230-CONSULTA NUTRICIÓN"~"15008-CONSULTA NUTRICIÓN",
`PERC ASOCIADO` == "232-CONSULTA OTROS PROFESIONALES"~"15010-CONSULTA OTROS PROFESIONALES",
`PERC ASOCIADO` == "356-CONSULTA ODONTOLOGÍA"~"15602-CONSULTA ODONTOLOGÍA",
`PERC ASOCIADO` == "152-HOSPITALIZACIÓN EN CASA"~"2002-HOSPITALIZACIÓN EN CASA",
`PERC ASOCIADO` == "159-HOSPITALIZACIÓN DE DIA"~"2009-HOSPITALIZACIÓN DE DIA",
`PERC ASOCIADO` == "244-PROCEDIMIENTO DE NEUMOLOGÍA"~"15022-PROCEDIMIENTO DE NEUMOLOGÍA",
`PERC ASOCIADO` == "249-PROCEDIMIENTOS DE DERMATOLOGÍA"~"15027-PROCEDIMIENTOS DE DERMATOLOGÍA",
`PERC ASOCIADO` == "250-PROCEDIMIENTOS DE GASTROENTEROLOGÍA"~"15028-PROCEDIMIENTOS DE GASTROENTEROLOGÍA",
`PERC ASOCIADO` == "251-PROCEDIMIENTOS DE GINECOLOGÍA"~"15029-PROCEDIMIENTOS DE GINECOLOGÍA",
`PERC ASOCIADO` == "258-PROCEDIMIENTOS DE OFTALMOLOGÍA"~"15036-PROCEDIMIENTOS DE OFTALMOLOGÍA",
`PERC ASOCIADO` == "261-PROCEDIMIENTOS DE OTORRINOLARINGOLOGÍA"~"15039-PROCEDIMIENTOS DE OTORRINOLARINGOLOGÍA",
`PERC ASOCIADO` == "263-PROCEDIMIENTOS DE UROLOGÍA"~"15041-PROCEDIMIENTOS DE UROLOGÍA",
`PERC ASOCIADO` == "269-PROCEDIMIENTOS DE NEUROLOGÍA"~"15047-PROCEDIMIENTOS DE NEUROLOGÍA",
`PERC ASOCIADO` == "542-IMAGENOLOGÍA"~"41108-IMAGENOLOGÍA",
`PERC ASOCIADO` == "575-BANCO DE SANGRE"~"51001-BANCO DE SANGRE",
`PERC ASOCIADO` == "593-SERVICIO FARMACEUTICO"~"55101-SERVICIO FARMACEUTICO",
`PERC ASOCIADO` == "662-CENTRAL DE ESTERILIZACIÓN"~"95301-CENTRAL DE ESTERILIZACIÓN",
`PERC ASOCIADO` == "657-LAVANDERIA Y ROPERIA"~"95201-LAVANDERIA Y ROPERIA",
`PERC ASOCIADO` == "664-TRANSPORTE GENERAL"~"95401-TRANSPORTE GENERAL",
`PERC ASOCIADO` == "665-MANTENIMIENTO"~"95501-MANTENIMIENTO",
`PERC ASOCIADO` == "713-TRABAJO SOCIAL"~"99544-TRABAJO SOCIAL",
TRUE ~ `PERC ASOCIADO`))
#CONTRALORIA
unid_reportar <- c(
"473_1-QUIRÓFANOS MENOR AMBULATORIA | Intervencion quirurgica",
"593_2-SERVICIO FARMACEUTICO | Prescripción",
"648_1-ASEO | Metro cuadrado",
"542_1-IMAGENOLOGÍA | Estudio",
"575_1-BANCO DE SANGRE | Unidad",
"575_2-BANCO DE SANGRE | Exámen",
"662_2-CENTRAL DE ESTERILIZACIÓN | Metro cúbico",
"664_2-TRANSPORTE GENERAL | Kilómetro",
"664_1-TRANSPORTE GENERAL | Traslado",
"664_3-TRANSPORTE GENERAL | Viajes",
"665_1-MANTENIMIENTO | Órden",
"652_1-SERVICIO DE ALIMENTACIÓN | Ración paciente",
"567_1-REHABILITACIÓN | Sesión",
"544_1-ANATOMÍA PATOLÓGICA | Estudio",
"518_1-LABORATORIO CLÍNICO | Exámen",
"99544_1-TRABAJO SOCIAL | Atención",
"249_1-PROCEDIMIENTOS DE DERMATOLOGÍA | Procedimiento",
"250_1-PROCEDIMIENTOS DE GASTROENTEROLOGÍA | Procedimiento",
"261_1-PROCEDIMIENTOS DE OTORRINOLARINGOLOGÍA | Procedimiento",
"262_1-PROCEDIMIENTOS DE TRAUMATOLOGÍA | Procedimiento",
"240_1-PROCEDIMIENTO DE CARDIOLOGÍA | Procedimiento",
"244_1-PROCEDIMIENTO DE NEUMOLOGÍA | Procedimiento",
"269_1-PROCEDIMIENTOS DE NEUROLOGÍA | Procedimiento")
contraloria <- data.frame(
"reportar" = as.character(c(unid_reportar)),
"capturado" = as.character(c(unid_reportar %in% unidades$Item))
)
openxlsx::write.xlsx(unidades, graba, colNames = TRUE, sheetName = "indirectos", overwrite = TRUE)
# Borrar Data -------------------------------------------------------------
rm(alimentacion_perc, anatomia_patologica_perc, aseo_perc, cmenor_perc, equipos_medicos_perc, esterilizacion, esterilizacion_perc, farmacia_perc, imagenologia_perc, laboratorio_perc, lavanderia, rehabilitacion_perc, t1, t2, t3, transporte_perc, UMT_perc, unid_reportar, psicosocial_perc, farmacia1, farmacia2, UMT1, UMT2, graba, cola_ruta_registro_a, cola_ruta_registro_b, resto_ruta_registro_a, resto_ruta_registro_b, ODOURG1, URG, uti, uci, uticv, ucicv, p_cardio, p_dermato, p_gastro, p_neumo, p_neurologia, p_oto, P_tmt)
library(readxl)
library(tidyverse)
mes_archivo <- "09 Septiembre"
ruta_base <- "C:/Users/control.gestion3/OneDrive/"
resto <- "BBDD Produccion/PERC/PERC 2022/"
f_amb <- janitor::clean_names(read_excel(paste0(ruta_base,resto,mes_archivo,"/Insumos de Informacion/06 f_ambulatoria.xlsx")))
f_cron <- janitor::clean_names(read_excel(paste0(ruta_base,resto,mes_archivo,"/Insumos de Informacion/07 f_cronicos.xlsx")))
f_hosp <- janitor::clean_names(read_excel(paste0(ruta_base,resto,mes_archivo,"/Insumos de Informacion/08 f_hospitalizados.xlsx")))
f_rec <- janitor::clean_names(read_excel(paste0(ruta_base,resto,mes_archivo,"/Insumos de Informacion/09 f_receton.xlsx")))
M2_Pab_EqMed <- (paste0(ruta_base,resto,mes_archivo,"/Insumos de Informacion/89_Pabellon.xlsx"))
M2 <- (paste0(ruta_base,resto,mes_archivo,"/Insumos de Informacion/03 M2.xlsx"))
f_rec$folio <- row.names(f_rec)
f_rec <- f_rec  %>% mutate(folio=folio, servicio=servicio_receton, valorizacion=valor_total, tipo_pac ="REC") %>%
select(folio, servicio, valorizacion, tipo_pac) %>%
filter(servicio != "AJUSTE (BAJA) INVENTARIO" &
servicio != "BAJA POR ROTURAS Y OTROS" &
servicio != "SECCION PRODUCCION FARMACIA" &
servicio != "PRESTAMO" &
servicio != "ERROR DE INGRESO" &
servicio != "BAJA POR VENCIMIENTO")
farmacia <- rbind(f_amb, f_cron, f_hosp) %>% select(folio, servicio, valorizacion, tipo_pac)
farmacia <- rbind(f_rec, farmacia)
rm(f_amb, f_cron, f_hosp, f_rec)
farmacia$servicio <- replace(farmacia$servicio, grep("GASTO GENERAL LACTANTES", farmacia$servicio), "GASTO GENERAL LACTANTES")
farmacia <- farmacia %>%  select (-tipo_pac) %>%  mutate(folio = folio, valorizacion = as.numeric(valorizacion),
perc = case_when(servicio=="U.PEDIATRIA GRAL B"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="UNIDAD CUIDADOS INTENSIVOS"~"170-UNIDAD DE CUIDADOS INTENSIVOS PEDIATRIA",
servicio=="U.P.C.C.V"~"198-UNIDAD DE TRATAMIENTO INTENSIVO CORONARIOS",
servicio=="UNIDAD TRATAMIENTO INTENSIVO"~"196-UNIDAD DE TRATAMIENTO INTENSIVO PEDÍATRICA",
servicio=="ONCOLOGIA"~"87-HOSPITALIZACIÓN ONCOLOGÍA",
servicio=="CIRUGIA GENERAL"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="U.PEDIATRIA GRAL C -AISLAMIENT"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="U.PEDIATRIA GRAL A"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="PLASTICA Y QUEMADOS"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="SALA TRANSICION UTI"~"170-UNIDAD DE CUIDADOS INTENSIVOS PEDIATRIA",
servicio=="ORTOPEDIA Y TRAUMATOLOGIA"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="URGENCIA(AMBULATORIA)"~"15302-CONSULTA PEDIATRÍA GENERAL",
servicio=="PABELLON QUIRURGICO"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="AT.ASISTENTE SOCIAL"~"99544-TRABAJO SOCIAL",
servicio=="POLICLINICO CIRUGIA GRAL."~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="GINECOLOGIA"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="OTORRINOLARINGOLOGIA"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="SALUD MENTAL CE"~"149-HOSPITALIZACIÓN PSIQUIATRÍA",
servicio=="SALUD MENTAL ME"~"149-HOSPITALIZACIÓN PSIQUIATRÍA",
servicio=="UROLOGIA"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="MEDICINA"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="PREMATUROS"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="CENTRAL DE PROCEDIMIENTOS"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="TRAUMATOLOGIA Y ORTOPEDIA"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="TRIPLETA SERVICIO"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="UNIDAD TRATAMIENTO INTERMEDIO"~"196-UNIDAD DE TRATAMIENTO INTENSIVO PEDÍATRICA",
servicio=="U. CUIDADO INT. CARDIOVASCULAR"~"177-UNIDAD DE CUIDADOS CORONARIOS",
servicio=="UNIDAD DE CUIDADOS INTENSIVOS"~"170-UNIDAD DE CUIDADOS INTENSIVOS PEDIATRIA",
servicio=="U.PEDIATRIA GRAL C -AISLAMIENT"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="U.PEDIATRIA GRAL B"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="SALA TRANSICION UTI"~"196-UNIDAD DE TRATAMIENTO INTENSIVO PEDÍATRICA",
servicio=="ORTOPEDIA Y TRAUMATOLOGIA"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="CIRUGIA GENERAL"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="ONCOLOGIA"~"87-HOSPITALIZACIÓN ONCOLOGÍA",
servicio=="U.PEDIATRIA GRAL A"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="PLASTICA Y QUEMADO"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="PABELLON QUIRURGICO"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="SALUD MENTAL CORTA ESTADIA"~"149-HOSPITALIZACIÓN PSIQUIATRÍA",
servicio=="UNIDAD TRATAMIENTO INTERMEDIO"~"196-UNIDAD DE TRATAMIENTO INTENSIVO PEDÍATRICA",
servicio=="UNIDAD DE CUIDADOS INTENSIVOS"~"170-UNIDAD DE CUIDADOS INTENSIVOS PEDIATRIA",
servicio=="U. CUIDADO INT. CARDIOVASCULAR"~"177-UNIDAD DE CUIDADOS CORONARIOS",
servicio=="CIRUGIA GENERAL"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="ONCOLOGIA"~"87-HOSPITALIZACIÓN ONCOLOGÍA",
servicio=="U.PEDIATRIA GRAL C -AISLAMIENT"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="U.PEDIATRIA GRAL A"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="ORTOPEDIA Y TRAUMATOLOGIA"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="PLASTICA Y QUEMADO"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
servicio=="U.PEDIATRIA GRAL B"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="SALA TRANSICION UTI"~"170-UNIDAD DE CUIDADOS INTENSIVOS PEDIATRIA",
servicio=="CONSULTORIO INFECTOLOGIA"~"15113-CONSULTA INFECTOLOGÍA",
servicio=="REUMATOLOGIA"~"15104-CONSULTA REUMATOLOGÍA",
servicio=="ONCOLOGIA CAE"~"15135-CONSULTA HEMATOLOGÍA ONCOLÓGICA",
servicio=="GASTROENTEROLOGIA"~"15119-CONSULTA GASTROENTEROLOGÍA",
servicio=="NEUROLOGIA"~"15305-CONSULTA NEUROLOGÍA PEDIÁTRICA",
servicio=="BRONCOPULMONAR"~"15111-CONSULTA NEUMOLOGÍA",
servicio=="URGENCIA(AMBULATORIA)"~"15302-CONSULTA PEDIATRÍA GENERAL",
servicio=="NUTRIOLOGOS"~"15008-CONSULTA NUTRICIÓN",
servicio=="HEMOFILICOS CAE"~"15135-CONSULTA HEMATOLOGÍA ONCOLÓGICA",
servicio=="NEFROLOGIA"~"15114-CONSULTA NEFROLOGÍA",
servicio=="UROLOGIA"~"15203-CONSULTA UROLOGÍA",
servicio=="PEDIATRIA-NANEAS"~"15302-CONSULTA PEDIATRÍA GENERAL",
servicio=="CARDIOLOGIA"~"15105-CONSULTA CARDIOLOGÍA",
servicio=="POLICLINICO CIRUGIA GRAL."~"15409-CONSULTA CIRUGÍA PEDIÁTRICA",
servicio=="PREMATUROS"~"15409-CONSULTA CIRUGÍA PEDIÁTRICA",
servicio=="ENDOCRINOLOGIA"~"15110-CONSULTA ENDOCRINOLOGÍA",
servicio=="QUEMADOS"~"15208-CONSULTA CIRUGÍA PLÁSTICA",
servicio=="HEMATOLOGIA"~"15135-CONSULTA HEMATOLOGÍA ONCOLÓGICA",
servicio=="ANESTESIA"~"15302-CONSULTA PEDIATRÍA GENERAL",
servicio=="M.FISICA Y REHABILITACION"~"15118-CONSULTA FISIATRÍA",
servicio=="CENTRAL DE PROCEDIMIENTOS"~"473-QUIRÓFANOS MENOR AMBULATORIA",
servicio=="GINECOLOGIA"~"15502-CONSULTA GINECOLOGICA",
servicio=="SALUD MENTAL"~"15109-CONSULTA PSIQUIATRÍA",
servicio=="DENTAL"~"15602-CONSULTA ODONTOLOGÍA",
servicio=="TRAUMATOLOGIA Y ORTOPEDIA"~"15316-CONSULTA TRAUMATOLOGÍA PEDIÁTRICA",
servicio=="OFTALMOLOGIA"~"15209-CONSULTA OFTALMOLOGÍA",
servicio=="OTORRINOLARINGOLOGIA"~"15211-CONSULTA OTORRINOLARINGOLOGÍA",
servicio=="MAXILOFACIAL"~"15602-CONSULTA ODONTOLOGÍA",
servicio=="DERMATOLOGIA"~"15106-CONSULTA DERMATOLOGÍA",
servicio=="CAE SEGUIMIENTO"~"15302-CONSULTA PEDIATRÍA GENERAL",
servicio=="PLASTICA"~"15208-CONSULTA CIRUGÍA PLÁSTICA",
servicio=="NEUROCIRUGIA"~"15121-CONSULTA NEUROCIRUGÍA",
servicio=="FONOAUDIOLOGIA"~"15302-CONSULTA PEDIATRÍA GENERAL",
servicio=="GENETICA"~"15115-CONSULTA GENÉTICA",
servicio=="CONSUMO GENERAL C.ROSARIO"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="CONSUMO GENERAL DE POLI CIRUGIA"~"15409-CONSULTA CIRUGÍA PEDIÁTRICA",
servicio=="CONSUMO GENERAL ESPECIALIDADES"~"CAE Prorratear",
servicio=="CONSUMO GENERAL IMAGENOLOGIA"~"542-IMAGENOLOGÍA",
servicio=="CONSUMO GENERAL PABELLON"~"Pabellon prorratear",
servicio=="CONSUMO GENERAL POLI BRONCOLOGIA"~"15111-CONSULTA NEUMOLOGÍA",
servicio=="CONSUMO GENERAL POLI DE PROCEMIENTOS"~"473-QUIRÓFANOS MENOR AMBULATORIA",
servicio=="CONSUMO GENERAL POLI DERMATOLOGIA"~"15106-CONSULTA DERMATOLOGÍA",
servicio=="CONSUMO GENERAL S. DE ONCOLOGIA"~"15135-CONSULTA HEMATOLOGÍA ONCOLÓGICA",
servicio=="CONSUMO GENERAL S.CIRUGIA SAN JOSE"~"471-QUIRÓFANOS MAYOR AMBULATORIA",
servicio=="CONSUMO GENERAL SERVICIO URGENCIA"~"216-EMERGENCIAS PEDIÁTRICAS",
servicio=="CONSUMO GENERAL U.C.E."~"662-CENTRAL DE ESTERILIZACIÓN",
servicio=="SERVICIO DE ESTERILIZACION"~"662-CENTRAL DE ESTERILIZACIÓN",
servicio=="CONSUMO GENERAL URACI"~"567-REHABILITACIÓN",
servicio=="CONSUMO GRAL. DE C. HEMOFILICO"~"87-HOSPITALIZACIÓN ONCOLOGÍA",
servicio=="CONSUMO GRAL. DE POLI-BANCO DE SANGRE"~"575-BANCO DE SANGRE",
servicio=="ANATOMIA PATOLOGICA"~"544-ANATOMÍA PATOLÓGICA",
servicio=="CONSUMO GRAL. LABORATORIO CENTRAL"~"518-LABORATORIO CLÍNICO",
servicio=="CONSUMO GRAL. OTORRINOLARINGOLOGIA"~"15211-CONSULTA OTORRINOLARINGOLOGÍA",
servicio=="CONSUMO GRAL. SERV. NEFROLOGIA"~"15114-CONSULTA NEFROLOGÍA",
servicio=="CONSUMO GRAL. UCI CARDIOLOGICA"~"177-UNIDAD DE CUIDADOS CORONARIOS",
servicio=="CONSUMO NANEAS"~"15302-CONSULTA PEDIATRÍA GENERAL",
servicio=="GASTO GENERAL AISLAMIENTO"~"15302-CONSULTA PEDIATRÍA GENERAL",
servicio=="GASTO GENERAL NEUROLOGIA CAE"~"15305-CONSULTA NEUROLOGÍA PEDIÁTRICA",
servicio=="GASTO GENERAL SALUD MENTAL HOSP."~"149-HOSPITALIZACIÓN PSIQUIATRÍA",
servicio=="GASTOS CAE"~"CAE Prorratear",
servicio=="GASTOS GENERALES DE ELECTROENCEFALOGRAFIA"~"15305-CONSULTA NEUROLOGÍA PEDIÁTRICA",
servicio=="ELECTROENCEFALOGRAMA"~"15305-CONSULTA NEUROLOGÍA PEDIÁTRICA",
servicio=="POLICLINICO DE CARDIOCIRUGIA"~"15105-CONSULTA CARDIOLOGÍA",
servicio=="SERVICIO DE URGENCIA"~"216-EMERGENCIAS PEDIÁTRICAS",
servicio=="SERVICIO DENTAL CAE"~"15602-CONSULTA ODONTOLOGÍA",
servicio=="SERVICIO POLI-OFTALMOLOGIA"~"15209-CONSULTA OFTALMOLOGÍA",
servicio=="GASTO GENERAL LACTANTES"~"15302-CONSULTA PEDIATRÍA GENERAL",
servicio=="ODONTOLOGIA(DENTAL)"~"15602-CONSULTA ODONTOLOGÍA",
servicio=="SALUD MENTAL MEDIANA ESTADIA"~"149-HOSPITALIZACIÓN PSIQUIATRÍA",
servicio=="ORTODONCIA"~"15602-CONSULTA ODONTOLOGÍA",
servicio=="U.PEDIATRIA GRAL D"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="S.PEDIATRIA GRAL D"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="UTI CARDIOVASCULAR"~"198-UNIDAD DE TRATAMIENTO INTENSIVO CORONARIOS",
servicio=="URGENCIA (ATEN.CERRADA)"~"216-EMERGENCIAS PEDIÁTRICAS",
servicio=="CONSUMO GENERAL DERMATOLOGIA CAE"~"15106-CONSULTA DERMATOLOGÍA",
servicio=="CONSUMO GRAL. ORTOP. Y TRAUMA"~"15316-CONSULTA TRAUMATOLOGÍA PEDIÁTRICA",
servicio=="GASTO GENERAL SALUD MENTAL CAE"~"15109-CONSULTA PSIQUIATRÍA",
servicio=="UCI CARDIOVASCULAR"~"177-UNIDAD DE CUIDADOS CORONARIOS",
servicio=="SERV. UCI CARDIOVASCULAR"~"177-UNIDAD DE CUIDADOS CORONARIOS",
servicio=="S.UNIDAD DE CUIDADOS INTENSIVO"~"170-UNIDAD DE CUIDADOS INTENSIVOS PEDIATRIA",
servicio=="S.PEDIATRIA GRAL A"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="S.PEDIATRIA GRAL B"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="UD PEDIATRICA GENERAL D"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="S.PEDIATRIA GRAL C -AISLAMIENT"~"116-HOSPITALIZACIÓN PEDIATRÍA",
servicio=="GASTO GENERAL SERVICIO ESTERILIZACION"~"662-CENTRAL DE ESTERILIZACIÓN",
servicio=="CONSUMO PABELLON CARDIOLOGIA"~"464-QUIRÓFANOS CARDIOVASCULAR",
servicio=="GASTO GENERAL UTI 2º PISO"~"196-UNIDAD DE TRATAMIENTO INTENSIVO PEDÍATRICA",
servicio=="PROGRAMA MINSAL IH H1N1"~"15113-CONSULTA INFECTOLOGÍA",
servicio=="ODONTOPEDIATRIA"~"15602-CONSULTA ODONTOLOGÍA",
servicio=="NUTRICIONISTA"~"15008-CONSULTA NUTRICIÓN",
servicio=="CONS. ENFERMEDADES INFECCIOSAS"~"15113-CONSULTA INFECTOLOGÍA",
servicio=="ATENCION MEDICA-PEDIATRICA DEL PERSONAL"~"15302-CONSULTA PEDIATRÍA GENERAL",
TRUE ~ "Asignar CC"
))
No_asignado_farmacia <- farmacia %>% filter(perc == "Asignar CC")
prescripciones <- farmacia %>% select(perc, folio) %>%
group_by(perc) %>%
mutate(prescripciones = 1) %>%  select(perc,prescripciones) %>%
summarise(prescripciones=sum(prescripciones)) %>%
ungroup()
recetas <- distinct(farmacia)
recetas <- recetas %>% select(perc, folio) %>%
group_by(perc) %>%
mutate(recetas = 1) %>%  select(perc,recetas) %>%
summarise(recetas=sum(recetas)) %>%
ungroup()
# prorrateo pabellón ------------------------------------------------------
M2 <- read_excel(M2)
M2Pab <- read_excel(M2_Pab_EqMed) %>% filter(SIGCOM != "Total")
M2Pab <- mutate_all(M2Pab, ~replace(., is.na(.), 0))
Metros_pabellon <- 11*45
"473-QUIRÓFANOS MENOR AMBULATORIA" <- sum(M2Pab$`473-QUIRÓFANOS MENOR AMBULATORIA`)
"471-QUIRÓFANOS MAYOR AMBULATORIA" <- sum(M2Pab$`471-QUIRÓFANOS MAYOR AMBULATORIA`)
M2Pab <- M2Pab %>% select(SIGCOM, `Distribución cirugias Electivas`) %>%
group_by(SIGCOM) %>%
summarise("Distribución cirugias Electivas" =sum(`Distribución cirugias Electivas`)) %>%
ungroup()
df <- tibble(SIGCOM= as.character(c("473-QUIRÓFANOS MENOR AMBULATORIA", "471-QUIRÓFANOS MAYOR AMBULATORIA")),
"Distribución cirugias Electivas"= c(`473-QUIRÓFANOS MENOR AMBULATORIA`, `471-QUIRÓFANOS MAYOR AMBULATORIA`))
M2Pab <- rbind(M2Pab, df)
M2Pab$Area <- "Quirofanos"
M2Pab <- M2Pab %>% mutate(Area = Area, CC = SIGCOM,
M2=`Distribución cirugias Electivas`/sum(`Distribución cirugias Electivas`)*Metros_pabellon) %>%
select(Area, CC, M2)
M2 <- M2 %>% filter(Area != "Quirofanos")
M2 <- rbind(M2, M2Pab)
M2$prop <- M2$M2/sum(M2$M2) #asigna proporción a los M2
CAE_prorratear <- M2 %>% filter(Area == "Consultas" | Area == "Procedimientos")
CAE_prorratear$prop <- CAE_prorratear$M2/sum(CAE_prorratear$M2)
M2Pab$prop <- M2Pab$M2/sum(M2Pab$M2)
GG44 <- data.frame(
"servicio" = "eliminar",
"folio" = 0,
"valorizacion" = 0
)
farmacia3 <- GG44
qx <- c("464-QUIRÓFANOS CARDIOVASCULAR",
"467-QUIRÓFANOS DIGESTIVA",
"475-QUIRÓFANOS NEUROCIRUGÍA",
"478-QUIRÓFANOS OFTALMOLOGÍA",
"480-QUIRÓFANOS OTORRINOLARINGOLOGÍA",
"485-QUIRÓFANOS TRAUMATOLOGÍA Y ORTOPEDIA",
"486-QUIRÓFANOS UROLOGÍA",
"493-QUIRÓFANOS CIRUGÍA PLÁSTICA",
"495-QUIRÓFANOS CIRUGÍA VASCULAR",
"473-QUIRÓFANOS MENOR AMBULATORIA",
"471-QUIRÓFANOS MAYOR AMBULATORIA")
for (i in qx) {
q <- sum(ifelse(M2Pab$CC == i, M2Pab$prop, 0))
GG2 <- farmacia %>% filter(perc=="Pabellon prorratear") %>%
summarise(servicio = i,
folio = folio,
valorizacion = valorizacion*q)
GG44 <- rbind(GG44, GG2) %>% filter(servicio!="eliminar")
}
am <- c("15409-CONSULTA CIRUGÍA PEDIÁTRICA",
"15008-CONSULTA NUTRICIÓN",
"15104-CONSULTA REUMATOLOGÍA",
"15105-CONSULTA CARDIOLOGÍA",
"15106-CONSULTA DERMATOLOGÍA",
"15109-CONSULTA PSIQUIATRÍA",
"15110-CONSULTA ENDOCRINOLOGÍA",
"15111-CONSULTA NEUMOLOGÍA",
"15113-CONSULTA INFECTOLOGÍA",
"15114-CONSULTA NEFROLOGÍA",
"15115-CONSULTA GENÉTICA",
"15118-CONSULTA FISIATRÍA",
"15119-CONSULTA GASTROENTEROLOGÍA",
"15121-CONSULTA NEUROCIRUGÍA",
"15125-CONSULTA ANESTESIOLOGIA",
"15135-CONSULTA HEMATOLOGÍA ONCOLÓGICA",
"15203-CONSULTA UROLOGÍA",
"15208-CONSULTA CIRUGÍA PLÁSTICA",
"15209-CONSULTA OFTALMOLOGÍA",
"15211-CONSULTA OTORRINOLARINGOLOGÍA",
"15302-CONSULTA PEDIATRÍA GENERAL",
"15305-CONSULTA NEUROLOGÍA PEDIÁTRICA",
"15316-CONSULTA TRAUMATOLOGÍA PEDIÁTRICA",
"15502-CONSULTA GINECOLOGICA",
"15602-CONSULTA ODONTOLOGÍA",
"359-TELEMEDICINA")
for (i in am) {
a <- sum(ifelse(CAE_prorratear$CC == i, CAE_prorratear$prop, 0))
GG2 <- farmacia %>% filter(perc=="Cae Prorratear") %>%
summarise(servicio = i,
folio = folio,
valorizacion = valorizacion*a)
farmacia3 <- rbind(farmacia3, GG2) %>% filter(servicio!="eliminar")
}
farmacia3 <- rbind(farmacia3,GG44)
farmacia <- farmacia %>%  select(perc, folio, valorizacion) %>% filter(perc != "Pabellon prorratear" & perc != "CAE Prorratear")
farmacia3 <- farmacia3 %>%  mutate(perc = servicio) %>%  select(-servicio) #Da error
farmacia <- rbind(farmacia, farmacia3)
prescripciones <- farmacia %>% select(perc, folio) %>%
group_by(perc) %>%
mutate(prescripciones = 1) %>%  select(perc,prescripciones) %>%
summarise(prescripciones=sum(prescripciones)) %>%
ungroup()
gasto_farmacia <- farmacia %>% select(perc, valorizacion) %>%
group_by(perc) %>%
summarise(gasto=sum(valorizacion)) %>%
ungroup()
prop <- sum(gasto_farmacia$gasto)
gasto_farmacia$gasto <- gasto_farmacia$gasto/prop
farmacia_perc <- inner_join(prescripciones, gasto_farmacia)
farmacia_perc$filtro <- ifelse(farmacia_perc$gasto == 0, "borrar", "queda")
farmacia_perc <- farmacia_perc %>% filter(filtro == "queda")
farmacia_perc$filtro <- NULL
gasto_farmacia <- farmacia_perc %>% select(perc, gasto)
rm(df,prop, GG2, GG44, farmacia3, M2, M2_Pab_EqMed, M2Pab, CAE_prorratear,
`471-QUIRÓFANOS MAYOR AMBULATORIA`, `473-QUIRÓFANOS MENOR AMBULATORIA`, a,
am, Metros_pabellon, q, qx, prescripciones, recetas, farmacia)
colnames(farmacia_perc)[1] <- "PERC ASOCIADO"
colnames(farmacia_perc)[2] <- "593_2-SERVICIO FARMACEUTICO | Prescripción"
openxlsx::write.xlsx(farmacia_perc,paste0(ruta_base,resto,mes_archivo,"/Insumos de Informacion/901_Farmacia.xlsx"), overwrite = T)
openxlsx::write.xlsx(gasto_farmacia,paste0(ruta_base,resto,mes_archivo,"/Insumos de Informacion/900_gasto_farmacia.xlsx"), overwrite = T)
