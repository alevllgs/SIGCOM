f_amb <- janitor::clean_names(read_excel(paste0(ruta_base,resto,mes_archivo,"/Insumos de Informacion/06 f_ambulatoria.xlsx")))
library(readxl)
f_amb <- janitor::clean_names(read_excel(paste0(ruta_base,resto,mes_archivo,"/Insumos de Informacion/06 f_ambulatoria.xlsx")))
mes_archivo <- "11 Noviembre"
ruta_base <- "C:/Users/control.gestion3/OneDrive/"
resto <- "BBDD Produccion/PERC/PERC 2021/"
f_amb <- janitor::clean_names(read_excel(paste0(ruta_base,resto,mes_archivo,"/Insumos de Informacion/06 f_ambulatoria.xlsx")))
f_amb
"BBDD Produccion/REM/Serie BS/2021/2021-11 REM serie BS.xlsx"
paste0(ruta_base,resto_ruta_registro,"/",mes_ruta_registros,cola_ruta_registro_a)
resto_ruta_registro <- "BBDD Produccion/REM/"
cola_ruta_registro_a <- " REM serie A.xlsx"
paste0(ruta_base,resto_ruta_registro,"/",mes_ruta_registros,cola_ruta_registro_a)
mes_ruta_registros <- "2021-11"
paste0(ruta_base,resto_ruta_registro,"/",mes_ruta_registros,cola_ruta_registro_a)
paste0(ruta_base,resto_ruta_registro,"/",mes_ruta_registros, "/",cola_ruta_registro_a
paste0(ruta_base,resto_ruta_registro,"/",mes_ruta_registros, "/",cola_ruta_registro_a)
paste0(ruta_base,resto_ruta_registro,"/",mes_ruta_registros,cola_ruta_registro_a)
paste0(ruta_base,resto_ruta_registro,mes_ruta_registros,cola_ruta_registro_a)
resto_ruta_registro <- "BBDD Produccion/REM/Serie A/2021"
paste0(ruta_base,resto_ruta_registro,mes_ruta_registros,cola_ruta_registro_a)
resto_ruta_registro <- "BBDD Produccion/REM/Serie A/2021/"
paste0(ruta_base,resto_ruta_registro,mes_ruta_registros,cola_ruta_registro_a)
"BBDD Produccion/REM/Serie BS/2021/2021-11 REM serie BS.xlsx"
resto_ruta_registro_b <- "BBDD Produccion/REM/Serie BS/2021/"
cola_ruta_registro_b <- " REM serie BS.xlsx"
read_excel(paste0(ruta_base,resto_ruta_registro_b,mes_ruta_registros,cola_ruta_registro_b)
paste0(ruta_base,resto_ruta_registro_b,mes_ruta_registros,cola_ruta_registro_b)
paste0(ruta_base,resto_ruta_registro_b,mes_ruta_registros,cola_ruta_registro_b)
fecha_solo_mes <- "2021-11"
paste0(ruta_base,"BBDD Produccion/PERC/Cubos 9/Cubo_9 ",fecha_solo_mes".xlsx")
Arch_cubo9 <- paste0(ruta_base,"BBDD Produccion/PERC/Cubos 9/Cubo_9 ",fecha_solo_mes,".xlsx")
paste0(ruta_base,"BBDD Produccion/PERC/Cubos 9/Cubo_9 ",fecha_solo_mes,".xlsx")
fecha_solo_mes <- str_sub(fecha_mes,-3)
library(tidyverse)
fecha_solo_mes <- str_sub(fecha_mes,-3)
fecha_mes <- "2021-11-01"
fecha_solo_mes <- str_sub(fecha_mes,-3)
fecha_solo_mes <- str_sub(fecha_mes,7)
fecha_solo_mes <- str_sub(fecha_mes,1,7)
library(tidyverse)
library(readxl)
library(lubridate)
library(janitor)
library(dplyr)
library(openxlsx)
library(xlsx)
# SIGFE listas-------------------------------------------------------------------
mes_archivo <- "11 Noviembre"
ruta_base <- "C:/Users/control.gestion3/OneDrive/"
resto <- "BBDD Produccion/PERC/PERC 2021/"
SIGFE <- read_excel(paste0(ruta_base,resto,mes_archivo,"/Insumos de Informacion/01 Ejecucion Presupuestaria.xlsx"))
M2_Pab_EqMed <- paste0(ruta_base,resto,mes_archivo,"/Insumos de Informacion/03 M2_Distribucion de Pabellon_Mantencion.xlsx")
ConsumoxCC <- paste0(ruta_base,resto,mes_archivo,"/Insumos de Informacion/02 Consumo x CC del mes.xlsx")
Cant_RRHH <- paste0(ruta_base,resto,mes_archivo,"/Insumos de Informacion/04 SIRH R.xlsx")
Farmacia <- paste0(ruta_base,resto,mes_archivo,"/Insumos de Informacion/900_gasto_farmacia.xlsx")
graba <- paste0(ruta_base,resto,mes_archivo,"/01, 02, 03, 04 , 05, 06 y 07/SIGFE R.xlsx")
CxCC_H <- paste0(ruta_base,resto,mes_archivo,"/Insumos de info anual/CxCC_historico.xlsx")
insumos <- c("22",
"2201",
"2201001",
"2201001001",
"2201001002",
"2201001003",
"2201002",
"2202",
"2202001",
"2202002",
"2202002001",
"2202002002",
"2202003",
"2203",
"2203001",
"2203002",
"2203003",
"2203999",
"2204",
"2204001",
"2204002",
"2204003",
"2204003001",
"2204003002",
"2204004",
"2204004001",
"220400400101",
"220400400102",
"220400400103",
"2204004002",
"2204004003",
"2204004004",
"2204004005",
"2204004006",
"2204005",
"2204005001",
"2204005002",
"2204005003",
"2204007",
"2204007002",
"2204008",
"2204009",
"2204010",
"2204011",
"2204012",
"2204013",
"2204015")
ggenerales <- c("2204006",
"2204007001",
"2204014",
"2204999",
"2205",
"2205001",
"2205002",
"2205003",
"2205004",
"2205005",
"2205006",
"2205007",
"2205999",
"2206",
"2206001",
"2206002",
"2206003",
"2206004",
"2206005",
"2206006",
"2206006001",
"2206006002",
"2206007",
"2206999",
"2207",
"2207001",
"2207002",
"2207003",
"2207999",
"2208",
"2208001",
"2208002",
"2208003",
"2208007",
"2208008",
"2208009",
"2208010",
"2208999",
"2209",
"2209001",
"2209002",
"2209003",
"2209004",
"2209005",
"2209005001",
"2209005002",
"2209006",
"2209999",
"2210",
"2210001",
"2210002",
"2210003",
"2210004",
"2210999",
"2211",
"2211001",
"2211002",
"2211002001",
"221100200101",
"221100200102",
"221100200103",
"221100200201",
"221100200202",
"221100200203",
"221100200301",
"221100200302",
"221100200303",
"221100200401",
"221100200402",
"221100200403",
"221100200501",
"221100200502",
"221100200503",
"221100200601",
"221100200602",
"2211003",
"2211999",
"2212",
"2212002",
"2212003",
"2212003",
"2212005",
"2212006",
"2212999",
"2212999001",
"2212999002",
"221299900201",
"221299900202",
"2212999003",
"221299900302",
"2212999004",
"2212999005",
"2212999006",
"221299900601",
"221299900602",
"221299900603",
"2212999009",
"221299900901",
"221299900902",
"221299900903",
"2212999010",
"2212999011",
"2212999014",
"221299901401",
"221299901402",
"2212999015",
"2212999017",
"2212999019",
"2212999016",
"2212999018",
"2212999020",
"2212999021",
"2212999022")
RRHH_sigfe <- c("221299900301",
"221299900302",
"221299901601",
"221299901602")
# SIGFE Formulas ----------------------------------------------------------
SIGFE$`Codigo Base` <- as.character(SIGFE$`Codigo Base`)
colnames(SIGFE)[1] <- "cod_sigfe"
SIGFE <- SIGFE %>% select(cod_sigfe, Devengado) %>%
mutate(Tipo = case_when(cod_sigfe %in% insumos ~ "Insumos",
cod_sigfe %in% ggenerales ~ "Gastos Generales",
cod_sigfe %in% RRHH_sigfe ~ "RRHH Eliminar",
TRUE ~ "Asignar Centro de Costo")) %>%
mutate(SIGCOM = case_when(
#Insumos
cod_sigfe == "22" ~ "Familia",
cod_sigfe == "2201"~ "Familia",
cod_sigfe == "2201001"~ "Familia",
cod_sigfe == "2201001001"~ "46-VÍVERES",
cod_sigfe == "2201001002"~ "46-VÍVERES",
cod_sigfe == "2201001003"~ "46-VÍVERES",
cod_sigfe == "2201002"~ "46-VÍVERES",
cod_sigfe == "2202"~ "Familia",
cod_sigfe == "2202001"~ "43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
cod_sigfe == "2202002"~ "Familia",
cod_sigfe == "2202002001"~ "43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
cod_sigfe == "2202002002"~ "43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
cod_sigfe == "2202003"~ "43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
cod_sigfe == "2203"~ "Familia",
cod_sigfe == "2203001"~ "3-COMBUSTIBLES Y LUBRICANTES",
cod_sigfe == "2203002"~ "3-COMBUSTIBLES Y LUBRICANTES",
cod_sigfe == "2203003"~ "3-COMBUSTIBLES Y LUBRICANTES",
cod_sigfe == "2203999"~ "3-COMBUSTIBLES Y LUBRICANTES",
cod_sigfe == "2204"~ "Familia",
cod_sigfe == "2204001"~ "24-MATERIALES DE OFICINA, PRODUCTOS DE PAPEL E IMPRESOS",
cod_sigfe == "2204002"~ "11-LIBROS, TEXTOS, UTILES DE ENSEÑANZA Y PUBLICACIONES",
cod_sigfe == "2204003"~ "Familia",
cod_sigfe == "2204003001"~ "9-GASES MEDICINALES",
cod_sigfe == "2204003002"~ "41-PRODUCTOS QUÍMICOS",
cod_sigfe == "2204004"~ "Familia",
cod_sigfe == "2204004001"~ "Familia",
cod_sigfe == "220400400101"~ "30-MEDICAMENTOS",
cod_sigfe == "220400400102"~ "30-MEDICAMENTOS",
cod_sigfe == "220400400103"~ "30-MEDICAMENTOS",
cod_sigfe == "2204004002"~ "15-MATERIAL DE ODONTOLOGÍA",
cod_sigfe == "2204004003"~ "21-MATERIALES DE CURACIÓN",
cod_sigfe == "2204004004"~ "16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
cod_sigfe == "2204004005"~ "16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
cod_sigfe == "2204004006"~ "16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
cod_sigfe == "2204005"~ "Familia",
cod_sigfe == "2204005001"~ "18-MATERIAL MEDICO QUIRURGICO",
cod_sigfe == "2204005002"~ "18-MATERIAL MEDICO QUIRURGICO",
cod_sigfe == "2204005003"~ "18-MATERIAL MEDICO QUIRURGICO",
cod_sigfe == "2204007"~ "Familia",
cod_sigfe == "2204007002"~ "29-MATERIALES Y ELEMENTOS DE ASEO",
cod_sigfe == "2204008"~ "31-MENAJE PARA OFICINA, CASINO Y OTROS",
cod_sigfe == "2204009"~ "27-MATERIALES INFORMATICOS",
cod_sigfe == "2204010"~ "28-MATERIALES PARA MANTENIMIENTO Y REPARACIONES DE INMUEBLES",
cod_sigfe == "2204011"~ "44-REPUESTOS Y ACCESORIOS PARA MANTENIMIENTO Y REPARACIONES DE VEHICULOS",
cod_sigfe == "2204012"~ "35-OTROS INSUMOS Y MATERIALES",
cod_sigfe == "2204013"~ "8-EQUIPOS MENORES",
cod_sigfe == "2204015"~ "25-MATERIALES DE USO O CONSUMO",
#Gastos Generales
cod_sigfe == "2204006"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2204007001"~ "178-SERVICIO DE LAVANDERÍA",
cod_sigfe == "2204014"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2204999"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2205"~ "Familia",
cod_sigfe == "2205001"~ "92-SERVICIO DE ENERGÍA",
cod_sigfe == "2205002"~ "48-SERVICIO DE AGUA",
cod_sigfe == "2205003"~ "100-GAS PROPANO",
cod_sigfe == "2205004"~ "179-SERVICIO DE MENSAJERIA Y/O CORREO",
cod_sigfe == "2205005"~ "192-SERVICIO DE TELECOMUNICACIONES",
cod_sigfe == "2205006"~ "93-ENLACES DE TELECOMUNICACIONES",
cod_sigfe == "2205007"~ "93-ENLACES DE TELECOMUNICACIONES",
cod_sigfe == "2205999"~ "188-SERVICIOS GENERALES",
cod_sigfe == "2206"~ "Familia",
cod_sigfe == "2206001"~ "133-MANTENIMIENTO PLANTA FÍSICA",
cod_sigfe == "2206002"~ "135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
cod_sigfe == "2206003"~ "132-MANTENIMIENTO MUEBLES Y ENSERES",
cod_sigfe == "2206004"~ "131-MANTENIMIENTO MAQUINARIA Y EQUIPO",
cod_sigfe == "2206005"~ "137-MANTENIMIENTO Y REPARACIÓN MÁQUINA Y EQUIPO CORRECTIVO",
cod_sigfe == "2206006"~ "Familia",
cod_sigfe == "2206006001"~ "138-MANTENIMIENTO Y REPARACIÓN MÁQUINA Y EQUIPO PREVENTIVO",
cod_sigfe == "2206006002"~ "137-MANTENIMIENTO Y REPARACIÓN MÁQUINA Y EQUIPO CORRECTIVO",
cod_sigfe == "2206007"~ "129-MANTENIMIENTO EQUIPO DE CÓMPUTO",
cod_sigfe == "2206999"~ "147-OTROS MANTENIMIENTOS",
cod_sigfe == "2207"~ "Familia",
cod_sigfe == "2207001"~ "158-PUBLICIDAD Y PROPAGANDA",
cod_sigfe == "2207002"~ "158-PUBLICIDAD Y PROPAGANDA",
cod_sigfe == "2207003"~ "158-PUBLICIDAD Y PROPAGANDA",
cod_sigfe == "2207999"~ "158-PUBLICIDAD Y PROPAGANDA",
cod_sigfe == "2208"~ "Familia",
cod_sigfe == "2208001"~ "170-SERVICIO DE ASEO",
cod_sigfe == "2208002"~ "182-SERVICIO DE VIGILANCIA Y SEGURIDAD",
cod_sigfe == "2208003"~ "128-MANTENIMIENTO DE PRADOS Y JARDINES",
cod_sigfe == "2208007"~ "151-PASAJES, FLETES Y BODEGAJE",
cod_sigfe == "2208008"~ "161-SALA CUNAS Y/O SERVICIOS INFANTILES",
cod_sigfe == "2208009"~ "188-SERVICIOS GENERALES",
cod_sigfe == "2208010"~ "188-SERVICIOS GENERALES",
cod_sigfe == "2208999"~ "188-SERVICIOS GENERALES",
cod_sigfe == "2209"~ "Familia",
cod_sigfe == "2209001"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209002"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209003"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209004"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209005"~ "Familia",
cod_sigfe == "2209005001"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209005002"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209006"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209999"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2210"~ "Familia",
cod_sigfe == "2210001"~ "168-SEGUROS GENERALES",
cod_sigfe == "2210002"~ "168-SEGUROS GENERALES",
cod_sigfe == "2210003"~ "168-SEGUROS GENERALES",
cod_sigfe == "2210004"~ "168-SEGUROS GENERALES",
cod_sigfe == "2210999"~ "168-SEGUROS GENERALES",
cod_sigfe == "2211"~ "Familia",
cod_sigfe == "2211001"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2211002"~ "Familia",
cod_sigfe == "2211002001"~ "Familia",
cod_sigfe == "221100200101"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200102"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200103"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200201"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200202"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200203"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200301"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200302"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200303"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200401"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200402"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200403"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200501"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200502"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200503"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200601"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200602"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "2211003"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2211999"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212"~ "Familia",
cod_sigfe == "2212002"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212003"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212003"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212005"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212006"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212999"~ "Familia",
cod_sigfe == "2212999001"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999002"~ "Familia",
cod_sigfe == "221299900201"~ "177-SERVICIO DE LABORATORIO",
cod_sigfe == "221299900202"~ "177-SERVICIO DE LABORATORIO",
cod_sigfe == "2212999003"~ "Familia",
cod_sigfe == "221299900302"~ "63-COMPRA DE INTERVENCIONES QUIRÚRGICAS CLÍNICAS",
cod_sigfe == "2212999004"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999005"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999006"~ "Familia",
cod_sigfe == "221299900601"~ "57-COLOCACIÓN FAMILIAR DE MENORES Y EXTRAHOSPITALARIA",
cod_sigfe == "221299900602"~ "57-COLOCACIÓN FAMILIAR DE MENORES Y EXTRAHOSPITALARIA",
cod_sigfe == "221299900603"~ "57-COLOCACIÓN FAMILIAR DE MENORES Y EXTRAHOSPITALARIA",
cod_sigfe == "2212999009"~ "Familia",
cod_sigfe == "221299900901"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "221299900902"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "221299900903"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212999010"~ "149-PASAJES Y TRASLADOS DE PACIENTES",
cod_sigfe == "2212999011"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212999014"~ "Familia",
cod_sigfe == "221299901401"~ "59-COMPRA DE CAMAS AL EXTRA SISTEMA CAMAS CRÍTICAS",
cod_sigfe == "221299901402"~ "60-COMPRA DE CAMAS AL EXTRA SISTEMA CAMAS NO CRÍTICAS",
cod_sigfe == "2212999015" ~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999017" ~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212999019" ~ "176-SERVICIO DE INTERMEDIACIÓN CENABAST",
#RRHH
cod_sigfe == "221299900301"~ "65-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL INTERNO",
cod_sigfe == "221299900302"~ "64-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL EXTERNO",
cod_sigfe == "2212999016" ~ "Familia",
cod_sigfe == "221299901601" ~ "61-COMPRA DE CONSULTAS MÉDICAS",
cod_sigfe == "221299901602" ~ "62-COMPRA DE CONSULTAS NO MÉDICAS",
cod_sigfe == "2212999018" ~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999020" ~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999021" ~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999022" ~ "66-COMPRA DE OTROS SERVICIOS",
TRUE ~ "Asignar Centro de Costo")) %>%
filter(SIGCOM != "Familia" & Devengado>0)
# M2 --------------------------------------------------------------
M2 <- read_excel(M2_Pab_EqMed,sheet = "M2")
M2Pab <- read_excel(M2_Pab_EqMed,sheet = "Pabellon")
M2Pab <- mutate_all(M2Pab, ~replace(., is.na(.), 0))
Metros_pabellon <- 11*45
"473-QUIRÓFANOS MENOR AMBULATORIA" <- sum(M2Pab$`473-QUIRÓFANOS MENOR AMBULATORIA`)
"471-QUIRÓFANOS MAYOR AMBULATORIA" <- sum(M2Pab$`471-QUIRÓFANOS MAYOR AMBULATORIA`)
M2Pab <- M2Pab %>% select(SIGCOM, `Distribución cirugias Electivas`) %>%
group_by(SIGCOM) %>%
summarise("Distribución cirugias Electivas" =sum(`Distribución cirugias Electivas`)) %>%
ungroup()
df <- tibble(SIGCOM= as.character(c("473-QUIRÓFANOS MENOR AMBULATORIA", "471-QUIRÓFANOS MAYOR AMBULATORIA")),
"Distribución cirugias Electivas"= c(`473-QUIRÓFANOS MENOR AMBULATORIA`, `471-QUIRÓFANOS MAYOR AMBULATORIA`))
M2Pab <- rbind(M2Pab, df)
M2Pab$Area <- "Quirofanos"
M2Pab <- M2Pab %>% mutate(Area = Area, CC = SIGCOM,
M2=`Distribución cirugias Electivas`/sum(`Distribución cirugias Electivas`)*Metros_pabellon) %>%
select(Area, CC, M2)
M2 <- M2 %>% filter(Area != "Quirofanos")
M2 <- rbind(M2, M2Pab)
M2$prop <- M2$M2/sum(M2$M2) #asigna proporción a los M2
CAE_prorratear <- M2 %>% filter(Area == "Consultas" | Area == "Procedimientos")
CAE_prorratear$prop <- CAE_prorratear$M2/sum(CAE_prorratear$M2)
M2Pab$prop <- M2Pab$M2/sum(M2Pab$M2)
View(M2Pab)
View(M2)
View(M2)
View(M2)
View(M2)
View(M2)
View(M2Pab)
View(M2)
M2_clinico <- M2 %>% filter(Area !="Apoyo")
M2_clinico$prop <- M2_clinico$M2/sum(M2_clinico$M2)
View(M2_clinico)
b <- "149-PASAJES Y TRASLADOS DE PACIENTES"  #Ver si puedo prorratear cuando el M2 solo por la unidades clinicas
if(b %in% SIGFE$SIGCOM & b %in% CxCC$ItemxCC){
CCC <- CxCC %>% filter(ItemxCC == b) %>%
select(CC, Total) %>%
group_by (CC) %>%
summarise(Total =sum(Total)) %>%
mutate("prop" = Total/sum(Total))
GG2 <-  SIGFE %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == b)
GG2 <- GG2 %>% summarise("Centro de Costo" = CCC$CC,
Devengado = Devengado*CCC$prop,
"Cuenta"=b, "Tipo" = 2)
GG1 <- rbind(GG1,GG2)} else
if(b %in% SIGFE$SIGCOM & b %in% CxCC_H$ItemxCC){
CCC <- CxCC_H %>% filter(ItemxCC == b) %>%
select(CC, Total) %>%
group_by (CC) %>%
summarise(Total =sum(Total)) %>%
mutate("prop" = Total/sum(Total))
GG2 <-  SIGFE %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == b)
GG2 <- GG2 %>% summarise("Centro de Costo" = CCC$CC,
Devengado = Devengado*CCC$prop,
"Cuenta"=b, "Tipo" = 2)
GG1 <- rbind(GG1,GG2)} else
if(b %in% SIGFE$SIGCOM){
GG2 <-  SIGFE %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == b)
GG2 <- GG2 %>% summarise("Centro de Costo" = M2_clinico$CC,
Devengado = Devengado*M2_clinico$prop,
"Cuenta"=b, "Tipo" = 2)
GG1 <- rbind(GG1,GG2)}
