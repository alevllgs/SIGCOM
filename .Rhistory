"16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
"18-MATERIAL MEDICO QUIRURGICO",
"21-MATERIALES DE CURACIÓN",
"24-MATERIALES DE OFICINA, PRODUCTOS DE PAPEL E IMPRESOS",
"25-MATERIALES DE USO O CONSUMO",
"27-MATERIALES INFORMATICOS",
"28-MATERIALES PARA MANTENIMIENTO Y REPARACIONES DE INMUEBLES",
"29-MATERIALES Y ELEMENTOS DE ASEO",
"31-MENAJE PARA OFICINA, CASINO Y OTROS",
"35-OTROS INSUMOS Y MATERIALES",
"41-PRODUCTOS QUÍMICOS",
"43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
"44-REPUESTOS Y ACCESORIOS PARA MANTENIMIENTO Y REPARACIONES DE VEHICULOS",
"46-VÍVERES",
"100-GAS PROPANO",
"48-SERVICIO DE AGUA",
"92-SERVICIO DE ENERGÍA",
"170-SERVICIO DE ASEO",
"182-SERVICIO DE VIGILANCIA Y SEGURIDAD"
)
# SIGFE Formulas ----------------------------------------------------------
SIGFE$`Codigo Base` <- as.character(SIGFE$`Codigo Base`)
colnames(SIGFE)[1] <- "cod_sigfe"
SIGFE <- SIGFE %>% select(cod_sigfe, Devengado) %>%
mutate(Tipo = case_when(cod_sigfe %in% insumos ~ "Insumos",
cod_sigfe %in% ggenerales ~ "Gastos Generales",
cod_sigfe %in% RRHH_sigfe ~ "RRHH Eliminar",
TRUE ~ "Asignar Centro de Costo")) %>%
mutate(SIGCOM = case_when(
#Insumos
cod_sigfe == "22" ~ "Familia",
cod_sigfe == "2201"~ "Familia",
cod_sigfe == "2201001"~ "Familia",
cod_sigfe == "2201001001"~ "46-VÍVERES",
cod_sigfe == "2201001002"~ "46-VÍVERES",
cod_sigfe == "2201001003"~ "46-VÍVERES",
cod_sigfe == "2201002"~ "46-VÍVERES",
cod_sigfe == "2202"~ "Familia",
cod_sigfe == "2202001"~ "43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
cod_sigfe == "2202002"~ "Familia",
cod_sigfe == "2202002001"~ "43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
cod_sigfe == "2202002002"~ "43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
cod_sigfe == "2202003"~ "43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
cod_sigfe == "2203"~ "Familia",
cod_sigfe == "2203001"~ "3-COMBUSTIBLES Y LUBRICANTES",
cod_sigfe == "2203002"~ "3-COMBUSTIBLES Y LUBRICANTES",
cod_sigfe == "2203003"~ "3-COMBUSTIBLES Y LUBRICANTES",
cod_sigfe == "2203999"~ "3-COMBUSTIBLES Y LUBRICANTES",
cod_sigfe == "2204"~ "Familia",
cod_sigfe == "2204001"~ "24-MATERIALES DE OFICINA, PRODUCTOS DE PAPEL E IMPRESOS",
cod_sigfe == "2204002"~ "11-LIBROS, TEXTOS, UTILES DE ENSEÑANZA Y PUBLICACIONES",
cod_sigfe == "2204003"~ "Familia",
cod_sigfe == "2204003001"~ "9-GASES MEDICINALES",
cod_sigfe == "2204003002"~ "41-PRODUCTOS QUÍMICOS",
cod_sigfe == "2204004"~ "Familia",
cod_sigfe == "2204004001"~ "Familia",
cod_sigfe == "220400400101"~ "30-MEDICAMENTOS",
cod_sigfe == "220400400102"~ "30-MEDICAMENTOS",
cod_sigfe == "220400400103"~ "30-MEDICAMENTOS",
cod_sigfe == "2204004002"~ "15-MATERIAL DE ODONTOLOGÍA",
cod_sigfe == "2204004003"~ "21-MATERIALES DE CURACIÓN",
cod_sigfe == "2204004004"~ "16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
cod_sigfe == "2204004005"~ "16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
cod_sigfe == "2204004006"~ "16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
cod_sigfe == "2204005"~ "Familia",
cod_sigfe == "2204005001"~ "18-MATERIAL MEDICO QUIRURGICO",
cod_sigfe == "2204005002"~ "18-MATERIAL MEDICO QUIRURGICO",
cod_sigfe == "2204005003"~ "18-MATERIAL MEDICO QUIRURGICO",
cod_sigfe == "2204007"~ "Familia",
cod_sigfe == "2204007002"~ "29-MATERIALES Y ELEMENTOS DE ASEO",
cod_sigfe == "2204008"~ "31-MENAJE PARA OFICINA, CASINO Y OTROS",
cod_sigfe == "2204009"~ "27-MATERIALES INFORMATICOS",
cod_sigfe == "2204010"~ "28-MATERIALES PARA MANTENIMIENTO Y REPARACIONES DE INMUEBLES",
cod_sigfe == "2204011"~ "44-REPUESTOS Y ACCESORIOS PARA MANTENIMIENTO Y REPARACIONES DE VEHICULOS",
cod_sigfe == "2204012"~ "35-OTROS INSUMOS Y MATERIALES",
cod_sigfe == "2204013"~ "8-EQUIPOS MENORES",
cod_sigfe == "2204015"~ "25-MATERIALES DE USO O CONSUMO",
#Gastos Generales
cod_sigfe == "2204006"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2204007001"~ "178-SERVICIO DE LAVANDERÍA",
cod_sigfe == "2204014"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2204999"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2205"~ "Familia",
cod_sigfe == "2205001"~ "92-SERVICIO DE ENERGÍA",
cod_sigfe == "2205002"~ "48-SERVICIO DE AGUA",
cod_sigfe == "2205003"~ "100-GAS PROPANO",
cod_sigfe == "2205004"~ "179-SERVICIO DE MENSAJERIA Y/O CORREO",
cod_sigfe == "2205005"~ "192-SERVICIO DE TELECOMUNICACIONES",
cod_sigfe == "2205006"~ "93-ENLACES DE TELECOMUNICACIONES",
cod_sigfe == "2205007"~ "93-ENLACES DE TELECOMUNICACIONES",
cod_sigfe == "2205999"~ "188-SERVICIOS GENERALES",
cod_sigfe == "2206"~ "Familia",
cod_sigfe == "2206001"~ "133-MANTENIMIENTO PLANTA FÍSICA",
cod_sigfe == "2206002"~ "Familia",
cod_sigfe == "2206002001"~ "135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
cod_sigfe == "2206002002"~ "135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
cod_sigfe == "2206002003"~ "135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
cod_sigfe == "2206002004"~ "135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
cod_sigfe == "2206002005"~ "135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
cod_sigfe == "2206002006"~ "135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
cod_sigfe == "2206003"~ "132-MANTENIMIENTO MUEBLES Y ENSERES",
cod_sigfe == "2206004"~ "131-MANTENIMIENTO MAQUINARIA Y EQUIPO",
cod_sigfe == "2206005"~ "Familia",
cod_sigfe == "2206005001"~ "131-MANTENIMIENTO MAQUINARIA Y EQUIPO",
cod_sigfe == "2206005002"~ "131-MANTENIMIENTO MAQUINARIA Y EQUIPO",
cod_sigfe == "2206006"~ "Familia",
cod_sigfe == "2206006001"~ "138-MANTENIMIENTO Y REPARACIÓN MÁQUINA Y EQUIPO PREVENTIVO",
cod_sigfe == "2206006002"~ "137-MANTENIMIENTO Y REPARACIÓN MÁQUINA Y EQUIPO CORRECTIVO",
cod_sigfe == "2206006003"~ "138-MANTENIMIENTO Y REPARACIÓN MÁQUINA Y EQUIPO PREVENTIVO",
cod_sigfe == "2206006004"~ "137-MANTENIMIENTO Y REPARACIÓN MÁQUINA Y EQUIPO CORRECTIVO",
cod_sigfe == "2206007"~ "129-MANTENIMIENTO EQUIPO DE CÓMPUTO",
cod_sigfe == "2206999"~ "147-OTROS MANTENIMIENTOS",
cod_sigfe == "2207"~ "Familia",
cod_sigfe == "2207001"~ "158-PUBLICIDAD Y PROPAGANDA",
cod_sigfe == "2207002"~ "158-PUBLICIDAD Y PROPAGANDA",
cod_sigfe == "2207003"~ "158-PUBLICIDAD Y PROPAGANDA",
cod_sigfe == "2207999"~ "158-PUBLICIDAD Y PROPAGANDA",
cod_sigfe == "2208"~ "Familia",
cod_sigfe == "2208001"~ "170-SERVICIO DE ASEO",
cod_sigfe == "2208002"~ "182-SERVICIO DE VIGILANCIA Y SEGURIDAD",
cod_sigfe == "2208003"~ "128-MANTENIMIENTO DE PRADOS Y JARDINES",
cod_sigfe == "2208007"~ "151-PASAJES, FLETES Y BODEGAJE",
cod_sigfe == "2208008"~ "161-SALA CUNAS Y/O SERVICIOS INFANTILES",
cod_sigfe == "2208009"~ "188-SERVICIOS GENERALES",
cod_sigfe == "2208010"~ "188-SERVICIOS GENERALES",
cod_sigfe == "2208999"~ "188-SERVICIOS GENERALES",
cod_sigfe == "2209"~ "Familia",
cod_sigfe == "2209001"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209002"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209003"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209004"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209005"~ "Familia",
cod_sigfe == "2209005001"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209005002"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209006"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2209999"~ "52-ARRENDAMIENTOS",
cod_sigfe == "2210"~ "Familia",
cod_sigfe == "2210001"~ "168-SEGUROS GENERALES",
cod_sigfe == "2210002"~ "168-SEGUROS GENERALES",
cod_sigfe == "2210003"~ "168-SEGUROS GENERALES",
cod_sigfe == "2210004"~ "168-SEGUROS GENERALES",
cod_sigfe == "2210999"~ "168-SEGUROS GENERALES",
cod_sigfe == "2211"~ "Familia",
cod_sigfe == "2211001"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2211002"~ "Familia",
cod_sigfe == "2211002001"~ "Familia",
cod_sigfe == "221100200101"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200102"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200103"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200201"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200202"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200203"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200301"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200302"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200303"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200401"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200402"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200403"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200501"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200502"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200503"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200601"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "221100200602"~ "76-CURSOS DE CAPACITACIÓN",
cod_sigfe == "2211003"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2211999"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212"~ "Familia",
cod_sigfe == "2212002"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212003"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212004"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212005"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212006"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212999"~ "Familia",
cod_sigfe == "2212999001"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999002"~ "Familia",
cod_sigfe == "221299900201"~ "177-SERVICIO DE LABORATORIO",
cod_sigfe == "221299900202"~ "177-SERVICIO DE LABORATORIO",
cod_sigfe == "2212999003"~ "Familia",
cod_sigfe == "221299900302"~ "63-COMPRA DE INTERVENCIONES QUIRÚRGICAS CLÍNICAS",
cod_sigfe == "2212999004"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999005"~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999006"~ "Familia",
cod_sigfe == "221299900601"~ "57-COLOCACIÓN FAMILIAR DE MENORES Y EXTRAHOSPITALARIA",
cod_sigfe == "221299900602"~ "57-COLOCACIÓN FAMILIAR DE MENORES Y EXTRAHOSPITALARIA",
cod_sigfe == "221299900603"~ "57-COLOCACIÓN FAMILIAR DE MENORES Y EXTRAHOSPITALARIA",
cod_sigfe == "2212999009"~ "Familia",
cod_sigfe == "221299900901"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "221299900902"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "221299900903"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212999010"~ "149-PASAJES Y TRASLADOS DE PACIENTES",
cod_sigfe == "2212999011"~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212999014"~ "Familia",
cod_sigfe == "221299901401"~ "59-COMPRA DE CAMAS AL EXTRA SISTEMA CAMAS CRÍTICAS",
cod_sigfe == "221299901402"~ "60-COMPRA DE CAMAS AL EXTRA SISTEMA CAMAS NO CRÍTICAS",
cod_sigfe == "2212999015" ~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999017" ~ "145-OTROS GASTOS GENERALES",
cod_sigfe == "2212999019" ~ "176-SERVICIO DE INTERMEDIACIÓN CENABAST",
#RRHH
cod_sigfe == "221299900301"~ "65-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL INTERNO",
cod_sigfe == "221299900302"~ "64-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL EXTERNO",
cod_sigfe == "2212999016" ~ "Familia",
cod_sigfe == "221299901601" ~ "61-COMPRA DE CONSULTAS MÉDICAS",
cod_sigfe == "221299901602" ~ "62-COMPRA DE CONSULTAS NO MÉDICAS",
cod_sigfe == "2212999018" ~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999020" ~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999021" ~ "66-COMPRA DE OTROS SERVICIOS",
cod_sigfe == "2212999022" ~ "66-COMPRA DE OTROS SERVICIOS",
TRUE ~ "Asignar Centro de Costo")) %>%
filter(SIGCOM != "Familia" & Devengado>0)
# Consumo por CC ----------------------------------------------------------
#Agrupa las cuentas de SIGFE
SIGFE_agrupado <- SIGFE %>%
group_by ("Item" = SIGCOM) %>%
summarise("Devengado" = sum(Devengado)) %>%
ungroup()
CxCC <- read_excel(ConsumoxCC, range = "A3:M5000", na = "eliminar")
item_pres_int <- read_excel(item, sheet = "item_presupuestario")
item_pres_int$cod_sigfe <- as.character(item_pres_int$cod_sigfe)
#Verifican que esten todos los CC y los item presupuestarios
CxCC_no_asignado <- CxCC
CxCC_no_asignado$no_asignado <- ifelse(CxCC$`ITEM PRESUPUESTARIO` %in% item_pres_int$item_presupuestario, "esta", "no esta")
CxCC_no_asignado <- CxCC_no_asignado %>% filter(`ITEM PRESUPUESTARIO` != "NA" & no_asignado == "no esta")
consumo_interno <- read_excel(item, sheet = "centros_de_costos")
Cent_Cost_no_asignado <- CxCC
Cent_Cost_no_asignado$no_asignado <- ifelse(Cent_Cost_no_asignado$`CENTRO DE COSTO` %in% consumo_interno$cc_hospital, "esta", "no esta")
Cent_Cost_no_asignado <- Cent_Cost_no_asignado %>% filter(`ITEM PRESUPUESTARIO` != "NA" & no_asignado == "no esta")
SIGFE <- SIGFE %>% inner_join(item_pres_int, by = "cod_sigfe") %>% select(-item_sigcom)
SIGFE$consumido <- ifelse(SIGFE$item_presupuestario %in% as.character(CxCC$`ITEM PRESUPUESTARIO`), "esta", "no esta")
CxCC$item_presupuestario <- as.character(CxCC$`ITEM PRESUPUESTARIO`)
CxCC <- CxCC %>% inner_join(SIGFE, by = "item_presupuestario") %>% select(-consumido, -Devengado, -`ITEM PRESUPUESTARIO`, -COD.PRODUCTO, -`COD. CENTRO COSTO`, -RUBRO, -BODEGA) %>% mutate(pxq = PRECIO*`CANTIDAD DESPACHADA`)
CxCC <- CxCC %>% inner_join(consumo_interno, by = c(`CENTRO DE COSTO` = "cc_hospital"))
consumido <- SIGFE %>% filter(consumido == "esta")
consumido <- consumido %>%
group_by ("SIGCOM" = SIGCOM) %>%
summarise("Devengado" = sum(Devengado)) %>%
ungroup()
no_considera_consumo <- consumido %>% filter(SIGCOM == "100-GAS PROPANO" | SIGCOM == "48-SERVICIO DE AGUA" | SIGCOM == "92-SERVICIO DE ENERGÍA" | SIGCOM == "170-SERVICIO DE ASEO") %>% mutate("SIGCOM" = SIGCOM) %>% select(SIGCOM, Devengado)
consumido <- consumido %>% filter(SIGCOM != "100-GAS PROPANO" & SIGCOM != "48-SERVICIO DE AGUA" & SIGCOM != "92-SERVICIO DE ENERGÍA" & SIGCOM != "170-SERVICIO DE ASEO")
no_consumido <- SIGFE %>% filter(consumido == "no esta")
no_consumido <- no_consumido %>%
group_by ("SIGCOM" = SIGCOM) %>%
summarise("Devengado" = sum(Devengado)) %>%
ungroup()
no_consumido <- rbind(no_considera_consumo, no_consumido)
consolidado <- data.frame(
"Centro de Costo" = "eliminar",
"Devengado" = 0,
"Cuenta" = "eliminar",
"Tipo" = 1)
colnames(consolidado)[1] <- "Centro de Costo"
for (i in unique(CxCC$SIGCOM)) {
if(i %in% consumido$SIGCOM){
aux_prorrateo <- CxCC %>% filter(SIGCOM == i)
aux_prorrateo$prop <- prop.table(aux_prorrateo$pxq)
aux_prorrateo <- aux_prorrateo %>%
group_by ("cc_sigcom" = cc_sigcom) %>%
summarise("prop" = sum(prop)) %>%
ungroup()
valor_sigfe <- sum(ifelse(consumido$SIGCOM == i, consumido$Devengado, 0))
tabla_prorrateo <- aux_prorrateo %>%
mutate("Centro de Costo" = cc_sigcom , "Devengado" = prop*valor_sigfe, "Cuenta" = i,
"Tipo" = 2) %>% select(-cc_sigcom, -prop)
consolidado <- rbind(consolidado, tabla_prorrateo) %>%  filter(Cuenta != "eliminar")
}
}
# M2 --------------------------------------------------------------
#Asigna los metros a los pabellones segun el tiempo asignado en la tabla quirurgica
M2Pab <- read_excel(M2Pab) %>%
mutate("Area" = "Quirofanos", "CC" = SIGCOM, "M2" = 495*prop_total) %>%
select(-SIGCOM, -prop_total)
#Modifica los M2 de los pabellones
M2 <- read_excel(M2) %>% filter(Area !="Quirofanos")
M2 <- rbind(M2,M2Pab)
M2$prop <- prop.table(M2$M2)
rm(M2Pab) #elimino los M2 de los pabellones
#Asigna metros cuadrados al cae
prod_cae <- read_excel(produccion_cae) %>% filter(`Unidades de Producción` == "1__Consulta")
prod_cae$Valor <- prop.table(ifelse(prod_cae$Valor == 0, 1, prod_cae$Valor))
prod_cae$`Centro de Producción` <- substr(prod_cae$`Centro de Producción`, start = 8, stop = 600)
prod_cae <- prod_cae %>%
mutate("Area" = "Ambulatorio", "CC" = `Centro de Producción`, "M2" = 1555*Valor, "prop"=Valor) %>%
select(Area, CC, M2, prop)
M2 <- M2 %>% filter(Area !="Ambulatorio")
M2 <- rbind(M2,prod_cae)
M2$prop <- prop.table(M2$M2)
# Prorrateo Gastos Generales por M2 ---------------------------------------
#Crea dataframe esqueleto para añadir datos
GG1 <- data.frame(
"Centro de Costo" = "eliminar",
"Devengado" = 0,
"Cuenta" = "eliminar",
"Tipo" = 1)
colnames(GG1)[1] <- "Centro de Costo"
GG1_nulo <- GG1
GG44 <- GG1_nulo
GG33 <- GG1_nulo
# Distribucion por M2 -----------------------------------------------------
asignaciones <- read_excel(Asignaciones)
colnames(asignaciones)[1] <- "SIGCOM"
asignacion_m2 <- read_excel(Asignaciones) %>% filter(Prorrateo == "metros_totales")
aux_asignacion = asignacion_m2
aux_distribucion = M2
tipo = 1
for (i in aux_asignacion$SIGCOM) {
if(i %in% no_consumido$SIGCOM){
variable_efimera <-  no_consumido %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == i)
variable_efimera <- variable_efimera %>% summarise("Centro de Costo" = aux_distribucion$CC,
Devengado = Devengado*aux_distribucion$prop,
"Cuenta"=i, "Tipo" = tipo)
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
else {variable_efimera <- GG1_nulo
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
}
# Distribución por asignacion directa -------------------------------------
asignacion_directa <- read_excel(Asignaciones) %>% filter(Prorrateo == "asignacion_directa")
asignacion_directa <- asignacion_directa %>% full_join(no_consumido, by="SIGCOM") %>%
filter(Prorrateo == "asignacion_directa", Devengado != "NA") %>%
select("Centro de Costo" = `Centro de costo`, Devengado, "Cuenta"=SIGCOM) %>% mutate("Tipo" = 4)
GG1 <- rbind(GG1, asignacion_directa)
rm(asignacion_directa, asignacion_m2, variable_efimera)
# Distribución clinica -------------------------------------
asignacion_clinica <- read_excel(Asignaciones) %>% filter(Prorrateo == "clinicos")
M2clinicos <- M2 %>% filter(Area != "Apoyo" & Area != "Administración")
M2clinicos$prop <- prop.table(M2clinicos$M2)
aux_asignacion = asignacion_clinica
aux_distribucion = M2clinicos
tipo = 2
for (i in aux_asignacion$SIGCOM) {
if(i %in% no_consumido$SIGCOM){
variable_efimera <-  no_consumido %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == i)
variable_efimera <- variable_efimera %>% summarise("Centro de Costo" = aux_distribucion$CC,
Devengado = Devengado*aux_distribucion$prop,
"Cuenta"=i, "Tipo" = tipo)
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
else {variable_efimera <- GG1_nulo
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
}
# Distribución Pabellón sin cardio -------------------------------------
asignacion_pab_sin_car <- read_excel(Asignaciones) %>% filter(Prorrateo == "pabellon_sin_cardio")
M2Pab_sin_Card <- M2 %>% filter(Area == "Quirofanos") %>% filter(Area != "464-QUIRÓFANOS CARDIOVASCULAR")
M2Pab_sin_Card$prop <- prop.table(M2Pab_sin_Card$M2)
aux_asignacion = asignacion_pab_sin_car
aux_distribucion = M2Pab_sin_Card
tipo = 2
for (i in aux_asignacion$SIGCOM) {
if(i %in% no_consumido$SIGCOM){
variable_efimera <-  no_consumido %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == i)
variable_efimera <- variable_efimera %>% summarise("Centro de Costo" = aux_distribucion$CC,
Devengado = Devengado*aux_distribucion$prop,
"Cuenta"=i, "Tipo" = tipo)
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
else {variable_efimera <- GG1_nulo
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
}
# Distribución CAE prorratear -------------------------------------
asignacion_cae <- read_excel(Asignaciones) %>% filter(Prorrateo == "cae_prorratear")
M2_cae <- M2 %>% filter(Area == "Ambulatorio" | Area == "Procedimientos")
M2_cae$prop <- prop.table(M2_cae$M2)
aux_asignacion <-  asignacion_cae
aux_distribucion <-  M2_cae
tipo <-  2
for (i in aux_asignacion$SIGCOM) {
if(i %in% no_consumido$SIGCOM){
variable_efimera <-  no_consumido %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == i)
variable_efimera <- variable_efimera %>% summarise("Centro de Costo" = aux_distribucion$CC,
Devengado = Devengado*aux_distribucion$prop,
"Cuenta"=i, "Tipo" = tipo)
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
else {variable_efimera <- GG1_nulo
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
}
# Distribución UPC --------------------------------------------------------
asignacion_upc <- read_excel(Asignaciones) %>% filter(Prorrateo == "upc")
M2_upc <- M2 %>% filter(Area == "UPC")
M2_upc$prop <- prop.table(M2_upc$M2)
aux_asignacion <-  asignacion_upc
aux_distribucion <-  M2_upc
tipo <-  2
for (i in aux_asignacion$SIGCOM) {
if(i %in% no_consumido$SIGCOM){
variable_efimera <-  no_consumido %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == i)
variable_efimera <- variable_efimera %>% summarise("Centro de Costo" = aux_distribucion$CC,
Devengado = Devengado*aux_distribucion$prop,
"Cuenta"=i, "Tipo" = tipo)
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
else {variable_efimera <- GG1_nulo
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
}
# Distribución por costo Farmacia --------------------------------------------------------------
M2_farmacia <- read_excel(Farmacia) %>% mutate("CC" = perc, "prop" = gasto) %>% select(-perc, -gasto)
asignacion_farmacia <- read_excel(Asignaciones) %>% filter(Prorrateo == "farmacia")
aux_asignacion <-  asignacion_farmacia
aux_distribucion <-  M2_farmacia
tipo <-  2
for (i in aux_asignacion$SIGCOM) {
if(i %in% no_consumido$SIGCOM){
variable_efimera <-  no_consumido %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == i)
variable_efimera <- variable_efimera %>% summarise("Centro de Costo" = aux_distribucion$CC,
Devengado = Devengado*aux_distribucion$prop,
"Cuenta"=i, "Tipo" = tipo)
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
else {variable_efimera <- GG1_nulo
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
}
# Distribución por Equipos Medicos ---------------------------------------------------------
#PREVENTIVOS
M2_EqMed_prev <- read_excel(EqMed) %>%
filter("Área" != "Total" & `Mantención Preventiva` != "NA") %>%
mutate("CC" = `PERC ASOCIADO`, "prop" = prop.table(`Mantención Preventiva`)) %>%
select(CC, prop)
asignacion_EqMed_prev <- read_excel(Asignaciones) %>% filter(Prorrateo == "equipos_medicos_prev")
aux_asignacion <-  asignacion_EqMed_prev
aux_distribucion <-  M2_EqMed_prev
tipo <-  2
for (i in aux_asignacion$SIGCOM) {
if(i %in% no_consumido$SIGCOM){
variable_efimera <-  no_consumido %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == i)
variable_efimera <- variable_efimera %>% summarise("Centro de Costo" = aux_distribucion$CC,
Devengado = Devengado*aux_distribucion$prop,
"Cuenta"=i, "Tipo" = tipo)
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
else {variable_efimera <- GG1_nulo
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
}
#CORRECTIVOS
M2_EqMed_correc <- read_excel(EqMed) %>%
filter("Área" != "Total" & `Mantención Correctiva` != "NA") %>%
mutate("CC" = `PERC ASOCIADO`, "prop" = prop.table(`Mantención Correctiva`)) %>%
select(CC, prop)
asignacion_EqMed_correc <- read_excel(Asignaciones) %>% filter(Prorrateo == "equipos_medicos_correc")
aux_asignacion <-  asignacion_EqMed_correc
aux_distribucion <-  M2_EqMed_correc
tipo <-  2
for (i in aux_asignacion$SIGCOM) {
if(i %in% no_consumido$SIGCOM){
variable_efimera <-  no_consumido %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == i)
variable_efimera <- variable_efimera %>% summarise("Centro de Costo" = aux_distribucion$CC,
Devengado = Devengado*aux_distribucion$prop,
"Cuenta"=i, "Tipo" = tipo)
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
else {variable_efimera <- GG1_nulo
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
}
# Distribución por Cant_RRHH ----------------------------------------------
M2_Cant_RRHH <- read_excel(Cant_RRHH) %>% mutate("CC" = perc, "prop" = horas_mensuales) %>%
select(CC, prop) %>%
group_by(CC) %>%
summarise(prop = sum(prop)) %>%
ungroup()
M2_Cant_RRHH$prop <- prop.table(M2_Cant_RRHH$prop)
asignacion_RRHH <- read_excel(Asignaciones) %>% filter(Prorrateo == "cantidad_rrhh")
aux_asignacion <-  asignacion_RRHH
aux_distribucion <-  M2_Cant_RRHH
tipo <-  2
for (i in aux_asignacion$SIGCOM) {
if(i %in% no_consumido$SIGCOM){
variable_efimera <-  no_consumido %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == i)
variable_efimera <- variable_efimera %>% summarise("Centro de Costo" = aux_distribucion$CC,
Devengado = Devengado*aux_distribucion$prop,
"Cuenta"=i, "Tipo" = tipo)
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
else {variable_efimera <- GG1_nulo
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
}
# Distribucion Lab, Anat y Farmacia ---------------------------------------
M2_Ap_Lab_Farm <- data.frame("CC" = c("518-LABORATORIO CLÍNICO",
"544-ANATOMÍA PATOLÓGICA",
"55101-SERVICIO FARMACEUTICO"), "prop" = c(1/3, 1/3, 1/3))
asignacion_Ap_Lab_Farm <- read_excel(Asignaciones) %>% filter(Prorrateo == "lab_ap_farm")
aux_asignacion <-  asignacion_Ap_Lab_Farm
aux_distribucion <-  M2_Ap_Lab_Farm
tipo <-  2
for (i in aux_asignacion$SIGCOM) {
if(i %in% no_consumido$SIGCOM){
variable_efimera <-  no_consumido %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == i)
variable_efimera <- variable_efimera %>% summarise("Centro de Costo" = aux_distribucion$CC,
Devengado = Devengado*aux_distribucion$prop,
"Cuenta"=i, "Tipo" = tipo)
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
else {variable_efimera <- GG1_nulo
GG1 <- rbind(GG1,variable_efimera) %>% filter(Cuenta!="eliminar")}
}
# Cuadratura Devengado versus prorrateado ---------------------------------
GG1_agrupado <- GG1 %>%
group_by ("SIGCOM" = Cuenta) %>%
summarise("Prorrateado" = sum(Devengado)) %>%
ungroup()
asignaciones <- asignaciones %>% full_join(no_consumido, by="SIGCOM")
asignaciones <- asignaciones %>% full_join(GG1_agrupado, by="SIGCOM") %>% filter(Devengado != "NA")
asignaciones$diferencia <- asignaciones$Devengado - asignaciones$Prorrateado
#rm(no_consumido, GG1_agrupado)
sum(SIGFE$Devengado) == sum(GG1$Devengado) + sum(consolidado$Devengado)
View(no_consumido)
