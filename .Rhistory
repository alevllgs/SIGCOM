CC=="BODEGAS ABASTECIMIENTO"~"670-ADMINISTRACIÓN",
CC=="CIRUGIA GENERAL"~"90-HOSPITALIZACIÓN QUIRÚRGICA",
CC=="C.COSTO GLOBAL"~"670-ADMINISTRACIÓN",
CC=="GASTOS HOSPITAL"~"670-ADMINISTRACIÓN",
CC=="CAE ESPECIALIDADES 2"~"Cae Prorratear",
CC=="PABELLONES"~"Pabellón Prorratear",
TRUE ~ "Asignar CC"
)) %>%
select(item_pres, CC,ItemxCC, Total) %>%
group_by (item_pres, CC,ItemxCC,) %>%
summarise("Total" = sum(Total)) %>%
ungroup()
# Prorrateos GG x CxCC -------------------------------------------------------
cuentas <- c("52-ARRENDAMIENTOS",
"60-COMPRA DE CAMAS AL EXTRA SISTEMA CAMAS NO CRÍTICAS",
"61-COMPRA DE CONSULTAS MÉDICAS",
"62-COMPRA DE CONSULTAS NO MÉDICAS",
"63-COMPRA DE INTERVENCIONES QUIRÚRGICAS CLÍNICAS",
"64-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL EXTERNO",
"65-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL INTERNO",
"66-COMPRA DE OTROS SERVICIOS",
"129-MANTENIMIENTO EQUIPO DE CÓMPUTO",
"131-MANTENIMIENTO MAQUINARIA Y EQUIPO",
"132-MANTENIMIENTO MUEBLES Y ENSERES",
"135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
"147-OTROS MANTENIMIENTOS",
"151-PASAJES, FLETES Y BODEGAJE",
"149-PASAJES Y TRASLADOS DE PACIENTES",
"178-SERVICIO DE LAVANDERÍA",
"3-COMBUSTIBLES Y LUBRICANTES",
"8-EQUIPOS MENORES",
"9-GASES MEDICINALES",
"11-LIBROS, TEXTOS, UTILES DE ENSEÑANZA Y PUBLICACIONES",
"15-MATERIAL DE ODONTOLOGÍA",
"16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
"18-MATERIAL MEDICO QUIRURGICO",
"21-MATERIALES DE CURACIÓN",
"24-MATERIALES DE OFICINA, PRODUCTOS DE PAPEL E IMPRESOS",
"25-MATERIALES DE USO O CONSUMO",
"27-MATERIALES INFORMATICOS",
"28-MATERIALES PARA MANTENIMIENTO Y REPARACIONES DE INMUEBLES",
"29-MATERIALES Y ELEMENTOS DE ASEO",
"31-MENAJE PARA OFICINA, CASINO Y OTROS",
"35-OTROS INSUMOS Y MATERIALES",
"41-PRODUCTOS QUÍMICOS",
"43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
"44-REPUESTOS Y ACCESORIOS PARA MANTENIMIENTO Y REPARACIONES DE VEHICULOS",
"46-VÍVERES")
cuentas_total <- c("52-ARRENDAMIENTOS",
"129-MANTENIMIENTO EQUIPO DE CÓMPUTO",
"131-MANTENIMIENTO MAQUINARIA Y EQUIPO",
"132-MANTENIMIENTO MUEBLES Y ENSERES",
"135-MANTENIMIENTO Y REPARACION DE VEHICULOS",
"147-OTROS MANTENIMIENTOS",
"151-PASAJES, FLETES Y BODEGAJE",
"3-COMBUSTIBLES Y LUBRICANTES",
"8-EQUIPOS MENORES",
"9-GASES MEDICINALES",
"11-LIBROS, TEXTOS, UTILES DE ENSEÑANZA Y PUBLICACIONES",
"15-MATERIAL DE ODONTOLOGÍA",
"16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
"18-MATERIAL MEDICO QUIRURGICO",
"21-MATERIALES DE CURACIÓN",
"24-MATERIALES DE OFICINA, PRODUCTOS DE PAPEL E IMPRESOS",
"25-MATERIALES DE USO O CONSUMO",
"27-MATERIALES INFORMATICOS",
"28-MATERIALES PARA MANTENIMIENTO Y REPARACIONES DE INMUEBLES",
"29-MATERIALES Y ELEMENTOS DE ASEO",
"31-MENAJE PARA OFICINA, CASINO Y OTROS",
"35-OTROS INSUMOS Y MATERIALES",
"41-PRODUCTOS QUÍMICOS",
"43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
"44-REPUESTOS Y ACCESORIOS PARA MANTENIMIENTO Y REPARACIONES DE VEHICULOS",
"46-VÍVERES")
cuentas_clinico <- c("149-PASAJES Y TRASLADOS DE PACIENTES",
"178-SERVICIO DE LAVANDERÍA")
cuentas_qx <- c("63-COMPRA DE INTERVENCIONES QUIRÚRGICAS CLÍNICAS",
"64-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL EXTERNO",
"65-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL INTERNO")
cuentas_cae <- c("61-COMPRA DE CONSULTAS MÉDICAS",
"62-COMPRA DE CONSULTAS NO MÉDICAS")
cuenta_insumos <- c("3-COMBUSTIBLES Y LUBRICANTES",
"8-EQUIPOS MENORES",
"9-GASES MEDICINALES",
"11-LIBROS, TEXTOS, UTILES DE ENSEÑANZA Y PUBLICACIONES",
"15-MATERIAL DE ODONTOLOGÍA",
"16-MATERIAL DE OSTEOSÍNTESIS Y PRÓTESIS",
"18-MATERIAL MEDICO QUIRURGICO",
"21-MATERIALES DE CURACIÓN",
"24-MATERIALES DE OFICINA, PRODUCTOS DE PAPEL E IMPRESOS",
"25-MATERIALES DE USO O CONSUMO",
"27-MATERIALES INFORMATICOS",
"28-MATERIALES PARA MANTENIMIENTO Y REPARACIONES DE INMUEBLES",
"29-MATERIALES Y ELEMENTOS DE ASEO",
"31-MENAJE PARA OFICINA, CASINO Y OTROS",
"35-OTROS INSUMOS Y MATERIALES",
"41-PRODUCTOS QUÍMICOS",
"43-PRODUCTOS TEXTILES, VESTUARIO Y CALZADO",
"44-REPUESTOS Y ACCESORIOS PARA MANTENIMIENTO Y REPARACIONES DE VEHICULOS",
"46-VÍVERES")
for (i in cuentas) {
if(i %in% SIGFE$SIGCOM & i %in% CxCC$ItemxCC){
CCC <- CxCC %>% filter(ItemxCC == i) %>%
select(CC, Total) %>%
group_by (CC) %>%
summarise(Total =sum(Total)) %>%
mutate("prop" = Total/sum(Total))
GG2 <-  SIGFE %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == i)
GG2 <- GG2 %>% summarise("Centro de Costo" = CCC$CC,
Devengado = Devengado*CCC$prop,
"Cuenta"=i, "Tipo" = 2)
GG1 <- rbind(GG1,GG2)}
else if (i %in% SIGFE$SIGCOM & i %in% CxCC_H$ItemxCC){
CCC <- CxCC_H %>% filter(ItemxCC == i) %>%
select(CC, Total) %>%
group_by (CC) %>%
summarise(Total =sum(Total)) %>%
mutate("prop" = Total/sum(Total))
GG2 <-  SIGFE %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == i)
GG2 <- GG2 %>% summarise("Centro de Costo" = CCC$CC,
Devengado = Devengado*CCC$prop,
"Cuenta"=i, "Tipo" = 2)
GG1 <- rbind(GG1,GG2)}
else if (i %in% SIGFE$SIGCOM){
proporcion_exacta <- ifelse(i %in% cuentas_cae, "prorrateo_cae",
ifelse(i %in% cuentas_clinico, "prorrateo_clinico",
ifelse(i %in% cuentas_qx, "prorrateo_qx", "todos")))
if (proporcion_exacta == "prorrateo_cae"){M2_exacto <- M2 %>% filter(Area == "Consultas")}
else if (proporcion_exacta == "prorrateo_clinico"){
M2_exacto <- M2 %>% filter(Area != "Apoyo")}
else if (proporcion_exacta == "prorrateo_qx"){
M2_exacto <- M2 %>% filter(Area == "Quirofanos")}
else{
M2_exacto <- M2 %>% filter(Area!="No_existe")}
M2_exacto$prop <- M2_exacto$M2/sum(M2_exacto$M2)
GG2 <-  SIGFE %>% group_by(SIGCOM) %>%
summarise(Devengado = sum(Devengado)) %>%
filter(SIGCOM == i)
GG2 <- GG2 %>% summarise("Centro de Costo" = M2_exacto$CC,
Devengado = Devengado*M2_exacto$prop,
"Cuenta"=i, "Tipo" = 2)
GG1 <- rbind(GG1,GG2)}
else  {GG2 <- GG1_nulo
GG1 <- rbind(GG1,GG2) %>% filter(Cuenta!="eliminar")}
}
# Centros de Costo Globales -----------------------------------------------
Compras_Servicios <- GG1 %>% filter (Cuenta == "65-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL INTERNO" |
Cuenta == "64-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL EXTERNO")
sum(Compras_Servicios$Devengado)
GG1 <- GG1 %>% filter (Cuenta != "65-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL INTERNO" &
Cuenta != "64-COMPRA DE INTERVENCIONES QUIRÚRGICAS INTRAHOSPITALARIAS CON PERSONAL EXTERNO")
GG4 <- GG1 %>% filter (`Centro de Costo`== "Pabellón Prorratear")
GG3 <- GG1 %>% filter (`Centro de Costo`== "Cae Prorratear")
GG1 <- GG1 %>% filter(`Centro de Costo`!="Pabellón Prorratear" &
`Centro de Costo`!="Cae Prorratear")
#PABELLON
qx <- c("464-QUIRÓFANOS CARDIOVASCULAR",
"467-QUIRÓFANOS DIGESTIVA",
"475-QUIRÓFANOS NEUROCIRUGÍA",
"478-QUIRÓFANOS OFTALMOLOGÍA",
"480-QUIRÓFANOS OTORRINOLARINGOLOGÍA",
"485-QUIRÓFANOS TRAUMATOLOGÍA Y ORTOPEDIA",
"486-QUIRÓFANOS UROLOGÍA",
"493-QUIRÓFANOS CIRUGÍA PLÁSTICA",
"495-QUIRÓFANOS CIRUGÍA VASCULAR",
"473-QUIRÓFANOS MENOR AMBULATORIA",
"471-QUIRÓFANOS MAYOR AMBULATORIA")
for (i in qx) {
# qx <- "464-QUIRÓFANOS CARDIOVASCULAR"
q <- sum(ifelse(M2Pab$CC == i, M2Pab$prop, 0))
GG2 <- GG4 %>% filter(`Centro de Costo`=="Pabellón Prorratear") %>%
summarise("Centro de Costo" = i,
Devengado = Devengado*q,
"Cuenta"= Cuenta,"Tipo" = 2)
GG44 <- rbind(GG44, GG2) %>% filter(Cuenta!="eliminar")
}
am <- c("240-PROCEDIMIENTO DE CARDIOLOGÍA",
"244-PROCEDIMIENTO DE NEUMOLOGÍA",
"249-PROCEDIMIENTOS DE DERMATOLOGÍA",
"250-PROCEDIMIENTOS DE GASTROENTEROLOGÍA",
"260-PROCEDIMIENTO ONCOLOGÍA",
"261-PROCEDIMIENTOS DE OTORRINOLARINGOLOGÍA",
"262-PROCEDIMIENTOS DE TRAUMATOLOGÍA",
"269-PROCEDIMIENTOS DE NEUROLOGÍA",
"351-CONSULTA CIRUGÍA PEDIÁTRICA",
"230-CONSULTA NUTRICIÓN",
"275-CONSULTA REUMATOLOGÍA",
"276-CONSULTA CARDIOLOGÍA",
"277-CONSULTA DERMATOLOGÍA",
"280-CONSULTA PSIQUIATRÍA",
"281-CONSULTA ENDOCRINOLOGÍA",
"282-CONSULTA NEUMOLOGÍA",
"284-CONSULTA INFECTOLOGÍA",
"285-CONSULTA NEFROLOGÍA",
"286-CONSULTA GENÉTICA",
"289-CONSULTA FISIATRÍA",
"290-CONSULTA GASTROENTEROLOGÍA",
"292-CONSULTA NEUROCIRUGÍA",
"296-CONSULTA ANESTESIOLOGIA",
"306-CONSULTA HEMATOLOGÍA ONCOLÓGICA",
"311-CONSULTA UROLOGÍA",
"316-CONSULTA CIRUGÍA PLÁSTICA",
"317-CONSULTA OFTALMOLOGÍA",
"319-CONSULTA OTORRINOLARINGOLOGÍA",
"328-CONSULTA PEDIATRÍA GENERAL",
"331-CONSULTA NEUROLOGÍA PEDIÁTRICA",
"342-CONSULTA TRAUMATOLOGÍA PEDIÁTRICA",
"353-CONSULTA GINECOLOGICA",
"356-CONSULTA ODONTOLOGÍA",
"359-TELEMEDICINA")
for (i in am) {
# qx <- "464-QUIRÓFANOS CARDIOVASCULAR"
# am <- "359-TELEMEDICINA"
a <- sum(ifelse(CAE_prorratear$CC == i, CAE_prorratear$prop, 0))
GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
summarise("Centro de Costo" = i,
Devengado = Devengado*a,
"Cuenta"= Cuenta,"Tipo" = 2)
GG33 <- rbind(GG33, GG2) %>% filter(Cuenta!="eliminar")
}
#AMBULATORIA
# am <- "240-PROCEDIMIENTO DE CARDIOLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
#
# GG33 <- GG2
#
# am <- "244-PROCEDIMIENTO DE NEUMOLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
#
# am <- "249-PROCEDIMIENTOS DE DERMATOLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "250-PROCEDIMIENTOS DE GASTROENTEROLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "260-PROCEDIMIENTO ONCOLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "261-PROCEDIMIENTOS DE OTORRINOLARINGOLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "262-PROCEDIMIENTOS DE TRAUMATOLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "269-PROCEDIMIENTOS DE NEUROLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "351-CONSULTA CIRUGÍA PEDIÁTRICA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "230-CONSULTA NUTRICIÓN"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "275-CONSULTA REUMATOLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
#
# am <- "276-CONSULTA CARDIOLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "277-CONSULTA DERMATOLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "280-CONSULTA PSIQUIATRÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "281-CONSULTA ENDOCRINOLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "282-CONSULTA NEUMOLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
#
# am <- "284-CONSULTA INFECTOLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "285-CONSULTA NEFROLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "286-CONSULTA GENÉTICA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
#
# am <- "289-CONSULTA FISIATRÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "290-CONSULTA GASTROENTEROLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
#
# am <- "292-CONSULTA NEUROCIRUGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
#
# am <- "296-CONSULTA ANESTESIOLOGIA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "306-CONSULTA HEMATOLOGÍA ONCOLÓGICA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "311-CONSULTA UROLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "316-CONSULTA CIRUGÍA PLÁSTICA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
#
# am <- "317-CONSULTA OFTALMOLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "319-CONSULTA OTORRINOLARINGOLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "328-CONSULTA PEDIATRÍA GENERAL"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "331-CONSULTA NEUROLOGÍA PEDIÁTRICA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "342-CONSULTA TRAUMATOLOGÍA PEDIÁTRICA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "353-CONSULTA GINECOLOGICA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "356-CONSULTA ODONTOLOGÍA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
# am <- "359-TELEMEDICINA"
# a <- sum(ifelse(CAE_prorratear$CC == am, CAE_prorratear$prop, 0))
# GG2 <- GG3 %>% filter(`Centro de Costo`=="Cae Prorratear") %>%
#   summarise("Centro de Costo" = am,
#             Devengado = Devengado*a,
#             "Cuenta"= Cuenta,"Tipo" = 2)
# GG33 <- rbind(GG33, GG2)
GG1 <- rbind(GG33,GG44,GG1)
#con esta formula puedo prorratear los que estan en
# CAE prorratear, hospitalizacion prorratear, pab prorratear y M2
#### Falta aplicar esta formula a:
#### Pabellón Prorratear
#### CAE Prorratear
#aca solo busca en sigfe (cuando hay devengo y no CxCC) y debo conectarlo
# con el CxCC Historial
#en el CxCC Historial debe incluir c/u de los Items presupuestarios
#estudiar los for
#Redondeo el Devengado
GG1 <- GG1 %>%  filter (Devengado != 0) %>%
summarise("Centro de Costo"= `Centro de Costo`,"Devengado" = round(Devengado),
"Cuenta"=Cuenta,"Tipo"=Tipo) %>%
ungroup()
GG1 <- GG1 %>% mutate(`Centro de Costo` = case_when(`Centro de Costo` ==	"478-QUIRÓFANOS OFTALMOLOGÍA"	~	"471-QUIRÓFANOS MAYOR AMBULATORIA",
`Centro de Costo` ==	"480-QUIRÓFANOS OTORRINOLARINGOLOGÍA"	~	"471-QUIRÓFANOS MAYOR AMBULATORIA",
`Centro de Costo` ==	"713-TRABAJO SOCIAL"	~	"99544-TRABAJO SOCIAL",
TRUE ~ `Centro de Costo`))
sum(SIGFE$Devengado)
SIGFE %>%  filter(Tipo != "Insumos") %>%
summarise(sum(Devengado))
sum(GG1$Devengado)
diferencia <- sum(SIGFE$Devengado)-sum(GG1$Devengado)-sum(Compras_Servicios$Devengado)
diferencia
openxlsx::write.xlsx(GG1, graba, colNames = TRUE, sheetName = "SIGFE", overwrite = TRUE)
# rm(Farm, GG2, GG3, GG33, GG4, GG44, M2, M2Pab,
#    `471-QUIRÓFANOS MAYOR AMBULATORIA`, `473-QUIRÓFANOS MENOR AMBULATORIA`, a,
#    am, Cant_RRHH, ConsumoxCC, ggenerales, graba, insumos, M2_Pab_EqMed,
#    Metros_pabellon, q, qx, RRHH_sigfe, b, SIGFE2, GG1_nulo, cuentas,
#    cuentas_cae, cuentas_clinico, cuentas_qx, cuentas_total, EqMed, EqMedCorrec,
#    EqMedPrev, CAE_prorratear, Cant_RRHH, i, resto, ruta_base, mes_archivo, df, CxCC, CxCC_H, CCC)
sum(Compras_Servicios$Devengado)
rm(`471-QUIRÓFANOS MAYOR AMBULATORIA`, `473-QUIRÓFANOS MENOR AMBULATORIA`,a, am, b,
Cant_RRHH, ConsumoxCC, cuenta_insumos, cuentas, cuentas_cae, cuentas_clinico,
cuentas_qx, cuentas_total, Farmacia, ggenerales, graba, i, insumos, M2_Pab_EqMed,
mes_archivo, Metros_pabellon, proporcion_exacta, q, qx, resto, RRHH_sigfe, ruta_base,
CAE_prorratear, cant_RRHH, CCC, CxCC, CxCC_H, df, EqMed, EqMedCorrec,
EqMedPrev, Farm, GG1_nulo, GG2, GG3, GG33, GG4, GG44, M2, M2_exacto, M2Pab, SIGFE2)
View(Compras_Servicios)
